
(()=>{"use strict";var e={757:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Dc});var n={};r.r(n),r.d(n,{Bool:()=>Wo,BoolClass:()=>To,ConstructType:()=>_o,Empty:()=>zo,EmptyClass:()=>Eo,FixedIntClass:()=>Oo,FixedNatClass:()=>Po,Float32:()=>ta,Float64:()=>ra,FloatClass:()=>ko,Func:()=>ba,FuncClass:()=>jo,Int:()=>Qo,Int16:()=>ia,Int32:()=>sa,Int64:()=>oa,Int8:()=>na,IntClass:()=>No,Nat:()=>ea,Nat16:()=>ca,Nat32:()=>ua,Nat64:()=>da,Nat8:()=>aa,NatClass:()=>Ao,Null:()=>Jo,NullClass:()=>Bo,Opt:()=>pa,OptClass:()=>Fo,PrimitiveType:()=>vo,Principal:()=>la,PrincipalClass:()=>$o,Rec:()=>ga,RecClass:()=>Vo,Record:()=>ya,RecordClass:()=>Do,Reserved:()=>Ho,ReservedClass:()=>Co,Service:()=>wa,ServiceClass:()=>Mo,Text:()=>Xo,TextClass:()=>So,Tuple:()=>fa,TupleClass:()=>Uo,Type:()=>xo,Unknown:()=>Yo,UnknownClass:()=>Io,Variant:()=>ma,VariantClass:()=>qo,Vec:()=>ha,VecClass:()=>Ro,Visitor:()=>bo,decode:()=>Zo,encode:()=>Go,resetSubtypeCache:()=>_a,subtype:()=>Ia});const i="abcdefghijklmnopqrstuvwxyz234567",s=Object.create(null);for(let e=0;e<32;e++)s[i[e]]=e;s[0]=s.o,s[1]=s.i;const o=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),a="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function c(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function u(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function d(e,...t){if(!c(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function l(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function f(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function h(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function p(e,t){return e<<32-t|e>>>t}const y=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),m=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function g(e){if(d(e),y)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=m[e[r]];return t}function b(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function w(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(y)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){const r=b(e.charCodeAt(i)),s=b(e.charCodeAt(i+1));if(void 0===r||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}n[t]=16*r+s}return n}function x(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function v(e){return"string"==typeof e&&(e=x(e)),d(e),e}function _(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];d(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}class E{}function I(e){const t=t=>e().update(v(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function T(e=32){if(a&&"function"==typeof a.getRandomValues)return a.getRandomValues(new Uint8Array(e));if(a&&"function"==typeof a.randomBytes)return Uint8Array.from(a.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function B(e,t,r){return e&t^~e&r}function C(e,t,r){return e&t^e&r^t&r}class S extends E{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=h(this.buffer)}update(e){l(this),d(e=v(e));const{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){const t=h(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){l(this),function(e,t){d(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,f(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const o=h(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=i,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const N=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),k=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),O=BigInt(2**32-1),P=BigInt(32);function R(e,t=!1){return t?{h:Number(e&O),l:Number(e>>P&O)}:{h:0|Number(e>>P&O),l:0|Number(e&O)}}const F=(e,t,r)=>e>>>r,D=(e,t,r)=>e<<32-r|t>>>r,U=(e,t,r)=>e>>>r|t<<32-r,q=(e,t,r)=>e<<32-r|t>>>r,V=(e,t,r)=>e<<64-r|t>>>r-32,L=(e,t,r)=>e>>>r-32|t<<64-r;function $(e,t,r,n){const i=(t>>>0)+(n>>>0);return{h:e+r+(i/2**32|0)|0,l:0|i}}const j=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),M=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,K=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),G=(e,t,r,n,i)=>t+r+n+i+(e/2**32|0)|0,Z=(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0),z=(e,t,r,n,i,s)=>t+r+n+i+s+(e/2**32|0)|0,H=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Y=new Uint32Array(64);class W extends S{constructor(e=32){super(64,e,8,!1),this.A=0|N[0],this.B=0|N[1],this.C=0|N[2],this.D=0|N[3],this.E=0|N[4],this.F=0|N[5],this.G=0|N[6],this.H=0|N[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)Y[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Y[e-15],r=Y[e-2],n=p(t,7)^p(t,18)^t>>>3,i=p(r,17)^p(r,19)^r>>>10;Y[e]=i+Y[e-7]+n+Y[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(p(o,6)^p(o,11)^p(o,25))+B(o,a,c)+H[e]+Y[e]|0,d=(p(r,2)^p(r,13)^p(r,22))+C(r,n,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+d|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,i,s,o,a,c,u)}roundClean(){f(Y)}destroy(){this.set(0,0,0,0,0,0,0,0),f(this.buffer)}}class J extends W{constructor(){super(28),this.A=0|A[0],this.B=0|A[1],this.C=0|A[2],this.D=0|A[3],this.E=0|A[4],this.F=0|A[5],this.G=0|A[6],this.H=0|A[7]}}const X=(()=>function(e,t=!1){const r=e.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:r,l:o}=R(e[s],t);[n[s],i[s]]=[r,o]}return[n,i]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),Q=(()=>X[0])(),ee=(()=>X[1])(),te=new Uint32Array(80),re=new Uint32Array(80);class ne extends S{constructor(e=64){super(128,e,16,!1),this.Ah=0|k[0],this.Al=0|k[1],this.Bh=0|k[2],this.Bl=0|k[3],this.Ch=0|k[4],this.Cl=0|k[5],this.Dh=0|k[6],this.Dl=0|k[7],this.Eh=0|k[8],this.El=0|k[9],this.Fh=0|k[10],this.Fl=0|k[11],this.Gh=0|k[12],this.Gl=0|k[13],this.Hh=0|k[14],this.Hl=0|k[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:c,El:u,Fh:d,Fl:l,Gh:f,Gl:h,Hh:p,Hl:y}=this;return[e,t,r,n,i,s,o,a,c,u,d,l,f,h,p,y]}set(e,t,r,n,i,s,o,a,c,u,d,l,f,h,p,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|d,this.Fl=0|l,this.Gh=0|f,this.Gl=0|h,this.Hh=0|p,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)te[r]=e.getUint32(t),re[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|te[e-15],r=0|re[e-15],n=U(t,r,1)^U(t,r,8)^F(t,0,7),i=q(t,r,1)^q(t,r,8)^D(t,r,7),s=0|te[e-2],o=0|re[e-2],a=U(s,o,19)^V(s,o,61)^F(s,0,6),c=q(s,o,19)^L(s,o,61)^D(s,o,6),u=K(i,c,re[e-7],re[e-16]),d=G(u,n,a,te[e-7],te[e-16]);te[e]=0|d,re[e]=0|u}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:c,Dl:u,Eh:d,El:l,Fh:f,Fl:h,Gh:p,Gl:y,Hh:m,Hl:g}=this;for(let e=0;e<80;e++){const t=U(d,l,14)^U(d,l,18)^V(d,l,41),b=q(d,l,14)^q(d,l,18)^L(d,l,41),w=d&f^~d&p,x=Z(g,b,l&h^~l&y,ee[e],re[e]),v=z(x,m,t,w,Q[e],te[e]),_=0|x,E=U(r,n,28)^V(r,n,34)^V(r,n,39),I=q(r,n,28)^L(r,n,34)^L(r,n,39),T=r&i^r&o^i&o,B=n&s^n&a^s&a;m=0|p,g=0|y,p=0|f,y=0|h,f=0|d,h=0|l,({h:d,l}=$(0|c,0|u,0|v,0|_)),c=0|o,u=0|a,o=0|i,a=0|s,i=0|r,s=0|n;const C=j(_,I,B);r=M(C,v,E,T),n=0|C}({h:r,l:n}=$(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=$(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=$(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:u}=$(0|this.Dh,0|this.Dl,0|c,0|u)),({h:d,l}=$(0|this.Eh,0|this.El,0|d,0|l)),({h:f,l:h}=$(0|this.Fh,0|this.Fl,0|f,0|h)),({h:p,l:y}=$(0|this.Gh,0|this.Gl,0|p,0|y)),({h:m,l:g}=$(0|this.Hh,0|this.Hl,0|m,0|g)),this.set(r,n,i,s,o,a,c,u,d,l,f,h,p,y,m,g)}roundClean(){f(te,re)}destroy(){f(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ie=I(()=>new W),se=I(()=>new J),oe=I(()=>new ne),ae="__principal__";class ce{static anonymous(){return new this(new Uint8Array([4]))}static managementCanister(){return this.fromText("aaaaa-aa")}static selfAuthenticating(e){const t=se(e);return new this(new Uint8Array([...t,2]))}static from(e){if("string"==typeof e)return ce.fromText(e);if(Object.getPrototypeOf(e)===Uint8Array.prototype)return new ce(e);if(ce.isPrincipal(e))return new ce(e._arr);throw new Error(`Impossible to convert ${JSON.stringify(e)} to Principal.`)}static fromHex(e){return new this(w(e))}static fromText(e){let t=e;if(e.includes(ae)){const r=JSON.parse(e);ae in r&&(t=r[ae])}let r=function(e){let t=0,r=0;const n=new Uint8Array(4*e.length/3|0);let i=0;function o(e){let o=s[e.toLowerCase()];if(void 0===o)throw new Error(`Invalid character: ${JSON.stringify(e)}`);o<<=3,r|=o>>>t,t+=5,t>=8&&(n[i++]=r,t-=8,r=t>0?o<<5-t&255:0)}for(const t of e)o(t);return n.slice(0,i)}(t.toLowerCase().replace(/-/g,""));r=r.slice(4,r.length);const n=new this(r);if(n.toText()!==t)throw new Error(`Principal "${n.toText()}" does not have a valid checksum (original value "${t}" may not be a valid Principal ID).`);return n}static fromUint8Array(e){return new this(e)}static isPrincipal(e){return e instanceof ce||"object"==typeof e&&null!==e&&"_isPrincipal"in e&&!0===e._isPrincipal&&"_arr"in e&&e._arr instanceof Uint8Array}constructor(e){this._arr=e,this._isPrincipal=!0}isAnonymous(){return 1===this._arr.byteLength&&4===this._arr[0]}toUint8Array(){return this._arr}toHex(){return g(this._arr).toUpperCase()}toText(){const e=new ArrayBuffer(4);new DataView(e).setUint32(0,function(e){let t=-1;for(let r=0;r<e.length;r++){const n=e[r];t=o[255&(n^t)]^t>>>8}return(-1^t)>>>0}(this._arr));const t=new Uint8Array(e),r=function(e){let t=0,r=0,n="";function s(e){return t<0?r|=e>>-t:r=e<<t&248,t>3?(t-=8,1):(t<4&&(n+=i[r>>3],t+=5),0)}for(let t=0;t<e.length;)t+=s(e[t]);return n+(t<0?i[r>>3]:"")}(new Uint8Array([...t,...this._arr])).match(/.{1,5}/g);if(!r)throw new Error;return r.join("-")}toString(){return this.toText()}toJSON(){return{[ae]:this.toText()}}compareTo(e){for(let t=0;t<Math.min(this._arr.length,e._arr.length);t++){if(this._arr[t]<e._arr[t])return"lt";if(this._arr[t]>e._arr[t])return"gt"}return this._arr.length<e._arr.length?"lt":this._arr.length>e._arr.length?"gt":"eq"}ltEq(e){const t=this.compareTo(e);return"lt"==t||"eq"==t}gtEq(e){const t=this.compareTo(e);return"gt"==t||"eq"==t}}function ue(...e){const t=new Uint8Array(e.reduce((e,t)=>e+t.byteLength,0));let r=0;for(const n of e)t.set(n,r),r+=n.byteLength;return t}class de{save(){return this._view}restore(e){if(!(e instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=e}constructor(e,t=e?.byteLength||0){if(e&&!(e instanceof Uint8Array))try{e=le(e)}catch{throw new Error("Buffer must be a Uint8Array")}if(t<0||!Number.isInteger(t))throw new Error("Length must be a non-negative integer");if(e&&t>e.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=e||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,t)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(e){const t=this._view.subarray(0,e);return this._view=this._view.subarray(e),t.slice()}readUint8(){if(0===this._view.byteLength)return;const e=this._view[0];return this._view=this._view.subarray(1),e}write(e){if(!(e instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");const t=this._view.byteLength;this._view.byteOffset+this._view.byteLength+e.byteLength>=this._buffer.byteLength?this.alloc(e.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+e.byteLength),this._view.set(e,t)}get end(){return 0===this._view.byteLength}alloc(e){if(e<=0||!Number.isInteger(e))throw new Error("Amount must be a positive integer");const t=new Uint8Array(1.2*(this._buffer.byteLength+e)|0),r=new Uint8Array(t.buffer,0,this._view.byteLength+e);r.set(this._view),this._buffer=t,this._view=r}}function le(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer||Array.isArray(e)?new Uint8Array(e):"buffer"in e?le(e.buffer):new Uint8Array(e)}function fe(e,t){if(e.byteLength!==t.byteLength)return e.byteLength-t.byteLength;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]-t[r];return 0}function he(e){const t=BigInt(e);if(e<=0)throw new RangeError("Input must be positive");return t.toString(2).length-1}function pe(e){const t=BigInt(e);if(e<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<t}function ye(){throw new Error("unexpected end of buffer")}function me(e,t){return e.byteLength<t&&ye(),e.read(t)}function ge(e){const t=e.readUint8();return void 0===t&&ye(),t}function be(e){if("number"==typeof e&&(e=BigInt(e)),e<BigInt(0))throw new Error("Cannot leb encode negative values.");const t=(e===BigInt(0)?0:he(e))+1,r=new de(new Uint8Array(t),0);for(;;){const t=Number(e&BigInt(127));if((e/=BigInt(128))===BigInt(0)){r.write(new Uint8Array([t]));break}r.write(new Uint8Array([128|t]))}return r.buffer}function we(e){let t,r=BigInt(1),n=BigInt(0);do{t=ge(e),n+=BigInt(127&t).valueOf()*r,r*=BigInt(128)}while(t>=128);return n}function xe(e){"number"==typeof e&&(e=BigInt(e));const t=e<BigInt(0);t&&(e=-e-BigInt(1));const r=(e===BigInt(0)?0:he(e))+1,n=new de(new Uint8Array(r),0);for(;;){const r=i(e);if(e/=BigInt(128),t&&e===BigInt(0)&&64&r||!t&&e===BigInt(0)&&!(64&r)){n.write(new Uint8Array([r]));break}n.write(new Uint8Array([128|r]))}function i(e){const r=e%BigInt(128);return Number(t?BigInt(128)-r-BigInt(1):r)}return n.buffer}function ve(e){const t=new Uint8Array(e.buffer);let r=0;for(;r<t.byteLength;r++)if(t[r]<128){if(!(64&t[r]))return we(e);break}const n=new Uint8Array(me(e,r+1));let i=BigInt(0);for(let e=n.byteLength-1;e>=0;e--)i=i*BigInt(128)+BigInt(128-(127&n[e])-1);return-i-BigInt(1)}function _e(e,t){e=BigInt(e);const r=new de(new Uint8Array(Math.min(1,t)),0);let n=0,i=BigInt(256),s=BigInt(0),o=Number(e%i);for(r.write(new Uint8Array([o]));++n<t;)e<0&&s===BigInt(0)&&0!==o&&(s=BigInt(1)),o=Number((e/i-s)%BigInt(256)),r.write(new Uint8Array([o])),i*=BigInt(256);return r.buffer}function Ee(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=BigInt(ge(e)),n=BigInt(1),i=0;for(;++i<t;)n*=BigInt(256),r+=n*BigInt(ge(e));return r}var Ie;!function(e){e.Trust="Trust",e.Protocol="Protocol",e.Reject="Reject",e.Transport="Transport",e.External="External",e.Limit="Limit",e.Input="Input",e.Unknown="Unknown"}(Ie||(Ie={}));class Te{constructor(e=!1){this.isCertified=e}toString(){let e=this.toErrorMessage();return this.requestContext&&(e+=`\nRequest context:\n  Request ID (hex): ${this.requestContext.requestId?g(this.requestContext.requestId):"undefined"}\n  Sender pubkey (hex): ${g(this.requestContext.senderPubKey)}\n  Sender signature (hex): ${g(this.requestContext.senderSignature)}\n  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(e+=`\nCall context:\n  Canister ID: ${this.callContext.canisterId.toText()}\n  Method name: ${this.callContext.methodName}\n  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),e}}class Be extends Error{get code(){return this.cause.code}set code(e){this.cause.code=e}get kind(){return this.cause.kind}set kind(e){this.cause.kind=e}get isCertified(){return this.code.isCertified}constructor(e,t){super(e.toString()),this.name="AgentError",this.cause={code:e,kind:t},Object.setPrototypeOf(this,Be.prototype)}hasCode(e){return this.code instanceof e}toString(){return`${this.name} (${this.kind}): ${this.message}`}}class Ce extends Be{static fromCode(e){return new this(e)}}class Se extends Ce{constructor(e){super(e,Ie.Trust),this.name="TrustError",Object.setPrototypeOf(this,Se.prototype)}}class Ne extends Ce{constructor(e){super(e,Ie.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,Ne.prototype)}}class Ae extends Ce{constructor(e){super(e,Ie.Reject),this.name="RejectError",Object.setPrototypeOf(this,Ae.prototype)}}class ke extends Ce{constructor(e){super(e,Ie.Transport),this.name="TransportError",Object.setPrototypeOf(this,ke.prototype)}}class Oe extends Ce{constructor(e){super(e,Ie.External),this.name="ExternalError",Object.setPrototypeOf(this,Oe.prototype)}}class Pe extends Ce{constructor(e){super(e,Ie.Input),this.name="InputError",Object.setPrototypeOf(this,Pe.prototype)}}class Re extends Ce{constructor(e){super(e,Ie.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,Re.prototype)}}class Fe extends Te{constructor(e,t){super(),this.reason=e,this.error=t,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,Fe.prototype)}toErrorMessage(){let e=this.reason;return this.error&&(e+=`: ${wt(this.error)}`),`Certificate verification error: "${e}"`}}class De extends Te{constructor(e,t,r,n,i){super(),this.maxAgeInMinutes=e,this.certificateTime=t,this.currentTime=r,this.timeDiffMsecs=n,this.ageType=i,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,De.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()} Clock drift: ${this.timeDiffMsecs}ms`}}class Ue extends Te{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,Ue.prototype)}toErrorMessage(){return"Certificate has too many delegations"}}class qe extends Te{constructor(e,t){super(),this.canisterId=e,this.subnetId=t,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,qe.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: ${this.subnetId.toText()}`}}class Ve extends Te{constructor(e,t){super(),this.message=e,this.lookupStatus=t,this.name="LookupErrorCode",Object.setPrototypeOf(this,Ve.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}}class Le extends Te{constructor(e){super(),this.message=e,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,Le.prototype)}toErrorMessage(){return this.message}}class $e extends Te{constructor(e){super(),this.message=e,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,$e.prototype)}toErrorMessage(){return this.message}}class je extends Te{constructor(e,t){super(),this.expectedLength=e,this.actualLength=t,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,je.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}}class Me extends Te{constructor(e,t){super(),this.expectedPrefix=e,this.actualPrefix=t,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,Me.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${g(this.expectedPrefix)}, but got ${g(this.actualPrefix)}`}}class Ke extends Te{constructor(e,t){super(),this.expectedLength=e,this.actualLength=t,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,Ke.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}}class Ge extends Te{constructor(e){super(),this.error=e,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,Ge.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}}class Ze extends Te{constructor(e){super(),this.error=e,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,Ze.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}}class ze extends Te{constructor(e,t){super(),this.error=e,this.input=t,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,ze.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${wt(this.error)}, input: ${g(this.input)}`}}class He extends Te{constructor(e,t){super(),this.error=e,this.value=t,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,He.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${wt(this.error)}, input: ${this.value}`}}class Ye extends Te{constructor(e,t,r){super(),this.message=e,this.requestId=t,this.status=r,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,Ye.prototype)}toErrorMessage(){let e=`${this.message}\n`;return this.requestId&&(e+=`  Request ID: ${g(this.requestId)}\n`),this.status&&(e+=`  Request status: ${this.status}\n`),e}}class We extends Te{constructor(e,t,r){super(),this.maxIngressExpiryInMinutes=e,this.requestId=t,this.retryTimes=r,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,We.prototype)}toErrorMessage(){let e=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?\n  Request ID: ${g(this.requestId)}\n`;return void 0!==this.retryTimes&&(e+=`  Retried ${this.retryTimes} times.`),e}}class Je extends Te{constructor(e,t,r,n){super(!0),this.requestId=e,this.rejectCode=t,this.rejectMessage=r,this.rejectErrorCode=n,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,Je.prototype)}toErrorMessage(){return`The replica returned a rejection error:\n  Request ID: ${g(this.requestId)}\n  Reject code: ${this.rejectCode}\n  Reject text: ${this.rejectMessage}\n  Error code: ${this.rejectErrorCode}\n`}}class Xe extends Te{constructor(e,t,r,n,i){super(),this.requestId=e,this.rejectCode=t,this.rejectMessage=r,this.rejectErrorCode=n,this.signatures=i,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,Xe.prototype)}toErrorMessage(){return`The replica returned a rejection error:\n  Request ID: ${g(this.requestId)}\n  Reject code: ${this.rejectCode}\n  Reject text: ${this.rejectMessage}\n  Error code: ${this.rejectErrorCode}\n`}}class Qe extends Te{constructor(e,t,r,n){super(),this.requestId=e,this.rejectCode=t,this.rejectMessage=r,this.rejectErrorCode=n,this.name="UncertifiedRejectUpdateErrorCode",Object.setPrototypeOf(this,Qe.prototype)}toErrorMessage(){return`The replica returned a rejection error:\n  Request ID: ${g(this.requestId)}\n  Reject code: ${this.rejectCode}\n  Reject text: ${this.rejectMessage}\n  Error code: ${this.rejectErrorCode}\n`}}class et extends Te{constructor(e){super(),this.requestId=e,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,et.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:\n  Request ID: ${g(this.requestId)}\n`}}class tt extends Te{constructor(e){super(),this.shouldFetchRootKey=e,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,tt.prototype)}toErrorMessage(){return void 0===this.shouldFetchRootKey?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}}class rt extends Te{constructor(e){super(),this.value=e,this.name="HashValueErrorCode",Object.setPrototypeOf(this,rt.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}}class nt extends Te{constructor(e){super(),this.error=e,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,nt.prototype)}toErrorMessage(){return this.error}}class it extends Te{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,it.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}}class st extends Te{constructor(e,t){super(),this.message=e,this.providedIngressExpiryInMinutes=t,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,st.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}}class ot extends Te{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,ot.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}}class at extends Te{constructor(e){super(),this.error=e,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,at.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}}class ct extends Te{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,ct.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}}class ut extends Te{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,ut.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}}class dt extends Te{constructor(e){super(),this.nodeId=e,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,dt.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}}class lt extends Te{constructor(e){super(),this.error=e,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,lt.prototype)}toErrorMessage(){return`Unexpected error: ${wt(this.error)}`}}class ft extends Te{constructor(e){super(),this.error=e,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,ft.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}}class ht extends Te{constructor(e,t,r,n){super(),this.status=e,this.statusText=t,this.headers=r,this.bodyText=n,this.name="HttpErrorCode",Object.setPrototypeOf(this,ht.prototype)}toErrorMessage(){let e=`HTTP request failed:\n  Status: ${this.status} (${this.statusText})\n  Headers: ${JSON.stringify(this.headers)}\n`;return this.bodyText&&(e+=`  Body: ${this.bodyText}\n`),e}}class pt extends Te{constructor(){super(),this.name="HttpV3ApiNotSupportedErrorCode",Object.setPrototypeOf(this,pt.prototype)}toErrorMessage(){return"HTTP request failed: v3 API is not supported"}}class yt extends Te{constructor(e){super(),this.error=e,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,yt.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${wt(this.error)}`}}class mt extends Te{constructor(e){super(),this.receivedCanisterId=e,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,mt.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}}class gt extends Te{constructor(e){super(),this.request=e,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,gt.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}}class bt extends Te{constructor(e){super(),this.error=e,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,bt.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}}function wt(e){if(e instanceof Error)return e.stack??e.message;try{return JSON.stringify(e)}catch{return String(e)}}const xt=new Error("unreachable");function vt(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer||Array.isArray(e)?new Uint8Array(e):"buffer"in e?vt(e.buffer):new Uint8Array(e)}function _t(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Et(e){if("string"==typeof e)return It(e);if("number"==typeof e)return ie(be(e));if(e instanceof Uint8Array||ArrayBuffer.isView(e))return ie(vt(e));if(Array.isArray(e)){const t=e.map(Et);return ie(_(...t))}if(e&&"object"==typeof e&&e._isPrincipal)return ie(e.toUint8Array());if("object"==typeof e&&null!==e&&"function"==typeof e.toHash)return Et(e.toHash());if("object"==typeof e)return Bt(e);if("bigint"==typeof e)return ie(be(e));throw Pe.fromCode(new rt(e))}const It=e=>{const t=(new TextEncoder).encode(e);return ie(t)};function Tt(e){return Bt(e)}function Bt(e){const t=_(...Object.entries(e).filter(([,e])=>void 0!==e).map(([e,t])=>[It(e),Et(t)]).sort(([e],[t])=>fe(e,t)).map(e=>_(...e)));return ie(t)}const Ct=(new TextEncoder).encode("\nic-request"),St=(new TextEncoder).encode("\vic-response"),Nt=(new TextEncoder).encode("ic-request-auth-delegation");class At{getPrincipal(){return this._principal||(this._principal=ce.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()))),this._principal}async transformRequest(e){const{body:t,...r}=e,n=Tt(t);return{...r,body:{content:t,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(_(Ct,n))}}}}class kt{getPrincipal(){return ce.anonymous()}async transformRequest(e){return{...e,body:{content:e.body}}}}class Ot extends Error{constructor(e){super(e),this.name="DecodingError"}}const Pt=Symbol("CBOR_STOP_CODE");var Rt=(e=>(e[e.False=20]="False",e[e.True=21]="True",e[e.Null=22]="Null",e[e.Undefined=23]="Undefined",e[e.Break=31]="Break",e))(Rt||{}),Ft=(e=>(e[e.UnsignedInteger=0]="UnsignedInteger",e[e.NegativeInteger=1]="NegativeInteger",e[e.ByteString=2]="ByteString",e[e.TextString=3]="TextString",e[e.Array=4]="Array",e[e.Map=5]="Map",e[e.Tag=6]="Tag",e[e.Simple=7]="Simple",e))(Ft||{});const Dt=BigInt("0xffffffffffffffff");var Ut=(e=>(e[e.Value=23]="Value",e[e.OneByte=24]="OneByte",e[e.TwoBytes=25]="TwoBytes",e[e.FourBytes=26]="FourBytes",e[e.EightBytes=27]="EightBytes",e[e.Indefinite=31]="Indefinite",e))(Ut||{});const qt=!1;function Vt(e,t){const r=new Uint8Array(t);return r.set(e),r}const Lt=new TextDecoder;let $t,jt=new Uint8Array,Mt=0;function Kt(e){const[t,r]=Gt();switch(t){case Ft.UnsignedInteger:return Zt(r);case Ft.NegativeInteger:return function(e){const t=Zt(e);return"number"==typeof t?-1-t:-1n-t}(r);case Ft.ByteString:return zt(r);case Ft.TextString:return Ht(r);case Ft.Array:return function(e,t){const r=Zt(e);if(r===1/0){const e=[];let r=Kt(t);for(;r!==Pt;)e.push((null==t?void 0:t(r))??r),r=Kt(t);return e}const n=new Array(r);for(let e=0;e<r;e++){const r=Kt(t);n[e]=(null==t?void 0:t(r))??r}return n}(r,e);case Ft.Map:return function(e,t){const r=Zt(e),n={};if(r===1/0){let[e,r]=Gt();for(;e!==Ft.Simple&&r!==Rt.Break;){const i=Ht(r),s=Kt(t);n[i]=(null==t?void 0:t(s,i))??s,[e,r]=Gt()}return n}for(let e=0;e<r;e++){const[e,r]=Gt();if(e!==Ft.TextString)throw new Ot("Map keys must be text strings");const i=Ht(r),s=Kt(t);n[i]=(null==t?void 0:t(s,i))??s}return n}(r,e);case Ft.Tag:return function(e,t){const r=Zt(e);if(55799===r)return Kt(t);throw new Ot(`Unsupported tag: ${r}.`)}(r,e);case Ft.Simple:return function(e){switch(e){case Rt.False:return!1;case Rt.True:return!0;case Rt.Null:return null;case Rt.Undefined:return;case Rt.Break:return Pt}throw new Ot(`Unrecognized simple type: ${e.toString(2)}`)}(r)}throw new Ot(`Unsupported major type: ${t}`)}function Gt(){const e=jt.at(Mt);if(function(e){return null==e}(e))throw new Ot("Provided CBOR data is empty");const t=function(e){return(224&e)>>5}(e),r=function(e){return 31&e}(e);return Mt++,[t,r]}function Zt(e){if(e<=Ut.Value)return e;switch($t=new DataView(jt.buffer,jt.byteOffset+Mt),e){case Ut.OneByte:return Mt++,$t.getUint8(0);case Ut.TwoBytes:return Mt+=2,$t.getUint16(0,qt);case Ut.FourBytes:return Mt+=4,$t.getUint32(0,qt);case Ut.EightBytes:return Mt+=8,$t.getBigUint64(0,qt);case Ut.Indefinite:return 1/0;default:throw new Ot(`Unsupported integer info: ${e.toString(2)}`)}}function zt(e){const t=Zt(e);if(t>Number.MAX_SAFE_INTEGER)throw new Ot("Byte length is too large");const r=Number(t);return Mt+=r,jt.slice(Mt-r,Mt)}function Ht(e){const t=zt(e);return Lt.decode(t)}class Yt extends Error{constructor(e){super(e),this.name="SerializationError"}}const Wt=new TextEncoder;function Jt(e){return e<<5}let Xt=new Uint8Array(2048),Qt=new DataView(Xt.buffer),er=0,tr=[];function rr(e,t){er=0;return function(e,t,r){ir(Ft.Tag,55799),nr(t,r)}(0,(null==t?void 0:t(e))??e,t),Xt.slice(0,er)}function nr(e,t){if(er>Xt.length-100&&(Xt=Vt(Xt,2*Xt.length),Qt=new DataView(Xt.buffer)),!1!==e&&!0!==e&&null!=e)if("number"!=typeof e&&"bigint"!=typeof e)if("string"!=typeof e)if(e instanceof Uint8Array)cr(e);else if(e instanceof ArrayBuffer)cr(new Uint8Array(e));else if(Array.isArray(e))!function(e,t){ir(Ft.Array,e.length),e.forEach((e,r)=>{nr((null==t?void 0:t(e,r.toString()))??e,t)})}(e,t);else{if("object"!=typeof e)throw new Yt("Unsupported type: "+typeof e);!function(e,t){tr=Object.entries(e),ir(Ft.Map,tr.length),tr.forEach(([e,r])=>{ar(e),nr((null==t?void 0:t(r,e))??r,t)})}(e,t)}else ar(e);else!function(e){e>=0?function(e){or(Ft.UnsignedInteger,e)}(e):function(e){or(Ft.NegativeInteger,"bigint"==typeof e?-1n-e:-1-e)}(e)}(e);else!function(e){ir(Ft.Simple,function(e){if(!1===e)return Rt.False;if(!0===e)return Rt.True;if(null===e)return Rt.Null;if(void 0===e)return Rt.Undefined;throw new Yt(`Unrecognized simple value: ${e.toString()}`)}(e))}(e)}function ir(e,t){if(!(t<=23)){if(t<=255)return Qt.setUint8(er++,Jt(e)|Ut.OneByte),Qt.setUint8(er,Number(t)),void(er+=1);if(t<=65535)return Qt.setUint8(er++,Jt(e)|Ut.TwoBytes),Qt.setUint16(er,Number(t),qt),void(er+=2);if(t<=4294967295)return Qt.setUint8(er++,Jt(e)|Ut.FourBytes),Qt.setUint32(er,Number(t),qt),void(er+=4);if(t<=Dt)return Qt.setUint8(er++,Jt(e)|Ut.EightBytes),Qt.setBigUint64(er,BigInt(t),qt),void(er+=8);throw new Yt(`Value too large to encode: ${t}`)}Qt.setUint8(er++,Jt(e)|Number(t))}function sr(e,t){ir(e,t.length),er>Xt.length-t.length&&(Xt=Vt(Xt,Xt.length+t.length),Qt=new DataView(Xt.buffer)),Xt.set(t,er),er+=t.length}function or(e,t){ir(e,t)}function ar(e){sr(Ft.TextString,Wt.encode(e))}function cr(e){sr(Ft.ByteString,e)}const ur=()=>{if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){const e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]}if("undefined"!=typeof crypto&&crypto.getRandomValues){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}return"undefined"!=typeof crypto&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(4294967295*Math.random())};var dr,lr,fr;function hr(){const e=new ArrayBuffer(16),t=new DataView(e),r=ur(),n=ur(),i=ur(),s=ur();return t.setUint32(0,r),t.setUint32(4,n),t.setUint32(8,i),t.setUint32(12,s),Object.assign(new Uint8Array(e),{__nonce__:void 0})}!function(e){e.Query="read",e.ReadState="read_state",e.Call="call"}(dr||(dr={})),function(e){e.Call="call"}(lr||(lr={})),function(e){e.Query="query",e.ReadState="read_state"}(fr||(fr={}));const pr="__expiry__",yr=BigInt(1e3),mr=BigInt(1e6),gr=BigInt(60),br=BigInt(90)*yr;function wr(e){return e/yr}class xr{constructor(e){this.__expiry__=e,this._isExpiry=!0}static fromDeltaInMilliseconds(e,t=0){const r=BigInt(e),n=BigInt(Date.now())+r+BigInt(t);let i;return i=r<br?wr(n):wr(n)/gr*gr,new xr(i*yr*mr)}toBigInt(){return this.__expiry__}toHash(){return be(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[pr]:this.toString()}}static fromJSON(e){const t=JSON.parse(e);if(t[pr])try{const e=BigInt(t[pr]);return new xr(e)}catch(e){throw new Pe(new bt(`Not a valid BigInt: ${e}`))}throw new Pe(new bt(`The input does not contain the key ${pr}`))}static isExpiry(e){return e instanceof xr||"object"==typeof e&&null!==e&&"_isExpiry"in e&&!0===e._isExpiry&&"__expiry__"in e&&"bigint"==typeof e.__expiry__}}function vr(e=hr){return async t=>{const r=t.request.headers;t.request.headers=r,t.endpoint===dr.Call&&(t.body.nonce=e())}}function _r(e){const t=[];return e.forEach((e,r)=>{t.push([r,e])}),t}function Er(e){try{return rr(e,e=>ce.isPrincipal(e)?e.toUint8Array():xr.isExpiry(e)?e.toBigInt():function(e){return"object"==typeof e&&null!==e&&"toCborValue"in e}(e)?e.toCborValue():e)}catch(t){throw Pe.fromCode(new He(t,e))}}function Ir(e){try{return function(e,t){jt=e,Mt=0;const r=Kt(t);return r}(e)}catch(t){throw Pe.fromCode(new ze(t,e))}}var Tr,Br;!function(e){e[e.SysFatal=1]="SysFatal",e[e.SysTransient=2]="SysTransient",e[e.DestinationInvalid=3]="DestinationInvalid",e[e.CanisterReject=4]="CanisterReject",e[e.CanisterError=5]="CanisterError"}(Tr||(Tr={})),function(e){e.Replied="replied",e.Rejected="rejected"}(Br||(Br={}));const Cr=BigInt(0),Sr=BigInt(1);function Nr(e,t=""){if("boolean"!=typeof e)throw new Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e}function Ar(e,t,r=""){const n=c(e),i=e?.length,s=void 0!==t;if(!n||s&&i!==t)throw new Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(n?`length=${i}`:"type="+typeof e));return e}function kr(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?Cr:BigInt("0x"+e)}function Or(e){return kr(g(e))}function Pr(e){return d(e),kr(g(Uint8Array.from(e).reverse()))}function Rr(e,t){return w(e.toString(16).padStart(2*t,"0"))}function Fr(e,t){return Rr(e,t).reverse()}function Dr(e,t,r){let n;if("string"==typeof t)try{n=w(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!c(t))throw new Error(e+" must be hex string or Uint8Array");n=Uint8Array.from(t)}const i=n.length;if("number"==typeof r&&i!==r)throw new Error(e+" of length "+r+" expected, got "+i);return n}function Ur(e){return Uint8Array.from(e)}const qr=e=>"bigint"==typeof e&&Cr<=e;function Vr(e,t,r){return qr(e)&&qr(t)&&qr(r)&&t<=e&&e<r}function Lr(e,t,r,n){if(!Vr(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function $r(e){let t;for(t=0;e>Cr;e>>=Sr,t+=1);return t}function jr(e,t){return e>>BigInt(t)&Sr}const Mr=e=>(Sr<<BigInt(e))-Sr;function Kr(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const i=e[t];if(n&&void 0===i)return;const s=typeof i;if(s!==r||null===i)throw new Error(`param "${t}" is invalid: expected ${r}, got ${s}`)}Object.entries(t).forEach(([e,t])=>n(e,t,!1)),Object.entries(r).forEach(([e,t])=>n(e,t,!0))}const Gr=()=>{throw new Error("not implemented")};function Zr(e){const t=new WeakMap;return(r,...n)=>{const i=t.get(r);if(void 0!==i)return i;const s=e(r,...n);return t.set(r,s),s}}const zr=BigInt(0),Hr=BigInt(1),Yr=BigInt(2),Wr=BigInt(3),Jr=BigInt(4),Xr=BigInt(5),Qr=BigInt(7),en=BigInt(8),tn=BigInt(9),rn=BigInt(16);function nn(e,t){const r=e%t;return r>=zr?r:t+r}function sn(e,t,r){let n=e;for(;t-- >zr;)n*=n,n%=r;return n}function on(e,t){if(e===zr)throw new Error("invert: expected non-zero number");if(t<=zr)throw new Error("invert: expected positive modulus, got "+t);let r=nn(e,t),n=t,i=zr,s=Hr,o=Hr,a=zr;for(;r!==zr;){const e=n/r,t=n%r,c=i-o*e,u=s-a*e;n=r,r=t,i=o,s=a,o=c,a=u}if(n!==Hr)throw new Error("invert: does not exist");return nn(i,t)}function an(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function cn(e,t){const r=(e.ORDER+Hr)/Jr,n=e.pow(t,r);return an(e,n,t),n}function un(e,t){const r=(e.ORDER-Xr)/en,n=e.mul(t,Yr),i=e.pow(n,r),s=e.mul(t,i),o=e.mul(e.mul(s,Yr),i),a=e.mul(s,e.sub(o,e.ONE));return an(e,a,t),a}function dn(e){if(e<Wr)throw new Error("sqrt is not defined for small field");let t=e-Hr,r=0;for(;t%Yr===zr;)t/=Yr,r++;let n=Yr;const i=gn(e);for(;1===mn(i,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return cn;let s=i.pow(n,t);const o=(t+Hr)/Yr;return function(e,n){if(e.is0(n))return n;if(1!==mn(e,n))throw new Error("Cannot find square root");let i=r,a=e.mul(e.ONE,s),c=e.pow(n,t),u=e.pow(n,o);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,r=e.sqr(c);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===i)throw new Error("Cannot find square root");const n=Hr<<BigInt(i-t-1),s=e.pow(a,n);i=t,a=e.sqr(s),c=e.mul(c,a),u=e.mul(u,s)}return u}}const ln=(e,t)=>(nn(e,t)&Hr)===Hr,fn=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hn(e){return Kr(e,fn.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),e}function pn(e,t,r){if(r<zr)throw new Error("invalid exponent, negatives unsupported");if(r===zr)return e.ONE;if(r===Hr)return t;let n=e.ONE,i=t;for(;r>zr;)r&Hr&&(n=e.mul(n,i)),i=e.sqr(i),r>>=Hr;return n}function yn(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),i=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),s=e.inv(i);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),s),n}function mn(e,t){const r=(e.ORDER-Hr)/Yr,n=e.pow(t,r),i=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function gn(e,t,r=!1,n={}){if(e<=zr)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o,a=!1;if("object"==typeof t&&null!=t){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(i=e.BITS),e.sqrt&&(s=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE),"boolean"==typeof e.modFromBytes&&(a=e.modFromBytes),o=e.allowedLengths}else"number"==typeof t&&(i=t),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:d}=function(e,t){void 0!==t&&u(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}(e,i);if(d>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const f=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:d,MASK:Mr(c),ZERO:zr,ONE:Hr,allowedLengths:o,create:t=>nn(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return zr<=t&&t<e},is0:e=>e===zr,isValidNot0:e=>!f.is0(e)&&f.isValid(e),isOdd:e=>(e&Hr)===Hr,neg:t=>nn(-t,e),eql:(e,t)=>e===t,sqr:t=>nn(t*t,e),add:(t,r)=>nn(t+r,e),sub:(t,r)=>nn(t-r,e),mul:(t,r)=>nn(t*r,e),pow:(e,t)=>pn(f,e,t),div:(t,r)=>nn(t*on(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>on(t,e),sqrt:s||(t=>{return l||(l=(r=e)%Jr===Wr?cn:r%en===Xr?un:r%rn===tn?function(e){const t=gn(e),r=dn(e),n=r(t,t.neg(t.ONE)),i=r(t,n),s=r(t,t.neg(n)),o=(e+Qr)/rn;return(e,t)=>{let r=e.pow(t,o),a=e.mul(r,n);const c=e.mul(r,i),u=e.mul(r,s),d=e.eql(e.sqr(a),t),l=e.eql(e.sqr(c),t);r=e.cmov(r,a,d),a=e.cmov(u,c,l);const f=e.eql(e.sqr(a),t),h=e.cmov(r,a,f);return an(e,h,t),h}}(r):dn(r)),l(f,t);var r}),toBytes:e=>r?Fr(e,d):Rr(e,d),fromBytes:(t,n=!0)=>{if(o){if(!o.includes(t.length)||t.length>d)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);const e=new Uint8Array(d);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==d)throw new Error("Field.fromBytes: expected "+d+" bytes, got "+t.length);let i=r?Pr(t):Or(t);if(a&&(i=nn(i,e)),!n&&!f.isValid(i))throw new Error("invalid field element: outside of range 0..ORDER");return i},invertBatch:e=>yn(f,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(f)}function bn(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function wn(e){const t=bn(e);return t+Math.ceil(t/2)}const xn=BigInt(0),vn=BigInt(1);function _n(e,t){const r=t.negate();return e?r:t}function En(e,t){const r=yn(e.Fp,t.map(e=>e.Z));return t.map((t,n)=>e.fromAffine(t.toAffine(r[n])))}function In(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Tn(e,t){In(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:Mr(e),maxNumber:r,shiftBy:BigInt(e)}}function Bn(e,t,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(e&i),c=e>>o;a>n&&(a-=s,c+=vn);const u=t*n;return{nextN:c,offset:u+Math.abs(a)-1,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:u}}const Cn=new WeakMap,Sn=new WeakMap;function Nn(e){return Sn.get(e)||1}function An(e){if(e!==xn)throw new Error("invalid wNAF")}class kn{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let n=e;for(;t>xn;)t&vn&&(r=r.add(n)),n=n.double(),t>>=vn;return r}precomputeWindow(e,t){const{windows:r,windowSize:n}=Tn(t,this.bits),i=[];let s=e,o=s;for(let e=0;e<r;e++){o=s,i.push(o);for(let e=1;e<n;e++)o=o.add(s),i.push(o);s=o.double()}return i}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let n=this.ZERO,i=this.BASE;const s=Tn(e,this.bits);for(let e=0;e<s.windows;e++){const{nextN:o,offset:a,isZero:c,isNeg:u,isNegF:d,offsetF:l}=Bn(r,e,s);r=o,c?i=i.add(_n(d,t[l])):n=n.add(_n(u,t[a]))}return An(r),{p:n,f:i}}wNAFUnsafe(e,t,r,n=this.ZERO){const i=Tn(e,this.bits);for(let e=0;e<i.windows&&r!==xn;e++){const{nextN:s,offset:o,isZero:a,isNeg:c}=Bn(r,e,i);if(r=s,!a){const e=t[o];n=n.add(c?e.negate():e)}}return An(r),n}getPrecomputes(e,t,r){let n=Cn.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),Cn.set(t,n))),n}cached(e,t,r){const n=Nn(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)}unsafe(e,t,r,n){const i=Nn(e);return 1===i?this._unsafeLadder(e,t,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),t,n)}createCache(e,t){In(t,this.bits),Sn.set(e,t),Cn.delete(e)}hasCache(e){return 1!==Nn(e)}}function On(e,t,r,n){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}(n,t);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=$r(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Mr(c),d=new Array(Number(u)+1).fill(o);let l=o;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){d.fill(o);for(let t=0;t<s;t++){const i=n[t],s=Number(i>>BigInt(e)&u);d[s]=d[s].add(r[t])}let t=o;for(let e=d.length-1,r=o;e>0;e--)r=r.add(d[e]),t=t.add(r);if(l=l.add(t),0!==e)for(let e=0;e<c;e++)l=l.double()}return l}function Pn(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return hn(t),t}return gn(e,{isLE:r})}function Rn(e,t,r={},n){if(void 0===n&&(n="edwards"===e),!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const r=t[e];if(!("bigint"==typeof r&&r>xn))throw new Error(`CURVE.${e} must be positive bigint`)}const i=Pn(t.p,r.Fp,n),s=Pn(t.n,r.Fn,n),o=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of o)if(!i.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:i,Fn:s}}const Fn=Or;function Dn(e,t){if(qn(e),qn(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=255&e,e>>>=8;return new Uint8Array(r)}function Un(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function qn(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function Vn(e){if(!c(e)&&"string"!=typeof e)throw new Error("DST must be Uint8Array or string");return"string"==typeof e?x(e):e}function Ln(e,t,r){Kr(r,{p:"bigint",m:"number",k:"number",hash:"function"});const{p:n,k:i,m:s,hash:o,expand:a,DST:c}=r;if("function"!=typeof(u=r.hash)||!Number.isSafeInteger(u.outputLen))throw new Error("expected valid hash");var u;d(e),qn(t);const l=n.toString(2).length,f=Math.ceil((l+i)/8),h=t*s*f;let p;if("xmd"===a)p=function(e,t,r,n){d(e),qn(r),(t=Vn(t)).length>255&&(t=n(_(x("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:s}=n,o=Math.ceil(r/i);if(r>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=_(t,Dn(t.length,1)),c=Dn(0,s),u=Dn(r,2),l=new Array(o),f=n(_(c,e,u,Dn(0,1),a));l[0]=n(_(f,Dn(1,1),a));for(let e=1;e<=o;e++){const t=[Un(f,l[e-1]),Dn(e+1,1),a];l[e]=n(_(...t))}return _(...l).slice(0,r)}(e,c,h,o);else if("xof"===a)p=function(e,t,r,n,i){if(d(e),qn(r),(t=Vn(t)).length>255){const e=Math.ceil(2*n/8);t=i.create({dkLen:e}).update(x("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:r}).update(e).update(Dn(r,2)).update(t).update(Dn(t.length,1)).digest()}(e,c,h,i,o);else{if("_internal_pass"!==a)throw new Error('expand must be "xmd" or "xof"');p=e}const y=new Array(t);for(let e=0;e<t;e++){const t=new Array(s);for(let r=0;r<s;r++){const i=f*(r+e*s),o=p.subarray(i,i+f);t[r]=nn(Fn(o),n)}y[e]=t}return y}function $n(e,t){const r=t.map(e=>Array.from(e).reverse());return(t,n)=>{const[i,s,o,a]=r.map(r=>r.reduce((r,n)=>e.add(e.mul(r,t),n))),[c,u]=yn(e,[s,a],!0);return t=e.mul(i,c),n=e.mul(n,e.mul(o,u)),{x:t,y:n}}}const jn=x("HashToScalar-");function Mn(e,t,r){if("function"!=typeof t)throw new Error("mapToCurve() must be defined");function n(r){return e.fromAffine(t(r))}function i(t){const r=t.clearCofactor();return r.equals(e.ZERO)?e.ZERO:(r.assertValidity(),r)}return{defaults:r,hashToCurve(e,t){const s=Ln(e,2,Object.assign({},r,t)),o=n(s[0]),a=n(s[1]);return i(o.add(a))},encodeToCurve(e,t){const s=r.encodeDST?{DST:r.encodeDST}:{};return i(n(Ln(e,1,Object.assign({},r,s,t))[0]))},mapToCurve(e){if(!Array.isArray(e))throw new Error("expected array of bigints");for(const t of e)if("bigint"!=typeof t)throw new Error("expected array of bigints");return i(n(e))},hashToScalar(t,n){const i=e.Fn.ORDER;return Ln(t,1,Object.assign({},r,{p:i,m:1,DST:jn},n))[0][0]}}}const Kn=(e,t)=>(e+(e>=0?t:-t)/zn)/t;Error;const Gn=BigInt(0),Zn=BigInt(1),zn=BigInt(2),Hn=BigInt(3),Yn=BigInt(4);function Wn(e,t){const{BYTES:r}=e;let n;if("bigint"==typeof t)n=t;else{let i=Dr("private key",t);try{n=e.fromBytes(i)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Jn(e,t={}){const r=Rn("weierstrass",e,t),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Kr(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!n.is0(s.a)||"bigint"!=typeof c.beta||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=function(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}(n,i);function d(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const l=t.toBytes||function(e,t,r){const{x:i,y:s}=t.toAffine(),o=n.toBytes(i);return Nr(r,"isCompressed"),r?(d(),_((a=!n.isOdd(s),Uint8Array.of(a?2:3)),o)):_(Uint8Array.of(4),o,n.toBytes(s));var a},f=t.fromBytes||function(e){Ar(e,void 0,"Point");const{publicKey:t,publicKeyUncompressed:r}=u,i=e.length,s=e[0],o=e.subarray(1);if(i!==t||2!==s&&3!==s){if(i===r&&4===s){const e=n.BYTES,t=n.fromBytes(o.subarray(0,e)),r=n.fromBytes(o.subarray(e,2*e));if(!p(t,r))throw new Error("bad point: is not on curve");return{x:t,y:r}}throw new Error(`bad point: got length ${i}, expected compressed=${t} or uncompressed=${r}`)}{const e=n.fromBytes(o);if(!n.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=h(e);let r;try{r=n.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}return d(),!(1&~s)!==n.isOdd(r)&&(r=n.neg(r)),{x:e,y:r}}};function h(e){const t=n.sqr(e),r=n.mul(t,e);return n.add(n.add(r,n.mul(e,s.a)),s.b)}function p(e,t){const r=n.sqr(t),i=h(e);return n.eql(r,i)}if(!p(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const y=n.mul(n.pow(s.a,Hn),Yn),m=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(y,m)))throw new Error("bad curve params: a or b");function b(e,t,r=!1){if(!n.isValid(t)||r&&n.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function w(e){if(!(e instanceof T))throw new Error("ProjectivePoint expected")}function x(e){if(!c||!c.basises)throw new Error("no endo");return function(e,t,r){const[[n,i],[s,o]]=t,a=Kn(o*e,r),c=Kn(-i*e,r);let u=e-a*n-c*s,d=-a*i-c*o;const l=u<Gn,f=d<Gn;l&&(u=-u),f&&(d=-d);const h=Mr(Math.ceil($r(r)/2))+Zn;if(u<Gn||u>=h||d<Gn||d>=h)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:l,k1:u,k2neg:f,k2:d}}(e,c.basises,i.ORDER)}const v=Zr((e,t)=>{const{X:r,Y:i,Z:s}=e;if(n.eql(s,n.ONE))return{x:r,y:i};const o=e.is0();null==t&&(t=o?n.ONE:n.inv(s));const a=n.mul(r,t),c=n.mul(i,t),u=n.mul(s,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),E=Zr(e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.Y))return;throw new Error("bad point: ZERO")}const{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw new Error("bad point: x or y not field elements");if(!p(r,i))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function I(e,t,r,i,s){return r=new T(n.mul(r.X,e),r.Y,r.Z),t=_n(i,t),r=_n(s,r),t.add(r)}class T{constructor(e,t,r){this.X=b("x",e),this.Y=b("y",t,!0),this.Z=b("z",r),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof T)throw new Error("projective point not allowed");return n.is0(t)&&n.is0(r)?T.ZERO:new T(t,r,n.ONE)}static fromBytes(e){const t=T.fromAffine(f(Ar(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return T.fromBytes(Dr("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return C.createCache(this,e),t||this.multiply(Hn),this}assertValidity(){E(this)}hasEvenY(){const{y:e}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(e)}equals(e){w(e);const{X:t,Y:r,Z:i}=this,{X:s,Y:o,Z:a}=e,c=n.eql(n.mul(t,a),n.mul(s,i)),u=n.eql(n.mul(r,a),n.mul(o,i));return c&&u}negate(){return new T(this.X,n.neg(this.Y),this.Z)}double(){const{a:e,b:t}=s,r=n.mul(t,Hn),{X:i,Y:o,Z:a}=this;let c=n.ZERO,u=n.ZERO,d=n.ZERO,l=n.mul(i,i),f=n.mul(o,o),h=n.mul(a,a),p=n.mul(i,o);return p=n.add(p,p),d=n.mul(i,a),d=n.add(d,d),c=n.mul(e,d),u=n.mul(r,h),u=n.add(c,u),c=n.sub(f,u),u=n.add(f,u),u=n.mul(c,u),c=n.mul(p,c),d=n.mul(r,d),h=n.mul(e,h),p=n.sub(l,h),p=n.mul(e,p),p=n.add(p,d),d=n.add(l,l),l=n.add(d,l),l=n.add(l,h),l=n.mul(l,p),u=n.add(u,l),h=n.mul(o,a),h=n.add(h,h),l=n.mul(h,p),c=n.sub(c,l),d=n.mul(h,f),d=n.add(d,d),d=n.add(d,d),new T(c,u,d)}add(e){w(e);const{X:t,Y:r,Z:i}=this,{X:o,Y:a,Z:c}=e;let u=n.ZERO,d=n.ZERO,l=n.ZERO;const f=s.a,h=n.mul(s.b,Hn);let p=n.mul(t,o),y=n.mul(r,a),m=n.mul(i,c),g=n.add(t,r),b=n.add(o,a);g=n.mul(g,b),b=n.add(p,y),g=n.sub(g,b),b=n.add(t,i);let x=n.add(o,c);return b=n.mul(b,x),x=n.add(p,m),b=n.sub(b,x),x=n.add(r,i),u=n.add(a,c),x=n.mul(x,u),u=n.add(y,m),x=n.sub(x,u),l=n.mul(f,b),u=n.mul(h,m),l=n.add(u,l),u=n.sub(y,l),l=n.add(y,l),d=n.mul(u,l),y=n.add(p,p),y=n.add(y,p),m=n.mul(f,m),b=n.mul(h,b),y=n.add(y,m),m=n.sub(p,m),m=n.mul(f,m),b=n.add(b,m),p=n.mul(y,b),d=n.add(d,p),p=n.mul(x,b),u=n.mul(g,u),u=n.sub(u,p),p=n.mul(g,y),l=n.mul(x,l),l=n.add(l,p),new T(u,d,l)}subtract(e){return this.add(e.negate())}is0(){return this.equals(T.ZERO)}multiply(e){const{endo:r}=t;if(!i.isValidNot0(e))throw new Error("invalid scalar: out of range");let n,s;const o=e=>C.cached(this,e,e=>En(T,e));if(r){const{k1neg:t,k1:i,k2neg:a,k2:c}=x(e),{p:u,f:d}=o(i),{p:l,f}=o(c);s=d.add(f),n=I(r.beta,u,l,t,a)}else{const{p:t,f:r}=o(e);n=t,s=r}return En(T,[n,s])[0]}multiplyUnsafe(e){const{endo:r}=t,n=this;if(!i.isValid(e))throw new Error("invalid scalar: out of range");if(e===Gn||n.is0())return T.ZERO;if(e===Zn)return n;if(C.hasCache(this))return this.multiply(e);if(r){const{k1neg:t,k1:i,k2neg:s,k2:o}=x(e),{p1:a,p2:c}=function(e,t,r,n){let i=t,s=e.ZERO,o=e.ZERO;for(;r>xn||n>xn;)r&vn&&(s=s.add(i)),n&vn&&(o=o.add(i)),i=i.double(),r>>=vn,n>>=vn;return{p1:s,p2:o}}(T,n,i,o);return I(r.beta,a,c,t,s)}return C.unsafe(n,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return v(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return o===Zn||(e?e(T,this):C.unsafe(this,a).is0())}clearCofactor(){const{clearCofactor:e}=t;return o===Zn?this:e?e(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(e=!0){return Nr(e,"isCompressed"),this.assertValidity(),l(T,this,e)}toHex(e=!0){return g(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return En(T,e)}static msm(e,t){return On(T,i,e,t)}static fromPrivateKey(e){return T.BASE.multiply(Wn(i,e))}}T.BASE=new T(s.Gx,s.Gy,n.ONE),T.ZERO=new T(n.ZERO,n.ONE,n.ZERO),T.Fp=n,T.Fn=i;const B=i.BITS,C=new kn(T,t.endo?Math.ceil(B/2):B);return T.BASE.precompute(8),T}function Xn(e,t){hn(e);const{A:r,B:n,Z:i}=t;if(!e.isValid(r)||!e.isValid(n)||!e.isValid(i))throw new Error("mapToCurveSimpleSWU: invalid opts");const s=function(e,t){const r=e.ORDER;let n=Gn;for(let e=r-Zn;e%zn===Gn;e/=zn)n+=Zn;const i=n,s=zn<<i-Zn-Zn,o=s*zn,a=(r-Zn)/o,c=(a-Zn)/zn,u=o-Zn,d=s,l=e.pow(t,a),f=e.pow(t,(a+Zn)/zn);let h=(t,r)=>{let n=l,s=e.pow(r,u),o=e.sqr(s);o=e.mul(o,r);let a=e.mul(t,o);a=e.pow(a,c),a=e.mul(a,s),s=e.mul(a,r),o=e.mul(a,t);let h=e.mul(o,s);a=e.pow(h,d);let p=e.eql(a,e.ONE);s=e.mul(o,f),a=e.mul(h,n),o=e.cmov(s,o,p),h=e.cmov(a,h,p);for(let t=i;t>Zn;t--){let r=t-zn;r=zn<<r-Zn;let i=e.pow(h,r);const a=e.eql(i,e.ONE);s=e.mul(o,n),n=e.mul(n,n),i=e.mul(h,n),o=e.cmov(s,o,a),h=e.cmov(i,h,a)}return{isValid:p,value:o}};if(e.ORDER%Yn===Hn){const r=(e.ORDER-Hn)/Yn,n=e.sqrt(e.neg(t));h=(t,i)=>{let s=e.sqr(i);const o=e.mul(t,i);s=e.mul(s,o);let a=e.pow(s,r);a=e.mul(a,o);const c=e.mul(a,n),u=e.mul(e.sqr(a),i),d=e.eql(u,t);return{isValid:d,value:e.cmov(c,a,d)}}}return h}(e,i);if(!e.isOdd)throw new Error("Field does not have .isOdd()");return t=>{let o,a,c,u,d,l,f,h;o=e.sqr(t),o=e.mul(o,i),a=e.sqr(o),a=e.add(a,o),c=e.add(a,e.ONE),c=e.mul(c,n),u=e.cmov(i,e.neg(a),!e.eql(a,e.ZERO)),u=e.mul(u,r),a=e.sqr(c),l=e.sqr(u),d=e.mul(l,r),a=e.add(a,d),a=e.mul(a,c),l=e.mul(l,u),d=e.mul(l,n),a=e.add(a,d),f=e.mul(o,c);const{isValid:p,value:y}=s(a,l);h=e.mul(o,t),h=e.mul(h,y),f=e.cmov(f,c,p),h=e.cmov(h,y,p);const m=e.isOdd(t)===e.isOdd(h);h=e.cmov(e.neg(h),h,m);const g=yn(e,[u],!0)[0];return f=e.mul(f,g),{x:f,y:h}}}function Qn(e){const{CURVE:t,curveOpts:r}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp;let n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0;return{CURVE:t,curveOpts:{Fp:r,Fn:gn(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e);return function(e,t){const{Fp:r,Fn:n}=t;const i=function(e,t,r){return function(n){const i=e.sqr(n),s=e.mul(i,n);return e.add(e.add(s,e.mul(n,t)),r)}}(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:e=>Wn(n,e),weierstrassEquation:i,isWithinCurveOrder:function(e){return Vr(e,Zn,n.ORDER)}})}(e,Jn(t,r))}const ei=BigInt(0),ti=BigInt(1),ri=BigInt(2),ni=BigInt(3);function ii(e){if(!Array.isArray(e)||0===e.length)throw new Error("expected non-empty array")}function si(e,t,r,n,i){const{Fp12:s,pairingBatch:o}=e;function a(e){return e instanceof t.Point?e:t.Point.fromHex(e)}function c(e){return e instanceof r.Point?e:r.Point.fromHex(e)}function u(e){if(!(e instanceof r.Point))throw new Error(`expected valid message hashed to ${i?"G1":"G2"} curve`);return e}const l=i?(e,t)=>({g1:t,g2:e}):(e,t)=>({g1:e,g2:t});return{getPublicKey(e){const r=Wn(t.Point.Fn,e);return t.Point.BASE.multiply(r)},sign(e,r,n){if(null!=n)throw new Error("sign() expects 2 arguments");const i=Wn(t.Point.Fn,r);return u(e).assertValidity(),e.multiply(i)},verify(e,r,n,i){if(null!=i)throw new Error("verify() expects 3 arguments");e=c(e);const d=(n=a(n)).negate(),f=t.Point.BASE,h=u(r),p=e,y=o([l(d,h),l(f,p)]);return s.eql(y,s.ONE)},verifyBatch(e,r,n){if(ii(r),n.length!==r.length)throw new Error("amount of public keys and messages should be equal");const i=c(e),u=r,d=n.map(a),f=new Map;for(let e=0;e<d.length;e++){const t=d[e],r=u[e];let n=f.get(r);void 0===n&&(n=[],f.set(r,n)),n.push(t)}const h=[],p=t.Point.BASE;try{for(const[e,t]of f){const r=t.reduce((e,t)=>e.add(t));h.push(l(r,e))}return h.push(l(p.negate(),i)),s.eql(o(h),s.ONE)}catch{return!1}},aggregatePublicKeys(e){ii(e);const r=(e=e.map(e=>a(e))).reduce((e,t)=>e.add(t),t.Point.ZERO);return r.assertValidity(),r},aggregateSignatures(e){ii(e);const t=(e=e.map(e=>c(e))).reduce((e,t)=>e.add(t),r.Point.ZERO);return t.assertValidity(),t},hash(e,t){d(e);const n=t?{DST:t}:void 0;return r.hashToCurve(e,n)},Signature:n}}const oi=BigInt(0),ai=BigInt(1),ci=BigInt(2),ui=BigInt(3);function di(e,t,r,n,i=1,s){const o=BigInt(void 0===s?n:s),a=r**BigInt(n),c=[];for(let s=0;s<i;s++){const i=BigInt(s+1),u=[];for(let s=0,c=ai;s<n;s++){const n=(i*c-i)/o%a;u.push(e.pow(t,n)),c*=r}c.push(u)}return c}const li=(e,t)=>{if(2!==t.length)throw new Error("invalid tuple");const r=t.map(t=>e.create(t));return{c0:r[0],c1:r[1]}};class fi{constructor(e,t={}){this.MASK=ai;const r=e.ORDER,n=r*r;this.Fp=e,this.ORDER=n,this.BITS=$r(n),this.BYTES=Math.ceil($r(n)/8),this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.Fp_NONRESIDUE=e.create(t.NONRESIDUE||BigInt(-1)),this.Fp_div2=e.div(e.ONE,ci),this.NONRESIDUE=li(e,t.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=di(e,this.Fp_NONRESIDUE,e.ORDER,2)[0],this.mulByB=t.Fp2mulByB,Object.seal(this)}fromBigTuple(e){return li(this.Fp,e)}create(e){return e}isValid({c0:e,c1:t}){function r(e,t){return"bigint"==typeof e&&oi<=e&&e<t}return r(e,this.ORDER)&&r(t,this.ORDER)}is0({c0:e,c1:t}){return this.Fp.is0(e)&&this.Fp.is0(t)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}eql({c0:e,c1:t},{c0:r,c1:n}){return this.Fp.eql(e,r)&&this.Fp.eql(t,n)}neg({c0:e,c1:t}){return{c0:this.Fp.neg(e),c1:this.Fp.neg(t)}}pow(e,t){return pn(this,e,t)}invertBatch(e){return yn(this,e)}add(e,t){const{c0:r,c1:n}=e,{c0:i,c1:s}=t;return{c0:this.Fp.add(r,i),c1:this.Fp.add(n,s)}}sub({c0:e,c1:t},{c0:r,c1:n}){return{c0:this.Fp.sub(e,r),c1:this.Fp.sub(t,n)}}mul({c0:e,c1:t},r){const{Fp:n}=this;if("bigint"==typeof r)return{c0:n.mul(e,r),c1:n.mul(t,r)};const{c0:i,c1:s}=r;let o=n.mul(e,i),a=n.mul(t,s);return{c0:n.sub(o,a),c1:n.sub(n.mul(n.add(e,t),n.add(i,s)),n.add(o,a))}}sqr({c0:e,c1:t}){const{Fp:r}=this,n=r.add(e,t),i=r.sub(e,t),s=r.add(e,e);return{c0:r.mul(n,i),c1:r.mul(s,t)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}div(e,t){const{Fp:r}=this;return this.mul(e,"bigint"==typeof t?r.inv(r.create(t)):this.inv(t))}inv({c0:e,c1:t}){const{Fp:r}=this,n=r.inv(r.create(e*e+t*t));return{c0:r.mul(n,r.create(e)),c1:r.mul(n,r.create(-t))}}sqrt(e){const{Fp:t}=this,r=this,{c0:n,c1:i}=e;if(t.is0(i))return 1===mn(t,n)?r.create({c0:t.sqrt(n),c1:t.ZERO}):r.create({c0:t.ZERO,c1:t.sqrt(t.div(n,this.Fp_NONRESIDUE))});const s=t.sqrt(t.sub(t.sqr(n),t.mul(t.sqr(i),this.Fp_NONRESIDUE)));let o=t.mul(t.add(s,n),this.Fp_div2);-1===mn(t,o)&&(o=t.sub(o,s));const a=t.sqrt(o),c=r.create({c0:a,c1:t.div(t.mul(i,this.Fp_div2),a)});if(!r.eql(r.sqr(c),e))throw new Error("Cannot find square root");const u=c,d=r.neg(u),{re:l,im:f}=r.reim(u),{re:h,im:p}=r.reim(d);return f>p||f===p&&l>h?u:d}isOdd(e){const{re:t,im:r}=this.reim(e);return BigInt(t%ci||t===oi&&r%ci)==ai}fromBytes(e){const{Fp:t}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:t.fromBytes(e.subarray(0,t.BYTES)),c1:t.fromBytes(e.subarray(t.BYTES))}}toBytes({c0:e,c1:t}){return _(this.Fp.toBytes(e),this.Fp.toBytes(t))}cmov({c0:e,c1:t},{c0:r,c1:n},i){return{c0:this.Fp.cmov(e,r,i),c1:this.Fp.cmov(t,n,i)}}reim({c0:e,c1:t}){return{re:e,im:t}}Fp4Square(e,t){const r=this,n=r.sqr(e),i=r.sqr(t);return{first:r.add(r.mulByNonresidue(i),n),second:r.sub(r.sub(r.sqr(r.add(e,t)),n),i)}}mulByNonresidue({c0:e,c1:t}){return this.mul({c0:e,c1:t},this.NONRESIDUE)}frobeniusMap({c0:e,c1:t},r){return{c0:e,c1:this.Fp.mul(t,this.FROBENIUS_COEFFICIENTS[r%2])}}}class hi{constructor(e){this.MASK=ai,this.Fp2=e,this.ORDER=e.ORDER,this.BITS=3*e.BITS,this.BYTES=3*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO,c2:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO,c2:e.ZERO};const{Fp:t}=e,r=di(e,e.NONRESIDUE,t.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=r[0],this.FROBENIUS_COEFFICIENTS_2=r[1],Object.seal(this)}add({c0:e,c1:t,c2:r},{c0:n,c1:i,c2:s}){const{Fp2:o}=this;return{c0:o.add(e,n),c1:o.add(t,i),c2:o.add(r,s)}}sub({c0:e,c1:t,c2:r},{c0:n,c1:i,c2:s}){const{Fp2:o}=this;return{c0:o.sub(e,n),c1:o.sub(t,i),c2:o.sub(r,s)}}mul({c0:e,c1:t,c2:r},n){const{Fp2:i}=this;if("bigint"==typeof n)return{c0:i.mul(e,n),c1:i.mul(t,n),c2:i.mul(r,n)};const{c0:s,c1:o,c2:a}=n,c=i.mul(e,s),u=i.mul(t,o),d=i.mul(r,a);return{c0:i.add(c,i.mulByNonresidue(i.sub(i.mul(i.add(t,r),i.add(o,a)),i.add(u,d)))),c1:i.add(i.sub(i.mul(i.add(e,t),i.add(s,o)),i.add(c,u)),i.mulByNonresidue(d)),c2:i.sub(i.add(u,i.mul(i.add(e,r),i.add(s,a))),i.add(c,d))}}sqr({c0:e,c1:t,c2:r}){const{Fp2:n}=this;let i=n.sqr(e),s=n.mul(n.mul(e,t),ci),o=n.mul(n.mul(t,r),ci),a=n.sqr(r);return{c0:n.add(n.mulByNonresidue(o),i),c1:n.add(n.mulByNonresidue(a),s),c2:n.sub(n.sub(n.add(n.add(s,n.sqr(n.add(n.sub(e,t),r))),o),i),a)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}create(e){return e}isValid({c0:e,c1:t,c2:r}){const{Fp2:n}=this;return n.isValid(e)&&n.isValid(t)&&n.isValid(r)}is0({c0:e,c1:t,c2:r}){const{Fp2:n}=this;return n.is0(e)&&n.is0(t)&&n.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:t,c2:r}){const{Fp2:n}=this;return{c0:n.neg(e),c1:n.neg(t),c2:n.neg(r)}}eql({c0:e,c1:t,c2:r},{c0:n,c1:i,c2:s}){const{Fp2:o}=this;return o.eql(e,n)&&o.eql(t,i)&&o.eql(r,s)}sqrt(e){return Gr()}div(e,t){const{Fp2:r}=this,{Fp:n}=r;return this.mul(e,"bigint"==typeof t?n.inv(n.create(t)):this.inv(t))}pow(e,t){return pn(this,e,t)}invertBatch(e){return yn(this,e)}inv({c0:e,c1:t,c2:r}){const{Fp2:n}=this;let i=n.sub(n.sqr(e),n.mulByNonresidue(n.mul(r,t))),s=n.sub(n.mulByNonresidue(n.sqr(r)),n.mul(e,t)),o=n.sub(n.sqr(t),n.mul(e,r)),a=n.inv(n.add(n.mulByNonresidue(n.add(n.mul(r,s),n.mul(t,o))),n.mul(e,i)));return{c0:n.mul(a,i),c1:n.mul(a,s),c2:n.mul(a,o)}}fromBytes(e){const{Fp2:t}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);const r=t.BYTES;return{c0:t.fromBytes(e.subarray(0,r)),c1:t.fromBytes(e.subarray(r,2*r)),c2:t.fromBytes(e.subarray(2*r))}}toBytes({c0:e,c1:t,c2:r}){const{Fp2:n}=this;return _(n.toBytes(e),n.toBytes(t),n.toBytes(r))}cmov({c0:e,c1:t,c2:r},{c0:n,c1:i,c2:s},o){const{Fp2:a}=this;return{c0:a.cmov(e,n,o),c1:a.cmov(t,i,o),c2:a.cmov(r,s,o)}}fromBigSix(e){const{Fp2:t}=this;if(!Array.isArray(e)||6!==e.length)throw new Error("invalid Fp6 usage");return{c0:t.fromBigTuple(e.slice(0,2)),c1:t.fromBigTuple(e.slice(2,4)),c2:t.fromBigTuple(e.slice(4,6))}}frobeniusMap({c0:e,c1:t,c2:r},n){const{Fp2:i}=this;return{c0:i.frobeniusMap(e,n),c1:i.mul(i.frobeniusMap(t,n),this.FROBENIUS_COEFFICIENTS_1[n%6]),c2:i.mul(i.frobeniusMap(r,n),this.FROBENIUS_COEFFICIENTS_2[n%6])}}mulByFp2({c0:e,c1:t,c2:r},n){const{Fp2:i}=this;return{c0:i.mul(e,n),c1:i.mul(t,n),c2:i.mul(r,n)}}mulByNonresidue({c0:e,c1:t,c2:r}){const{Fp2:n}=this;return{c0:n.mulByNonresidue(r),c1:e,c2:t}}mul1({c0:e,c1:t,c2:r},n){const{Fp2:i}=this;return{c0:i.mulByNonresidue(i.mul(r,n)),c1:i.mul(e,n),c2:i.mul(t,n)}}mul01({c0:e,c1:t,c2:r},n,i){const{Fp2:s}=this;let o=s.mul(e,n),a=s.mul(t,i);return{c0:s.add(s.mulByNonresidue(s.sub(s.mul(s.add(t,r),i),a)),o),c1:s.sub(s.sub(s.mul(s.add(n,i),s.add(e,t)),o),a),c2:s.add(s.sub(s.mul(s.add(e,r),n),o),a)}}}class pi{constructor(e,t){this.MASK=ai;const{Fp2:r}=e,{Fp:n}=r;this.Fp6=e,this.ORDER=r.ORDER,this.BITS=2*e.BITS,this.BYTES=2*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.FROBENIUS_COEFFICIENTS=di(r,r.NONRESIDUE,n.ORDER,12,1,6)[0],this.X_LEN=t.X_LEN,this.finalExponentiate=t.Fp12finalExponentiate}create(e){return e}isValid({c0:e,c1:t}){const{Fp6:r}=this;return r.isValid(e)&&r.isValid(t)}is0({c0:e,c1:t}){const{Fp6:r}=this;return r.is0(e)&&r.is0(t)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:t}){const{Fp6:r}=this;return{c0:r.neg(e),c1:r.neg(t)}}eql({c0:e,c1:t},{c0:r,c1:n}){const{Fp6:i}=this;return i.eql(e,r)&&i.eql(t,n)}sqrt(e){Gr()}inv({c0:e,c1:t}){const{Fp6:r}=this;let n=r.inv(r.sub(r.sqr(e),r.mulByNonresidue(r.sqr(t))));return{c0:r.mul(e,n),c1:r.neg(r.mul(t,n))}}div(e,t){const{Fp6:r}=this,{Fp2:n}=r,{Fp:i}=n;return this.mul(e,"bigint"==typeof t?i.inv(i.create(t)):this.inv(t))}pow(e,t){return pn(this,e,t)}invertBatch(e){return yn(this,e)}add({c0:e,c1:t},{c0:r,c1:n}){const{Fp6:i}=this;return{c0:i.add(e,r),c1:i.add(t,n)}}sub({c0:e,c1:t},{c0:r,c1:n}){const{Fp6:i}=this;return{c0:i.sub(e,r),c1:i.sub(t,n)}}mul({c0:e,c1:t},r){const{Fp6:n}=this;if("bigint"==typeof r)return{c0:n.mul(e,r),c1:n.mul(t,r)};let{c0:i,c1:s}=r,o=n.mul(e,i),a=n.mul(t,s);return{c0:n.add(o,n.mulByNonresidue(a)),c1:n.sub(n.mul(n.add(e,t),n.add(i,s)),n.add(o,a))}}sqr({c0:e,c1:t}){const{Fp6:r}=this;let n=r.mul(e,t);return{c0:r.sub(r.sub(r.mul(r.add(r.mulByNonresidue(t),e),r.add(e,t)),n),r.mulByNonresidue(n)),c1:r.add(n,n)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}fromBytes(e){const{Fp6:t}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:t.fromBytes(e.subarray(0,t.BYTES)),c1:t.fromBytes(e.subarray(t.BYTES))}}toBytes({c0:e,c1:t}){const{Fp6:r}=this;return _(r.toBytes(e),r.toBytes(t))}cmov({c0:e,c1:t},{c0:r,c1:n},i){const{Fp6:s}=this;return{c0:s.cmov(e,r,i),c1:s.cmov(t,n,i)}}fromBigTwelve(e){const{Fp6:t}=this;return{c0:t.fromBigSix(e.slice(0,6)),c1:t.fromBigSix(e.slice(6,12))}}frobeniusMap(e,t){const{Fp6:r}=this,{Fp2:n}=r,{c0:i,c1:s,c2:o}=r.frobeniusMap(e.c1,t),a=this.FROBENIUS_COEFFICIENTS[t%12];return{c0:r.frobeniusMap(e.c0,t),c1:r.create({c0:n.mul(i,a),c1:n.mul(s,a),c2:n.mul(o,a)})}}mulByFp2({c0:e,c1:t},r){const{Fp6:n}=this;return{c0:n.mulByFp2(e,r),c1:n.mulByFp2(t,r)}}conjugate({c0:e,c1:t}){return{c0:e,c1:this.Fp6.neg(t)}}mul014({c0:e,c1:t},r,n,i){const{Fp6:s}=this,{Fp2:o}=s;let a=s.mul01(e,r,n),c=s.mul1(t,i);return{c0:s.add(s.mulByNonresidue(c),a),c1:s.sub(s.sub(s.mul01(s.add(t,e),r,o.add(n,i)),a),c)}}mul034({c0:e,c1:t},r,n,i){const{Fp6:s}=this,{Fp2:o}=s,a=s.create({c0:o.mul(e.c0,r),c1:o.mul(e.c1,r),c2:o.mul(e.c2,r)}),c=s.mul01(t,n,i),u=s.mul01(s.add(e,t),o.add(r,n),i);return{c0:s.add(s.mulByNonresidue(c),a),c1:s.sub(u,s.add(a,c))}}_cyclotomicSquare({c0:e,c1:t}){const{Fp6:r}=this,{Fp2:n}=r,{c0:i,c1:s,c2:o}=e,{c0:a,c1:c,c2:u}=t,{first:d,second:l}=n.Fp4Square(i,c),{first:f,second:h}=n.Fp4Square(a,o),{first:p,second:y}=n.Fp4Square(s,u),m=n.mulByNonresidue(y);return{c0:r.create({c0:n.add(n.mul(n.sub(d,i),ci),d),c1:n.add(n.mul(n.sub(f,s),ci),f),c2:n.add(n.mul(n.sub(p,o),ci),p)}),c1:r.create({c0:n.add(n.mul(n.add(m,a),ci),m),c1:n.add(n.mul(n.add(l,c),ci),l),c2:n.add(n.mul(n.add(h,u),ci),h)})}}_cyclotomicExp(e,t){let r=this.ONE;for(let n=this.X_LEN-1;n>=0;n--)r=this._cyclotomicSquare(r),jr(t,n)&&(r=this.mul(r,e));return r}}const yi=BigInt(0),mi=BigInt(1),gi=BigInt(2),bi=BigInt(3),wi=BigInt(4),xi=BigInt("0xd201000000010000"),vi=$r(xi),_i={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:yi,b:wi,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},Ei=gn(_i.n,{modFromBytes:!0,isLE:!0}),{Fp:Ii,Fp2:Ti,Fp6:Bi,Fp12:Ci}=function(e){const t=gn(e.ORDER),r=new fi(t,e),n=new hi(r);return{Fp:t,Fp2:r,Fp6:n,Fp12:new pi(n,e)}}({ORDER:_i.p,X_LEN:vi,FP2_NONRESIDUE:[mi,mi],Fp2mulByB:({c0:e,c1:t})=>{const r=Ii.mul(e,wi),n=Ii.mul(t,wi);return{c0:Ii.sub(r,n),c1:Ii.add(r,n)}},Fp12finalExponentiate:e=>{const t=xi,r=Ci.div(Ci.frobeniusMap(e,6),e),n=Ci.mul(Ci.frobeniusMap(r,2),r),i=Ci.conjugate(Ci._cyclotomicExp(n,t)),s=Ci.mul(Ci.conjugate(Ci._cyclotomicSquare(n)),i),o=Ci.conjugate(Ci._cyclotomicExp(s,t)),a=Ci.conjugate(Ci._cyclotomicExp(o,t)),c=Ci.mul(Ci.conjugate(Ci._cyclotomicExp(a,t)),Ci._cyclotomicSquare(i)),u=Ci.conjugate(Ci._cyclotomicExp(c,t)),d=Ci.frobeniusMap(Ci.mul(i,a),2),l=Ci.frobeniusMap(Ci.mul(o,n),3),f=Ci.frobeniusMap(Ci.mul(c,Ci.conjugate(n)),1),h=Ci.mul(Ci.mul(u,Ci.conjugate(s)),n);return Ci.mul(Ci.mul(Ci.mul(d,l),f),h)}}),{G2psi:Si,G2psi2:Ni}=function(e,t,r){const n=t.pow(r,(e.ORDER-ai)/ui),i=t.pow(r,(e.ORDER-ai)/ci);function s(e,r){return[t.mul(t.frobeniusMap(e,1),n),t.mul(t.frobeniusMap(r,1),i)]}const o=t.pow(r,(e.ORDER**ci-ai)/ui),a=t.pow(r,(e.ORDER**ci-ai)/ci);if(!t.eql(a,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(e,r){return[t.mul(e,o),t.neg(r)]}const u=e=>(t,r)=>{const n=r.toAffine(),i=e(n.x,n.y);return t.fromAffine({x:i[0],y:i[1]})};return{psi:s,psi2:c,G2psi:u(s),G2psi2:u(c),PSI_X:n,PSI_Y:i,PSI2_X:o,PSI2_Y:a}}(Ii,Ti,Ti.div(Ti.ONE,Ti.NONRESIDUE)),Ai=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:Ii.ORDER,m:2,k:128,expand:"xmd",hash:ie}),ki={p:Ti.ORDER,n:_i.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:Ti.ZERO,b:Ti.fromBigTuple([wi,wi]),Gx:Ti.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:Ti.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},Oi=Ri(Ii.toBytes(yi),{infinity:!0,compressed:!0});function Pi(e){const t=224&(e=e.slice())[0],r=!!(t>>7&1),n=!!(t>>6&1),i=!!(t>>5&1);return e[0]&=31,{compressed:r,infinity:n,sort:i,value:e}}function Ri(e,t){if(224&e[0])throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Fi(e){e.assertValidity();const{BYTES:t,ORDER:r}=Ii,{x:n,y:i}=e.toAffine();if(e.is0())return Oi.slice();const s=Boolean(i*gi/r);return Ri(Rr(n,t),{compressed:!0,sort:s})}function Di(e){const{infinity:t,sort:r,value:n}=Pi(Dr("signatureHex",e,48)),i=Ii.ORDER,s=Vi.G1.Point,o=Or(n);if(t)return s.ZERO;const a=Ii.create(o&Mr(Ii.BITS)),c=Ii.add(Ii.pow(a,bi),Ii.create(_i.b));let u=Ii.sqrt(c);if(!u)throw new Error("invalid G1 point: compressed");const d=BigInt(r);u*gi/i!==d&&(u=Ii.neg(u));const l=s.fromAffine({x:a,y:u});return l.assertValidity(),l}function Ui(e){e.assertValidity();const{BYTES:t}=Ii;if(e.is0())return _(Oi,Rr(yi,t));const{x:r,y:n}=e.toAffine(),{re:i,im:s}=Ti.reim(r),{re:o,im:a}=Ti.reim(n),c=Boolean((a>yi?a*gi:o*gi)/Ii.ORDER&mi),u=i;return _(Ri(Rr(s,t),{sort:c,compressed:!0}),Rr(u,t))}function qi(e){const{ORDER:t}=Ii,{infinity:r,sort:n,value:i}=Pi(Dr("signatureHex",e)),s=Vi.G2.Point,o=i.length/2;if(48!==o&&96!==o)throw new Error("invalid compressed signature length, expected 96/192 bytes");const a=Or(i.slice(0,o)),c=Or(i.slice(o));if(r)return s.ZERO;const u=Ii.create(a&Mr(Ii.BITS)),d=Ii.create(c),l=Ti.create({c0:d,c1:u}),f=Ti.add(Ti.pow(l,bi),ki.b);let h=Ti.sqrt(f);if(!h)throw new Error("Failed to find a square root");const{re:p,im:y}=Ti.reim(h),m=BigInt(n);(y>yi&&y*gi/t!==m||y===yi&&p*gi/t!==m)&&(h=Ti.neg(h));const g=s.fromAffine({x:l,y:h});return g.assertValidity(),g}const Vi=function(e){const{Fp:t,Fr:r,Fp2:n,Fp6:i,Fp12:s}=e.fields,o=Qn(e.G1),a=Object.assign(o,Mn(o.Point,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),c=Qn(e.G2),u=Object.assign(c,Mn(c.Point,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults})),d=function(e,t,r,n){const{Fp2:i,Fp12:s}=e,{twistType:o,ateLoopSize:a,xNegative:c,postPrecompute:u}=n;let d;if("multiplicative"===o)d=(e,t,r,n,o,a)=>s.mul014(n,e,i.mul(t,o),i.mul(r,a));else{if("divisive"!==o)throw new Error("bls: unknown twist type");d=(e,t,r,n,o,a)=>s.mul034(n,i.mul(r,a),i.mul(t,o),e)}const l=i.div(i.ONE,i.mul(i.ONE,ri));function f(e,t,r,n){const s=i.sqr(r),o=i.sqr(n),a=i.mulByB(i.mul(o,ni)),c=i.mul(a,ni),u=i.sub(i.sub(i.sqr(i.add(r,n)),o),s),d=i.sub(a,s),f=i.mul(i.sqr(t),ni),h=i.neg(u);return e.push([d,f,h]),{Rx:t=i.mul(i.mul(i.mul(i.sub(s,c),t),r),l),Ry:r=i.sub(i.sqr(i.mul(i.add(s,c),l)),i.mul(i.sqr(a),ni)),Rz:n=i.mul(s,u)}}function h(e,t,r,n,s,o){const a=i.sub(r,i.mul(o,n)),c=i.sub(t,i.mul(s,n)),u=i.sub(i.mul(a,s),i.mul(c,o)),d=i.neg(a),l=c;e.push([u,d,l]);const f=i.sqr(c),h=i.mul(f,c),p=i.mul(f,t),y=i.add(i.sub(h,i.mul(p,ri)),i.mul(i.sqr(a),n));return{Rx:t=i.mul(c,y),Ry:r=i.sub(i.mul(i.sub(p,y),a),i.mul(h,r)),Rz:n=i.mul(n,h)}}const p=function(e){const t=[];for(;e>ti;e>>=ti)(e&ti)===ei?t.unshift(0):(e&ni)===ni?(t.unshift(-1),e+=ti):t.unshift(1);return t}(a),y=Zr(e=>{const t=e,{x:r,y:n}=t.toAffine(),s=r,o=n,a=i.neg(n);let c=s,d=o,l=i.ONE;const y=[];for(const e of p){const t=[];({Rx:c,Ry:d,Rz:l}=f(t,c,d,l)),e&&({Rx:c,Ry:d,Rz:l}=h(t,c,d,l,s,-1===e?a:o)),y.push(t)}if(u){const e=y[y.length-1];u(c,d,l,s,o,h.bind(null,e))}return y});function m(e,t=!1){let r=s.ONE;if(e.length){const t=e[0][0].length;for(let n=0;n<t;n++){r=s.sqr(r);for(const[t,i,s]of e)for(const[e,o,a]of t[n])r=d(e,o,a,r,i,s)}}return c&&(r=s.conjugate(r)),t?s.finalExponentiate(r):r}function g(e,n=!0){const i=[];En(t,e.map(({g1:e})=>e)),En(r,e.map(({g2:e})=>e));for(const{g1:t,g2:r}of e){if(t.is0()||r.is0())throw new Error("pairing is not available for ZERO point");t.assertValidity(),r.assertValidity();const e=t.toAffine();i.push([y(r),e.x,e.y])}return m(i,n)}return{Fp12:s,millerLoopBatch:m,pairing:function(e,t,r=!0){return g([{g1:e,g2:t}],r)},pairingBatch:g,calcPairingPrecomputes:y}}(e.fields,a.Point,u.Point,{...e.params,postPrecompute:e.postPrecompute}),{millerLoopBatch:l,pairing:f,pairingBatch:h,calcPairingPrecomputes:p}=d,y=si(d,a,u,e.G2.Signature,!1),m=si(d,u,a,e.G1.ShortSignature,!0),g=e.randomBytes||T,b=()=>{const e=wn(r.ORDER);return function(e,t,r=!1){const n=e.length,i=bn(t),s=wn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=nn(r?Pr(e):Or(e),t-Hr)+Hr;return r?Fr(o,i):Rr(o,i)}(g(e),r.ORDER)},w={randomSecretKey:b,randomPrivateKey:b,calcPairingPrecomputes:p},{ShortSignature:x}=e.G1,{Signature:v}=e.G2;function _(e,t){return e instanceof a.Point?e:m.hash(Dr("point",e),t?.DST)}function E(e,t){return e instanceof u.Point?e:y.hash(Dr("point",e),t?.DST)}return a.Point.BASE.precompute(4),{longSignatures:y,shortSignatures:m,millerLoopBatch:l,pairing:f,pairingBatch:h,verifyBatch:function(e,t,r,n){const i=t.map(e=>E(e,n));return y.verifyBatch(e,i,r)},fields:{Fr:r,Fp:t,Fp2:n,Fp6:i,Fp12:s},params:{ateLoopSize:e.params.ateLoopSize,twistType:e.params.twistType,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:w,getPublicKey:function(e){return y.getPublicKey(e).toBytes(!0)},getPublicKeyForShortSignatures:function(e){return m.getPublicKey(e).toBytes(!0)},sign:function(e,t,r){const n=E(e,r),i=y.sign(n,t);return e instanceof u.Point?i:v.toBytes(i)},signShortSignature:function(e,t,r){const n=_(e,r),i=m.sign(n,t);return e instanceof a.Point?i:x.toBytes(i)},verify:function(e,t,r,n){const i=E(t,n);return y.verify(e,i,r)},verifyShortSignature:function(e,t,r,n){const i=_(t,n);return m.verify(e,i,r)},aggregatePublicKeys:function(e){const t=y.aggregatePublicKeys(e);return e[0]instanceof a.Point?t:t.toBytes(!0)},aggregateSignatures:function(e){const t=y.aggregateSignatures(e);return e[0]instanceof u.Point?t:v.toBytes(t)},aggregateShortSignatures:function(e){const t=m.aggregateSignatures(e);return e[0]instanceof a.Point?t:x.toBytes(t)},G1:a,G2:u,Signature:v,ShortSignature:x}}({fields:{Fp:Ii,Fp2:Ti,Fp6:Bi,Fp12:Ci,Fr:Ei},G1:{..._i,Fp:Ii,htfDefaults:{...Ai,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{const r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new e(Ii.mul(t.X,r),t.Y,t.Z);return t.multiplyUnsafe(xi).negate().multiplyUnsafe(xi).equals(n)},clearCofactor:(e,t)=>t.multiplyUnsafe(xi).add(t),mapToCurve:function(e){const{x:t,y:r}=ji(Ii.create(e[0]));return $i(t,r)},fromBytes:function(e){const{compressed:t,infinity:r,sort:n,value:i}=Pi(e),{BYTES:s,ORDER:o}=Ii;if(48===i.length&&t){const e=Or(i),t=Ii.create(e&Mr(Ii.BITS));if(r){if(t!==yi)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:yi,y:yi}}const s=Ii.add(Ii.pow(t,bi),Ii.create(_i.b));let a=Ii.sqrt(s);if(!a)throw new Error("invalid G1 point: compressed point");return a*gi/o!==BigInt(n)&&(a=Ii.neg(a)),{x:Ii.create(t),y:Ii.create(a)}}if(96!==i.length||t)throw new Error("invalid G1 point: expected 48/96 bytes");{const e=Or(i.subarray(0,s)),t=Or(i.subarray(s));if(r){if(e!==yi||t!==yi)throw new Error("G1: non-empty point at infinity");return Vi.G1.Point.ZERO.toAffine()}return{x:Ii.create(e),y:Ii.create(t)}}},toBytes:function(e,t,r){const{BYTES:n,ORDER:i}=Ii,s=t.is0(),{x:o,y:a}=t.toAffine();if(r){if(s)return Oi.slice();const e=Boolean(a*gi/i);return Ri(Rr(o,n),{compressed:!0,sort:e})}return s?_(Uint8Array.of(64),new Uint8Array(2*n-1)):_(Rr(o,n),Rr(a,n))},ShortSignature:{fromBytes:e=>(d(e),Di(e)),fromHex:e=>Di(e),toBytes:e=>Fi(e),toRawBytes:e=>Fi(e),toHex:e=>g(Fi(e))}},G2:{...ki,Fp:Ti,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Ai},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:function(e){const{x:t,y:r}=Mi(Ti.fromBigTuple(e));return Li(t,r)},isTorsionFree:(e,t)=>t.multiplyUnsafe(xi).negate().equals(Si(e,t)),clearCofactor:(e,t)=>{const r=xi;let n=t.multiplyUnsafe(r).negate(),i=Si(e,t),s=t.double();return s=Ni(e,s),s=s.subtract(i),i=n.add(i),i=i.multiplyUnsafe(r).negate(),s=s.add(i),s=s.subtract(n),s.subtract(t)},fromBytes:function(e){const{BYTES:t,ORDER:r}=Ii,{compressed:n,infinity:i,sort:s,value:o}=Pi(e);if(!n&&!i&&s||!n&&i&&s||s&&i&&n)throw new Error("invalid encoding flag: "+(224&e[0]));const a=(e,t,r)=>Or(e.slice(t,r));if(96===o.length&&n){if(i){if(o.reduce((e,t)=>0!==e?t+1:t,0)>0)throw new Error("invalid G2 point: compressed");return{x:Ti.ZERO,y:Ti.ZERO}}const e=a(o,0,t),n=a(o,t,2*t),c=Ti.create({c0:Ii.create(n),c1:Ii.create(e)}),u=Ti.add(Ti.pow(c,bi),ki.b);let d=Ti.sqrt(u);const l=d.c1===yi?d.c0*gi/r:d.c1*gi/r?mi:yi;return d=s&&l>0?d:Ti.neg(d),{x:c,y:d}}if(192!==o.length||n)throw new Error("invalid G2 point: expected 96/192 bytes");{if(i){if(o.reduce((e,t)=>0!==e?t+1:t,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:Ti.ZERO,y:Ti.ZERO}}const e=a(o,0*t,1*t),r=a(o,1*t,2*t),n=a(o,2*t,3*t),s=a(o,3*t,4*t);return{x:Ti.fromBigTuple([r,e]),y:Ti.fromBigTuple([s,n])}}},toBytes:function(e,t,r){const{BYTES:n,ORDER:i}=Ii,s=t.is0(),{x:o,y:a}=t.toAffine();if(r){if(s)return _(Oi,Rr(yi,n));const e=Boolean(a.c1===yi?a.c0*gi/i:a.c1*gi/i);return _(Ri(Rr(o.c1,n),{compressed:!0,sort:e}),Rr(o.c0,n))}{if(s)return _(Uint8Array.of(64),new Uint8Array(4*n-1));const{re:e,im:t}=Ti.reim(o),{re:r,im:i}=Ti.reim(a);return _(Rr(t,n),Rr(e,n),Rr(i,n),Rr(r,n))}},Signature:{fromBytes:e=>(d(e),qi(e)),fromHex:e=>qi(e),toBytes:e=>Ui(e),toRawBytes:e=>Ui(e),toHex:e=>g(Ui(e))}},params:{ateLoopSize:xi,r:_i.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:Ai,hash:ie}),Li=$n(Ti,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(e=>Ti.fromBigTuple(e.map(BigInt))))),$i=$n(Ii,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))),ji=Xn(Ii,{A:Ii.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:Ii.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:Ii.create(BigInt(11))}),Mi=Xn(Ti,{A:Ti.create({c0:Ii.create(yi),c1:Ii.create(BigInt(240))}),B:Ti.create({c0:Ii.create(BigInt(1012)),c1:Ii.create(BigInt(1012))}),Z:Ti.create({c0:Ii.create(BigInt(-2)),c1:Ii.create(BigInt(-1))})});function Ki(e,t,r){const n="string"==typeof e?e:g(e),i="string"==typeof t?t:g(t),s="string"==typeof r?r:g(r);return Vi.verifyShortSignature(i,s,n)}const Gi=BigInt(1e6),Zi=e=>we(new de(e)),zi=e=>{const t=Zi(e);return new Date(Number(t/Gi))};var Hi;!function(e){e[e.Empty=0]="Empty",e[e.Fork=1]="Fork",e[e.Labeled=2]="Labeled",e[e.Leaf=3]="Leaf",e[e.Pruned=4]="Pruned"}(Hi||(Hi={}));class Yi{#e=!1;#t=void 0;static async create(e){const t=Yi.createUnverified(e);return await t.verify(),t}static createUnverified(e){return new Yi(e.certificate,e.rootKey,e.canisterId,e.blsVerify??Ki,e.maxAgeInMinutes,e.disableTimeVerification,e.agent)}constructor(e,t,r,n,i=5,s=!1,o){this._rootKey=t,this._canisterId=r,this._blsVerify=n,this._maxAgeInMinutes=i,this.#e=s,this.cert=Ir(e),o&&"getTimeDiffMsecs"in o&&"hasSyncedTime"in o&&"syncTime"in o&&(this.#t=o)}lookup_path(e){return ss(e,this.cert.tree)}lookup_subtree(e){return os(e,this.cert.tree)}async verify(){const e=await Qi(this.cert.tree),t=await this._checkDelegationAndGetKey(this.cert.delegation),r=this.cert.signature,n=function(e){const t=Wi.byteLength+Ji;if(e.byteLength!==t)throw Ne.fromCode(new je(t,e.byteLength));const r=e.slice(0,Wi.byteLength);if(!_t(r,Wi))throw Ne.fromCode(new Me(Wi,r));return e.slice(Wi.byteLength)}(t),i=_(es("ic-state-root"),e),s=Xi(this.lookup_path(["time"]));if(!s)throw Ne.fromCode(new Fe("Certificate does not contain a time"));if(!this.#e){const e=this.#t?.getTimeDiffMsecs()??0,t=6e4*this._maxAgeInMinutes,r=new Date,n=r.getTime()+e,i=n-t,o=n+3e5,a=zi(s),c=a.getTime()<i,u=a.getTime()>o;if((c||u)&&this.#t&&!this.#t.hasSyncedTime())return await this.#t.syncTime(this._canisterId),await this.verify();if(c)throw Se.fromCode(new De(this._maxAgeInMinutes,a,r,e,"past"));if(u){if(this.#t?.hasSyncedTime())throw Re.fromCode(new lt("System time has been synced with the IC network, but certificate is still too far in the future."));throw Se.fromCode(new De(5,a,r,e,"future"))}}try{if(!await this._blsVerify(n,r,i))throw Se.fromCode(new Fe("Invalid signature"))}catch(e){throw Se.fromCode(new Fe("Signature verification failed",e))}}async _checkDelegationAndGetKey(e){if(!e)return this._rootKey;const t=Yi.createUnverified({certificate:e.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:43200,agent:this.#t});if(t.cert.delegation)throw Ne.fromCode(new Ue);await t.verify();const r=e.subnet_id,n=ce.fromUint8Array(r);if(!us({canisterId:this._canisterId,subnetId:n,tree:t.cert.tree}))throw Se.fromCode(new qe(this._canisterId,n));const i=Xi(t.lookup_path(["subnet",r,"public_key"]));if(!i)throw Se.fromCode(new $e(`Could not find subnet key for subnet ID ${n.toText()}`));return i}}const Wi=w("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),Ji=96;function Xi(e){if(e.status===rs.Found)return e.value instanceof Uint8Array?e.value:void 0}async function Qi(e){switch(e[0]){case Hi.Empty:return ie(es("ic-hashtree-empty"));case Hi.Pruned:return e[1];case Hi.Leaf:return ie(_(es("ic-hashtree-leaf"),e[1]));case Hi.Labeled:return ie(_(es("ic-hashtree-labeled"),e[1],await Qi(e[2])));case Hi.Fork:return ie(_(es("ic-hashtree-fork"),await Qi(e[1]),await Qi(e[2])));default:throw xt}}function es(e){return _(new Uint8Array([e.length]),(new TextEncoder).encode(e))}function ts(e){return"string"==typeof e[0]?x(e[0]):e[0]}var rs,ns,is;function ss(e,t){if(0===e.length)switch(t[0]){case Hi.Empty:return{status:rs.Absent};case Hi.Leaf:if(!t[1])throw Re.fromCode(new ft("Invalid tree structure for leaf"));if(t[1]instanceof Uint8Array)return{status:rs.Found,value:t[1].slice(t[1].byteOffset,t[1].byteLength+t[1].byteOffset)};throw xt;case Hi.Pruned:return{status:rs.Unknown};case Hi.Labeled:case Hi.Fork:return{status:rs.Error};default:throw xt}const r=cs(ts(e),t);switch(r.status){case is.Found:return ss(e.slice(1),r.value);case is.Absent:case is.Greater:case is.Less:return{status:rs.Absent};case is.Unknown:return{status:rs.Unknown};default:throw xt}}function os(e,t){if(0===e.length)return{status:ns.Found,value:t};const r=cs(ts(e),t);switch(r.status){case is.Found:return os(e.slice(1),r.value);case is.Unknown:return{status:ns.Unknown};case is.Absent:case is.Greater:case is.Less:return{status:ns.Absent};default:throw xt}}function as(e){switch(e[0]){case Hi.Empty:return[];case Hi.Fork:return as(e[1]).concat(as(e[2]));default:return[e]}}function cs(e,t){switch(t[0]){case Hi.Labeled:return function(e,t){for(let r=0;r<e.length;r++)if(e[r]>t[r])return!0;return!1}(e,t[1])?{status:is.Greater}:_t(e,t[1])?{status:is.Found,value:t[2]}:{status:is.Less};case Hi.Fork:{const r=cs(e,t[1]);switch(r.status){case is.Greater:{const r=cs(e,t[2]);return r.status===is.Less?{status:is.Absent}:r}case is.Unknown:{const r=cs(e,t[2]);return r.status===is.Less?{status:is.Unknown}:r}default:return r}}case Hi.Pruned:return{status:is.Unknown};default:return{status:is.Absent}}}function us(e){const{canisterId:t,subnetId:r,tree:n}=e,i=ss(["subnet",r.toUint8Array(),"canister_ranges"],n);if(i.status!==rs.Found)throw Ne.fromCode(new Ve(`Could not find canister ranges for subnet ${r.toText()}`,i.status));if(!(i.value instanceof Uint8Array))throw Ne.fromCode(new Le(`Could not find canister ranges for subnet ${r.toText()}`));const s=Ir(i.value).map(e=>[ce.fromUint8Array(e[0]),ce.fromUint8Array(e[1])]),o=s.some(e=>e[0].ltEq(t)&&e[1].gtEq(t));return o}!function(e){e.Unknown="Unknown",e.Absent="Absent",e.Found="Found",e.Error="Error"}(rs||(rs={})),function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found"}(ns||(ns={})),function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found",e.Less="Less",e.Greater="Greater"}(is||(is={}));const ds=async e=>{const{agent:t,paths:r,disableCertificateTimeVerification:n=!1}=e,i=ce.from(e.canisterId),s=[...new Set(r)],o=new Map,a=s.map((e,r)=>{const a=fs(e,i);return(async()=>{try{if(null===t.rootKey)throw Oe.fromCode(new tt);const e=t.rootKey,c=await t.readState(i,{paths:[a]}),u=await Yi.create({certificate:c.certificate,rootKey:e,canisterId:i,disableTimeVerification:n,agent:t}),d=(t,r)=>"subnet"===r?{path:r,data:ls(c.certificate,i,e)}:{path:r,data:Xi(t.lookup_path(a))},{path:l,data:f}=d(u,s[r]);if(f)switch(l){case"time":o.set(l,zi(f));break;case"controllers":o.set(l,hs(f));break;case"module_hash":o.set(l,g(f));break;case"subnet":o.set(l,f);break;case"candid":o.set(l,(new TextDecoder).decode(f));break;default:if("string"!=typeof l&&"key"in l&&"path"in l)switch(l.decodeStrategy){case"raw":o.set(l.key,f);break;case"leb128":o.set(l.key,Zi(f));break;case"cbor":o.set(l.key,Ir(f));break;case"hex":o.set(l.key,g(f));break;case"utf-8":o.set(l.key,(new TextDecoder).decode(f))}}else console.warn(`Expected to find result for path ${l}, but instead found nothing.`),"string"==typeof l?o.set(l,null):o.set(l.key,null)}catch(t){if(t instanceof Be&&(t.hasCode(Fe)||t.hasCode(De)))throw t;"string"!=typeof e&&"key"in e&&"path"in e?o.set(e.key,null):o.set(e,null),console.group(),console.warn(`Expected to find result for path ${e}, but instead found nothing.`),console.warn(t),console.groupEnd()}})()});return await Promise.all(a),o},ls=(e,t,r)=>{if(!t._isPrincipal)throw Pe.fromCode(new lt("Invalid canisterId"));const n=Ir(e),i=n.tree;let s,o=n.delegation;if(o&&o.subnet_id?s=ce.fromUint8Array(new Uint8Array(o.subnet_id)):o||void 0===r?(s=ce.selfAuthenticating(ce.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array()),o={subnet_id:s.toUint8Array(),certificate:new Uint8Array(0)}):(s=ce.selfAuthenticating(new Uint8Array(r)),o={subnet_id:s.toUint8Array(),certificate:new Uint8Array(0)}),!us({canisterId:t,subnetId:s,tree:i}))throw Se.fromCode(new qe(t,s));const a=os(["subnet",o.subnet_id,"node"],i);if(a.status!==ns.Found)throw Ne.fromCode(new Ve("Node not found",a.status));if(a.value instanceof Uint8Array)throw Re.fromCode(new ft("Invalid node tree"));const c=as(a.value),u=new Map;return c.forEach(e=>{const t=ce.from(e[1]).toText(),r=ss(["public_key"],e[2]);if(r.status!==rs.Found)throw Ne.fromCode(new Ve("Public key not found",r.status));const n=r.value;if(44!==n.byteLength)throw Ne.fromCode(new je(44,n.byteLength));u.set(t,n)}),{subnetId:ce.fromUint8Array(new Uint8Array(o.subnet_id)).toText(),nodeKeys:u}},fs=(e,t)=>{const r=t.toUint8Array();switch(e){case"time":return[x("time")];case"controllers":return[x("canister"),r,x("controllers")];case"module_hash":return[x("canister"),r,x("module_hash")];case"subnet":return[x("subnet")];case"candid":return[x("canister"),r,x("metadata"),x("candid:service")];default:if("key"in e&&"path"in e){if("string"==typeof e.path||e.path instanceof Uint8Array){const t=e.path,n="string"==typeof t?x(t):t;return[x("canister"),r,x("metadata"),n]}return e.path}}throw Re.fromCode(new lt(`Error while encoding your path for canister status. Please ensure that your path ${e} was formatted correctly.`))},hs=e=>Ir(e).map(e=>ce.fromUint8Array(e)),ps=BigInt(0),ys=BigInt(1),ms=BigInt(2),gs=BigInt(8);class bs{constructor(e){this.ep=e}static fromBytes(e){Gr()}static fromHex(e){Gr()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return g(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,t){return this.init(this.ep.precompute(e,t))}toRawBytes(){return this.toBytes()}}function ws(e){const{CURVE:t,curveOpts:r,hash:n,eddsaOpts:i}=function(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r={Fp:e.Fp,Fn:gn(t.n,e.nBitLength,!0),uvRatio:e.uvRatio},n={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:r,hash:e.hash,eddsaOpts:n}}(e),s=function(e,t={}){const r=Rn("edwards",e,t,t.FpFnLE),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o}=s;Kr(t,{},{uvRatio:"function"});const a=ms<<BigInt(8*i.BYTES)-ys,c=e=>n.create(e),u=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(n.div(e,t))}}catch(e){return{isValid:!1,value:ps}}});if(!function(e,t,r,n){const i=e.sqr(r),s=e.sqr(n),o=e.add(e.mul(t.a,i),s),a=e.add(e.ONE,e.mul(t.d,e.mul(i,s)));return e.eql(o,a)}(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function d(e,t,r=!1){return Lr("coordinate "+e,t,r?ys:ps,a),t}function l(e){if(!(e instanceof p))throw new Error("ExtendedPoint expected")}const f=Zr((e,t)=>{const{X:r,Y:i,Z:s}=e,o=e.is0();null==t&&(t=o?gs:n.inv(s));const a=c(r*t),u=c(i*t),d=n.mul(s,t);if(o)return{x:ps,y:ys};if(d!==ys)throw new Error("invZ was invalid");return{x:a,y:u}}),h=Zr(e=>{const{a:t,d:r}=s;if(e.is0())throw new Error("bad point: ZERO");const{X:n,Y:i,Z:o,T:a}=e,u=c(n*n),d=c(i*i),l=c(o*o),f=c(l*l),h=c(u*t);if(c(l*c(h+d))!==c(f+c(r*c(u*d))))throw new Error("bad point: equation left != right (1)");if(c(n*i)!==c(o*a))throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(e,t,r,n){this.X=d("x",e),this.Y=d("y",t),this.Z=d("z",r,!0),this.T=d("t",n),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){if(e instanceof p)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};return d("x",t),d("y",r),new p(t,r,ys,c(t*r))}static fromBytes(e,t=!1){const r=n.BYTES,{a:i,d:o}=s;e=Ur(Ar(e,r,"point")),Nr(t,"zip215");const d=Ur(e),l=e[r-1];d[r-1]=-129&l;const f=Pr(d),h=t?a:n.ORDER;Lr("point.y",f,ps,h);const y=c(f*f),m=c(y-ys),g=c(o*y-i);let{isValid:b,value:w}=u(m,g);if(!b)throw new Error("bad point: invalid y coordinate");const x=(w&ys)===ys,v=!!(128&l);if(!t&&w===ps&&v)throw new Error("bad point: x=0 and x_0=1");return v!==x&&(w=c(-w)),p.fromAffine({x:w,y:f})}static fromHex(e,t=!1){return p.fromBytes(Dr("point",e),t)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return y.createCache(this,e),t||this.multiply(ms),this}assertValidity(){h(this)}equals(e){l(e);const{X:t,Y:r,Z:n}=this,{X:i,Y:s,Z:o}=e,a=c(t*o),u=c(i*n),d=c(r*o),f=c(s*n);return a===u&&d===f}is0(){return this.equals(p.ZERO)}negate(){return new p(c(-this.X),this.Y,this.Z,c(-this.T))}double(){const{a:e}=s,{X:t,Y:r,Z:n}=this,i=c(t*t),o=c(r*r),a=c(ms*c(n*n)),u=c(e*i),d=t+r,l=c(c(d*d)-i-o),f=u+o,h=f-a,y=u-o,m=c(l*h),g=c(f*y),b=c(l*y),w=c(h*f);return new p(m,g,w,b)}add(e){l(e);const{a:t,d:r}=s,{X:n,Y:i,Z:o,T:a}=this,{X:u,Y:d,Z:f,T:h}=e,y=c(n*u),m=c(i*d),g=c(a*r*h),b=c(o*f),w=c((n+i)*(u+d)-y-m),x=b-g,v=b+g,_=c(m-t*y),E=c(w*x),I=c(v*_),T=c(w*_),B=c(x*v);return new p(E,I,B,T)}subtract(e){return this.add(e.negate())}multiply(e){if(!i.isValidNot0(e))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:t,f:r}=y.cached(this,e,e=>En(p,e));return En(p,[t,r])[0]}multiplyUnsafe(e,t=p.ZERO){if(!i.isValid(e))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return e===ps?p.ZERO:this.is0()||e===ys?this:y.unsafe(this,e,e=>En(p,e),t)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return y.unsafe(this,s.n).is0()}toAffine(e){return f(this,e)}clearCofactor(){return o===ys?this:this.multiplyUnsafe(o)}toBytes(){const{x:e,y:t}=this.toAffine(),r=n.toBytes(t);return r[r.length-1]|=e&ys?128:0,r}toHex(){return g(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(e){return En(p,e)}static msm(e,t){return On(p,i,e,t)}_setWindowSize(e){this.precompute(e)}toRawBytes(){return this.toBytes()}}p.BASE=new p(s.Gx,s.Gy,ys,c(s.Gx*s.Gy)),p.ZERO=new p(ps,ys,ys,ps),p.Fp=n,p.Fn=i;const y=new kn(p,i.BITS);return p.BASE.precompute(8),p}(t,r);return function(e,t){const r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}(e,function(e,t,r={}){if("function"!=typeof t)throw new Error('"hash" function param is required');Kr(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:n}=r,{BASE:i,Fp:s,Fn:o}=e,a=r.randomBytes||T,u=r.adjustScalarBytes||(e=>e),d=r.domain||((e,t,r)=>{if(Nr(r,"phflag"),t.length||r)throw new Error("Contexts/pre-hash are not supported");return e});function l(e){return o.create(Pr(e))}function f(e){const{head:r,prefix:n,scalar:s}=function(e){const r=g.secretKey;e=Dr("private key",e,r);const n=Dr("hashed private key",t(e),2*r),i=u(n.slice(0,r));return{head:i,prefix:n.slice(r,2*r),scalar:l(i)}}(e),o=i.multiply(s),a=o.toBytes();return{head:r,prefix:n,scalar:s,point:o,pointBytes:a}}function h(e){return f(e).pointBytes}function p(e=Uint8Array.of(),...r){const i=_(...r);return l(t(d(i,Dr("context",e),!!n)))}const y={zip215:!0},m=s.BYTES,g={secretKey:m,publicKey:m,signature:2*m,seed:m};function b(e=a(g.seed)){return Ar(e,g.seed,"seed")}const w={getExtendedPublicKey:f,randomSecretKey:b,isValidSecretKey:function(e){return c(e)&&e.length===o.BYTES},isValidPublicKey:function(t,r){try{return!!e.fromBytes(t,r)}catch(e){return!1}},toMontgomery(t){const{y:r}=e.fromBytes(t),n=g.publicKey,i=32===n;if(!i&&57!==n)throw new Error("only defined for 25519 and 448");const o=i?s.div(ys+r,ys-r):s.div(r-ys,r+ys);return s.toBytes(o)},toMontgomerySecret(e){const r=g.secretKey;Ar(e,r);const n=t(e.subarray(0,r));return u(n).subarray(0,r)},randomPrivateKey:b,precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};return Object.freeze({keygen:function(e){const t=w.randomSecretKey(e);return{secretKey:t,publicKey:h(t)}},getPublicKey:h,sign:function(e,t,r={}){e=Dr("message",e),n&&(e=n(e));const{prefix:s,scalar:a,pointBytes:c}=f(t),u=p(r.context,s,e),d=i.multiply(u).toBytes(),l=p(r.context,d,c,e),h=o.create(u+l*a);if(!o.isValid(h))throw new Error("sign failed: invalid s");return Ar(_(d,o.toBytes(h)),g.signature,"result")},verify:function(t,r,s,o=y){const{context:a,zip215:c}=o,u=g.signature;t=Dr("signature",t,u),r=Dr("message",r),s=Dr("publicKey",s,g.publicKey),void 0!==c&&Nr(c,"zip215"),n&&(r=n(r));const d=u/2,l=t.subarray(0,d),f=Pr(t.subarray(d,u));let h,m,b;try{h=e.fromBytes(s,c),m=e.fromBytes(l,c),b=i.multiplyUnsafe(f)}catch(e){return!1}if(!c&&h.isSmallOrder())return!1;const w=p(a,m.toBytes(),h.toBytes(),r);return m.add(h.multiplyUnsafe(w)).subtract(b).clearCofactor().is0()},utils:w,Point:e,lengths:g})}(s,n,i))}BigInt(0),BigInt(1),BigInt(2);const xs=BigInt(0),vs=BigInt(1),_s=BigInt(2),Es=(BigInt(3),BigInt(5)),Is=BigInt(8),Ts=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Bs=(()=>({p:Ts,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Is,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function Cs(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const Ss=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Ns(e,t){const r=Ts,n=nn(t*t*t,r),i=nn(n*n*t,r);let s=nn(e*n*function(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Ts,o=e*e%s*e%s,a=sn(o,_s,s)*o%s,c=sn(a,vs,s)*e%s,u=sn(c,Es,s)*c%s,d=sn(u,t,s)*u%s,l=sn(d,r,s)*d%s,f=sn(l,n,s)*l%s,h=sn(f,i,s)*f%s,p=sn(h,i,s)*f%s,y=sn(p,t,s)*u%s;return{pow_p_5_8:sn(y,_s,s)*e%s,b2:o}}(e*i).pow_p_5_8,r);const o=nn(t*s*s,r),a=s,c=nn(s*Ss,r),u=o===e,d=o===nn(-e,r),l=o===nn(-e*Ss,r);return u&&(s=a),(d||l)&&(s=c),ln(s,r)&&(s=nn(-s,r)),{isValid:u||d,value:s}}const As=(()=>gn(Bs.p,{isLE:!0}))(),ks=(()=>gn(Bs.n,{isLE:!0}))(),Os=(()=>({...Bs,Fp:As,hash:oe,adjustScalarBytes:Cs,uvRatio:Ns}))(),Ps=(()=>ws(Os))(),Rs=Ss,Fs=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ds=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Us=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),qs=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Vs=e=>Ns(vs,e),Ls=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),$s=e=>Ps.Point.Fp.create(Pr(e)&Ls);function js(e){const{d:t}=Bs,r=Ts,n=e=>As.create(e),i=n(Rs*e*e),s=n((i+vs)*Us);let o=BigInt(-1);const a=n((o-t*i)*n(i+t));let{isValid:c,value:u}=Ns(s,a),d=n(u*e);ln(d,r)||(d=n(-d)),c||(u=d),c||(o=i);const l=n(o*(i-vs)*qs-a),f=u*u,h=n((u+u)*a),p=n(l*Fs),y=n(vs-f),m=n(vs+f);return new Ps.Point(n(h*m),n(y*p),n(p*m),n(h*y))}class Ms extends bs{constructor(e){super(e)}static fromAffine(e){return new Ms(Ps.Point.fromAffine(e))}assertSame(e){if(!(e instanceof Ms))throw new Error("RistrettoPoint expected")}init(e){return new Ms(e)}static hashToCurve(e){return function(e){d(e,64);const t=js($s(e.subarray(0,32))),r=js($s(e.subarray(32,64)));return new Ms(t.add(r))}(Dr("ristrettoHash",e,64))}static fromBytes(e){d(e,32);const{a:t,d:r}=Bs,n=Ts,i=e=>As.create(e),s=$s(e);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(As.toBytes(s),e)||ln(s,n))throw new Error("invalid ristretto255 encoding 1");const o=i(s*s),a=i(vs+t*o),c=i(vs-t*o),u=i(a*a),l=i(c*c),f=i(t*r*u-l),{isValid:h,value:p}=Vs(i(f*l)),y=i(p*c),m=i(p*y*f);let g=i((s+s)*y);ln(g,n)&&(g=i(-g));const b=i(a*m),w=i(g*b);if(!h||ln(w,n)||b===xs)throw new Error("invalid ristretto255 encoding 2");return new Ms(new Ps.Point(g,b,vs,w))}static fromHex(e){return Ms.fromBytes(Dr("ristrettoHex",e,32))}static msm(e,t){return On(Ms,Ps.Point.Fn,e,t)}toBytes(){let{X:e,Y:t,Z:r,T:n}=this.ep;const i=Ts,s=e=>As.create(e),o=s(s(r+t)*s(r-t)),a=s(e*t),c=s(a*a),{value:u}=Vs(s(o*c)),d=s(u*o),l=s(u*a),f=s(d*l*n);let h;if(ln(n*f,i)){let r=s(t*Rs),n=s(e*Rs);e=r,t=n,h=s(d*Ds)}else h=l;ln(e*f,i)&&(t=s(-t));let p=s((r-t)*h);return ln(p,i)&&(p=s(-p)),As.toBytes(p)}equals(e){this.assertSame(e);const{X:t,Y:r}=this.ep,{X:n,Y:i}=e.ep,s=e=>As.create(e),o=s(t*i)===s(r*n),a=s(r*i)===s(t*n);return o||a}is0(){return this.equals(Ms.ZERO)}}var Ks,Gs;Ms.BASE=(()=>new Ms(Ps.Point.BASE))(),Ms.ZERO=(()=>new Ms(Ps.Point.ZERO))(),Ms.Fp=(()=>As)(),Ms.Fn=(()=>ks)();class Zs{static{Ks=Symbol.iterator,Gs=Symbol.toStringTag}#r;#n;constructor(e={}){this[Ks]=this.entries.bind(this),this[Gs]="ExpirableMap";const{source:t=[],expirationTime:r=6e5}=e,n=Date.now();this.#r=new Map([...t].map(([e,t])=>[e,{value:t,timestamp:n}])),this.#n=r}prune(){const e=Date.now();for(const[t,r]of this.#r.entries())e-r.timestamp>this.#n&&this.#r.delete(t);return this}set(e,t){this.prune();const r={value:t,timestamp:Date.now()};return this.#r.set(e,r),this}get(e){const t=this.#r.get(e);if(void 0!==t){if(!(Date.now()-t.timestamp>this.#n))return t.value;this.#r.delete(e)}}clear(){this.#r.clear()}entries(){const e=this.#r.entries();return function*(){for(const[t,r]of e)yield[t,r.value]}()}values(){const e=this.#r.values();return function*(){for(const t of e)yield t.value}()}keys(){return this.#r.keys()}forEach(e,t){for(const[r,n]of this.#r.entries())e.call(t,n.value,r,this)}has(e){return this.#r.has(e)}delete(e){return this.#r.delete(e)}get size(){return this.#r.size}}const zs=e=>{if(e<=127)return 1;if(e<=255)return 2;if(e<=65535)return 3;if(e<=16777215)return 4;throw Pe.fromCode(new Ze("Length too long (> 4 bytes)"))},Hs=(e,t,r)=>{if(r<=127)return e[t]=r,1;if(r<=255)return e[t]=129,e[t+1]=r,2;if(r<=65535)return e[t]=130,e[t+1]=r>>8,e[t+2]=r,3;if(r<=16777215)return e[t]=131,e[t+1]=r>>16,e[t+2]=r>>8,e[t+3]=r,4;throw Pe.fromCode(new Ze("Length too long (> 4 bytes)"))},Ys=(e,t)=>{if(e[t]<128)return 1;if(128===e[t])throw Pe.fromCode(new Ge("Invalid length 0"));if(129===e[t])return 2;if(130===e[t])return 3;if(131===e[t])return 4;throw Pe.fromCode(new Ge("Length too long (> 4 bytes)"))},Ws=(Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]),Uint8Array.from([48,5,6,3,43,101,112]));function Js(e,t){const r=2+zs(e.byteLength+1),n=t.byteLength+r+e.byteLength;let i=0;const s=new Uint8Array(1+zs(n)+n);return s[i++]=48,i+=Hs(s,i,n),s.set(t,i),i+=t.byteLength,s[i++]=3,i+=Hs(s,i,e.byteLength+1),s[i++]=0,s.set(new Uint8Array(e),i),s}Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]),Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);const Xs=(e,t)=>{let r=0;const n=(e,t)=>{if(i[r++]!==e)throw Pe.fromCode(new Ge(`Expected ${t} at offset ${r}`))},i=new Uint8Array(e);if(n(48,"sequence"),r+=Ys(i,r),!_t(i.slice(r,r+t.byteLength),t))throw Pe.fromCode(new Ge("Not the expected OID."));r+=t.byteLength,n(3,"bit string");const s=((e,t)=>{const r=Ys(e,t);if(1===r)return e[t];if(2===r)return e[t+1];if(3===r)return(e[t+1]<<8)+e[t+2];if(4===r)return(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];throw Pe.fromCode(new Ge("Length too long (> 4 bytes)"))})(i,r)-1;r+=Ys(i,r),n(0,"0 padding");const o=i.slice(r);if(s!==o.length)throw Pe.fromCode(new Ke(s,o.length));return o};class Qs{static from(e){return this.fromDer(e.toDer())}static fromRaw(e){return new Qs(e)}static fromDer(e){return new Qs(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){return Js(e,Ws)}static derDecode(e){const t=Xs(e,Ws);if(t.length!==this.RAW_KEY_LENGTH)throw Pe.fromCode(new Ge("An Ed25519 public key must be exactly 32 bytes long"));return t}#i;get rawKey(){return this.#i}#s;get derKey(){return this.#s}constructor(e){if(e.byteLength!==Qs.RAW_KEY_LENGTH)throw Pe.fromCode(new Ge("An Ed25519 public key must be exactly 32 bytes long"));this.#i=e,this.#s=Qs.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}}class eo{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter(t=>t!==e)}notify(e,...t){this.observers.forEach(r=>r(e,...t))}}class to extends eo{constructor(){super()}print(e,...t){this.notify({message:e,level:"info"},...t)}warn(e,...t){this.notify({message:e,level:"warn"},...t)}error(e,t,...r){this.notify({message:e,level:"error",error:t},...r)}}const ro=.5,no=1.5,io=500,so=6e4,oo=9e5,ao=10;class co{#o;#a;#c;#u;#d;#l;#f;#h;#p=0;static{this.default={initialInterval:io,randomizationFactor:ro,multiplier:no,maxInterval:so,maxElapsedTime:oo,maxIterations:ao,date:Date}}constructor(e=co.default){const{initialInterval:t=io,randomizationFactor:r=ro,multiplier:n=no,maxInterval:i=so,maxElapsedTime:s=oo,maxIterations:o=ao,date:a=Date}=e;this.#o=t,this.#a=r,this.#c=n,this.#u=i,this.#h=a,this.#d=a.now(),this.#l=s,this.#f=o}get ellapsedTimeInMsec(){return this.#h.now()-this.#d}get currentInterval(){return this.#o}get count(){return this.#p}get randomValueFromInterval(){const e=this.#a*this.#o,t=this.#o-e,r=this.#o+e;return Math.random()*(r-t)+t}incrementCurrentInterval(){return this.#o=Math.min(this.#o*this.#c,this.#u),this.#p++,this.#o}next(){return this.ellapsedTimeInMsec>=this.#l||this.#p>=this.#f?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}}var uo;!function(e){e.Received="received",e.Processing="processing",e.Replied="replied",e.Rejected="rejected",e.Unknown="unknown",e.Done="done"}(uo||(uo={}));class lo{#y;#m;#g;#b;#w;#x;#v;#_;#E;#I;#T;#B;#C;#S;get#N(){return 6e4*this.#S}#A;#k;#O;#P;constructor(e={}){this.#y=null,this.#m=!1,this.#g=0,this.#b=!1,this.#w=null,this.#x=!1,this._isAgent=!0,this.config={},this.log=new to,this.#A=[],this.#k=[],this.#O=new Zs({expirationTime:3e5}),this.#P=!0,this.#R=(e,t)=>{if(!1===this.#P)return e;const{status:r,signatures:n=[],requestId:i}=e;for(const s of n){const{timestamp:n,identity:o}=s,a=ce.fromUint8Array(o).toText();let c;if(r===Br.Replied){const{reply:t}=e;c=Bt({status:r,reply:t,timestamp:BigInt(n),request_id:i})}else{if(r!==Br.Rejected)throw Re.fromCode(new lt(`Unknown status: ${r}`));{const{reject_code:t,reject_message:s,error_code:o}=e;c=Bt({status:r,reject_code:t,reject_message:s,error_code:o,timestamp:BigInt(n),request_id:i})}}const u=_(St,c),d=t.nodeKeys.get(a);if(!d)throw Ne.fromCode(new ut);const l=Qs.fromDer(d).rawKey;if(Ps.verify(s.signature,u,l))return e;throw Se.fromCode(new dt(a))}return e},this.config=e,this.#_=e.fetch||function(){let e;if("undefined"!=typeof window){if(!window.fetch)throw Oe.fromCode(new nt("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));e=window.fetch.bind(window)}else if("undefined"!=typeof global){if(!global.fetch)throw Oe.fromCode(new nt("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));e=global.fetch.bind(global)}else"undefined"!=typeof self&&self.fetch&&(e=self.fetch.bind(self));if(e)return e;throw Oe.fromCode(new nt("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}()||fetch.bind(global),this.#E=e.fetchOptions,this.#I=e.callOptions,this.#m=e.shouldFetchRootKey??!1,this.#x=e.shouldSyncTime??!1,e.rootKey?this.rootKey=e.rootKey:this.#m?this.rootKey=null:this.rootKey=w("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae");const t=function(e){let t;if(void 0!==e)t=e.match(/^[a-z]+:/)||"undefined"==typeof window?new URL(e):new URL(window.location.protocol+"//"+e);else{const e=["ic0.app","icp0.io","127.0.0.1","localhost"],r=[".github.dev",".gitpod.io"],n="undefined"!=typeof window?window.location:void 0,i=n?.hostname;let s;i&&"string"==typeof i&&(s=r.some(e=>i.endsWith(e))?i:e.find(e=>i.endsWith(e))),t=n&&s?new URL(`${n.protocol}//${s}${n.port?":"+n.port:""}`):new URL("https://icp-api.io")}return t.toString()}(e.host);if(this.host=new URL(t),void 0!==e.verifyQuerySignatures&&(this.#P=e.verifyQuerySignatures),this.#B=e.retryTimes??3,this.#C=e.backoffStrategy||(()=>new co({maxIterations:this.#B})),this.host.hostname.endsWith(".ic0.app")?this.host.hostname="ic0.app":this.host.hostname.endsWith(".icp0.io")?this.host.hostname="icp0.io":this.host.hostname.endsWith(".icp-api.io")&&(this.host.hostname="icp-api.io"),e.credentials){const{name:t,password:r}=e.credentials;this.#T=`${t}${r?":"+r:""}`}if(this.#v=Promise.resolve(e.identity||new kt),e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes>5)throw Pe.fromCode(new st("The maximum ingress expiry time is 5 minutes.",e.ingressExpiryInMinutes));if(e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes<=0)throw Pe.fromCode(new st("Ingress expiry time must be greater than 0.",e.ingressExpiryInMinutes));this.#S=e.ingressExpiryInMinutes||5,this.addTransform("update",vr(hr)),e.useQueryNonces&&this.addTransform("query",vr(hr)),e.logToConsole&&this.log.subscribe(e=>{"error"===e.level?console.error(e.message):"warn"===e.level?console.warn(e.message):console.log(e.message)})}static createSync(e={}){return new this({...e})}static async create(e={}){const t=lo.createSync(e);return await t.#F(),t}static async from(e){try{return"config"in e?await lo.create(e.config):await lo.create({fetch:e._fetch,fetchOptions:e._fetchOptions,callOptions:e._callOptions,host:e._host.toString(),identity:e._identity??void 0})}catch{throw Pe.fromCode(new ot)}}isLocal(){const e=this.host.hostname;return"127.0.0.1"===e||e.endsWith("127.0.0.1")}addTransform(e,t,r=t.priority||0){if("update"===e){const e=this.#k.findIndex(e=>(e.priority||0)<r);this.#k.splice(e>=0?e:this.#k.length,0,Object.assign(t,{priority:r}))}else if("query"===e){const e=this.#A.findIndex(e=>(e.priority||0)<r);this.#A.splice(e>=0?e:this.#A.length,0,Object.assign(t,{priority:r}))}}async getPrincipal(){if(!this.#v)throw Oe.fromCode(new it);return(await this.#v).getPrincipal()}async call(e,t,r){const n=t.callSync??!0,i=await(r??this.#v);if(!i)throw Oe.fromCode(new it);const s=ce.from(e),o=t.effectiveCanisterId?ce.from(t.effectiveCanisterId):s;await this.#F(o);const a=i.getPrincipal(),c=fo(this.#S,this.#g),u={request_type:lr.Call,canister_id:s,method_name:t.methodName,arg:t.arg,sender:a,ingress_expiry:c};let d,l=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#T?{Authorization:"Basic "+btoa(this.#T)}:{}}},endpoint:dr.Call,body:u});function f(e){return Object.assign(e,{__nonce__:void 0})}d=t?.nonce?f(t.nonce):l.body.nonce?f(l.body.nonce):void 0,u.nonce=d,l=await i.transformRequest(l);const h=Er(l.body),p=this.#C(),y=Tt(u);try{const e=n?()=>(this.log.print(`fetching "/api/v3/canister/${o.toText()}/call" with request:`,l),this.#_(""+new URL(`/api/v3/canister/${o.toText()}/call`,this.host),{...this.#I,...l.request,body:h})):()=>(this.log.print(`fetching "/api/v2/canister/${o.toText()}/call" with request:`,l),this.#_(""+new URL(`/api/v2/canister/${o.toText()}/call`,this.host),{...this.#I,...l.request,body:h})),{responseBodyBytes:t,...r}=await this.#D({requestFn:e,backoff:p,tries:0}),i=t.byteLength>0?Ir(t):null;return{requestId:y,response:{...r,body:i},requestDetails:u}}catch(n){let i;if(n instanceof Be){if(n.hasCode(pt))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(e,{...t,callSync:!1},r);if(n.hasCode(st)&&!this.#b)return await this.syncTime(s),this.call(s,t,r);n.code.requestContext={requestId:y,senderPubKey:l.body.sender_pubkey,senderSignature:l.body.sender_sig,ingressExpiry:l.body.content.ingress_expiry},i=n}else i=Re.fromCode(new lt(n));throw this.log.error(`Error while making call: ${i.message}`,i),i}}async#U(e){const{ecid:t,transformedRequest:r,body:n,requestId:i,backoff:s,tries:o}=e,a=0===o?0:s.next();if(this.log.print(`fetching "/api/v2/canister/${t.toString()}/query" with tries:`,{tries:o,backoff:s,delay:a}),null===a)throw Re.fromCode(new Ye(`Backoff strategy exhausted after ${o} attempts.`,i));let c;a>0&&await new Promise(e=>setTimeout(e,a));try{this.log.print(`fetching "/api/v2/canister/${t.toString()}/query" with request:`,r);const e=await this.#_(""+new URL(`/api/v2/canister/${t.toString()}/query`,this.host),{...this.#E,...r.request,body:n});if(200!==e.status)throw Ne.fromCode(new ht(e.status,e.statusText,_r(e.headers),await e.text()));c={...Ir(vt(await e.arrayBuffer())),httpDetails:{ok:e.ok,status:e.status,statusText:e.statusText,headers:_r(e.headers)},requestId:i}}catch(t){if(o<this.#B)return this.log.warn(`Caught exception while attempting to make query:\n  ${t}\n  Retrying query.`),await this.#U({...e,tries:o+1});if(t instanceof Be)throw t;throw ke.fromCode(new yt(t))}if(!this.#P)return c;const u=c.signatures?.[0]?.timestamp;if(!u)throw Ne.fromCode(new at("Timestamp not found in query response. This suggests a malformed or malicious response."));const d=Number(BigInt(u)/BigInt(1e6));if(Date.now()+this.#g-d>this.#N){if(o<this.#B)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:i,signatureTimestampMs:d}),await this.#U({...e,tries:o+1});throw Se.fromCode(new We(this.#S,i,o))}return c}async#D(e){const{requestFn:t,backoff:r,tries:n}=e,i=0===n?0:r.next();if(null===i)throw Ne.fromCode(new Ye(`Retry strategy exhausted after ${n} attempts.`));let s;i>0&&await new Promise(e=>setTimeout(e,i));let o=new Uint8Array;try{s=await t(),200===s.status&&(o=vt(await s.clone().arrayBuffer()))}catch(e){if(n<this.#B)return this.log.warn(`Caught exception while attempting to make request:\n  ${e}\n  Retrying request.`),await this.#D({requestFn:t,backoff:r,tries:n+1});throw ke.fromCode(new yt(e))}const a=_r(s.headers);if(200===s.status||202===s.status)return{ok:s.ok,status:s.status,statusText:s.statusText,responseBodyBytes:o,headers:a};const c=await s.text();if(404===s.status&&s.url.includes("api/v3"))throw Ne.fromCode(new pt);if(c.startsWith("Invalid request expiry: "))throw Pe.fromCode(new st(c,this.#S));if(n<this.#B)return await this.#D({requestFn:t,backoff:r,tries:n+1});throw Ne.fromCode(new ht(s.status,s.statusText,a,c))}async query(e,t,r){const n=this.#C(),i=t.effectiveCanisterId?ce.from(t.effectiveCanisterId):ce.from(e);let s;await this.#F(i),this.log.print(`ecid ${i.toString()}`),this.log.print(`canisterId ${e.toString()}`);const o=await(r??this.#v);if(!o)throw Oe.fromCode(new it);const a=ce.from(e),c=o.getPrincipal(),u=fo(this.#S,this.#g),d={request_type:fr.Query,canister_id:a,method_name:t.methodName,arg:t.arg,sender:c,ingress_expiry:u},l=Tt(d);s=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#T?{Authorization:"Basic "+btoa(this.#T)}:{}}},endpoint:dr.Query,body:d}),s=await o.transformRequest(s);const f=Er(s.body),h={canister:a.toText(),ecid:i,transformedRequest:s,body:f,requestId:l,backoff:n,tries:0},p=async()=>{const e=await this.#U(h);return{requestDetails:d,...e}},y=async()=>{const e=this.#O.get(i.toString());if(e)return e;await this.fetchSubnetKeys(i.toString());const t=this.#O.get(i.toString());if(!t)throw Se.fromCode(new ct);return t};try{if(!this.#P)return await p();const[e,t]=await Promise.all([p(),y()]);try{return this.#R(e,t)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#O.delete(i.toString());const t=await y();return this.#R(e,t)}}catch(e){let t;throw e instanceof Be?(e.code.requestContext={requestId:l,senderPubKey:s.body.sender_pubkey,senderSignature:s.body.sender_sig,ingressExpiry:s.body.content.ingress_expiry},t=e):t=Re.fromCode(new lt(e)),this.log.error(`Error while making query: ${t.message}`,t),t}}#R;async createReadStateRequest(e,t){await this.#F();const r=await(t??this.#v);if(!r)throw Oe.fromCode(new it);const n=r.getPrincipal(),i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#T?{Authorization:"Basic "+btoa(this.#T)}:{}}},endpoint:dr.ReadState,body:{request_type:fr.ReadState,paths:e.paths,sender:n,ingress_expiry:fo(this.#S,this.#g)}});return r.transformRequest(i)}async readState(e,t,r,n){await this.#q();const i=ce.from(e);let s,o;if(n)s=n,o=Tt(s);else{o=function(e){for(const t of e.paths){const[e,r]=t;if(_t(e,(new TextEncoder).encode("request_status")))return r}}(t);const e=await this.#v;if(!e)throw Oe.fromCode(new it);s=await this.createReadStateRequest(t,e)}this.log.print(`fetching "/api/v2/canister/${i}/read_state" with request:`,s);const a=this.#C();try{const{responseBodyBytes:e}=await this.#D({requestFn:()=>this.#_(""+new URL(`/api/v2/canister/${i.toString()}/read_state`,this.host),{...this.#E,...s.request,body:Er(s.body)}),backoff:a,tries:0}),t=Ir(e);return this.log.print("Read state response:",t),t}catch(e){let t;throw e instanceof Be?(e.code.requestContext={requestId:o,senderPubKey:s.body.sender_pubkey,senderSignature:s.body.sender_sig,ingressExpiry:s.body.content.ingress_expiry},t=e):t=Re.fromCode(new lt(e)),this.log.error(`Error while making read state: ${t.message}`,t),t}}parseTimeFromResponse(e){let t;if(e.certificate){const r=Ir(e.certificate);if(!r||!("tree"in r))throw Ne.fromCode(new ft("Could not decode time from response"));t=r.tree;const n=ss(["time"],t);if(n.status!==rs.Found)throw Ne.fromCode(new Ve("Time was not found in the response or was not in its expected format.",n.status));if(!(n.value instanceof Uint8Array||ArrayBuffer.isView(n)))throw Ne.fromCode(new Le("Time was not in its expected format."));const i=zi(n.value);return this.log.print("Time from response:",i),this.log.print("Time from response in milliseconds:",i.getTime()),i.getTime()}return this.log.warn("No certificate found in response"),0}async syncTime(e){this.#w=this.#w??(async()=>{await this.#q();const t=Date.now();try{e||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");const r=e??ce.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),n=lo.createSync({identity:new kt,host:this.host.toString(),fetch:this.#_,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),i=(await Promise.all(Array(3).fill(null).map(async()=>{const e=(await ds({canisterId:r,agent:n,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(e instanceof Date)return e.getTime()},[]))).reduce((e,t)=>"number"==typeof t&&t>e?t:e,0);i>0&&(this.#g=i-t,this.#b=!0,this.log.notify({message:`Syncing time: offset of ${this.#g}`,level:"info"}))}catch(e){const t=e instanceof Be?e:Re.fromCode(new lt(e));throw this.log.error("Caught exception while attempting to sync time",t),t}})(),await this.#w.finally(()=>{this.#w=null})}async status(){const e=this.#T?{Authorization:"Basic "+btoa(this.#T)}:{};this.log.print('fetching "/api/v2/status"');const t=this.#C(),{responseBodyBytes:r}=await this.#D({backoff:t,requestFn:()=>this.#_(""+new URL("/api/v2/status",this.host),{headers:e,...this.#E}),tries:0});return Ir(r)}async fetchRootKey(){return this.#y=this.#y??(async()=>{const e=await this.status();return this.rootKey=e.root_key,this.rootKey})(),await this.#y.finally(()=>{this.#y=null})}async#F(e){await Promise.all([this.#q(),this.#V(e)])}async#q(){if(!this.rootKey){if(null!==this.rootKey||"https://icp-api.io"===this.host.toString()||!this.#m)throw Oe.fromCode(new tt(this.#m));await this.fetchRootKey()}}async#V(e){this.#x&&!this.hasSyncedTime()&&await this.syncTime(e)}invalidateIdentity(){this.#v=null}replaceIdentity(e){this.#v=Promise.resolve(e)}async fetchSubnetKeys(e){const t=ce.from(e);await this.#F(t);const r=(await ds({canisterId:t,paths:["subnet"],agent:this})).get("subnet");if(r&&"object"==typeof r&&"nodeKeys"in r)return this.#O.set(t.toText(),r),r}_transform(e){let t=Promise.resolve(e);if(e.endpoint===dr.Call)for(const e of this.#k)t=t.then(t=>e(t).then(e=>e||t));else for(const e of this.#A)t=t.then(t=>e(t).then(e=>e||t));return t}getTimeDiffMsecs(){return this.#g}hasSyncedTime(){return this.#b}}function fo(e,t){const r=6e4*e;return xr.fromDeltaInMilliseconds(r,t)}function ho(e){if(/^_\d+_$/.test(e)||/^_0x[0-9a-fA-F]+_$/.test(e)){const t=+e.slice(1,-1);if(Number.isSafeInteger(t)&&t>=0&&t<2**32)return t}return function(e){const t=(new TextEncoder).encode(e);let r=0;for(const e of t)r=(223*r+e)%2**32;return r}(e)}var po;!function(e){e[e.Null=-1]="Null",e[e.Bool=-2]="Bool",e[e.Nat=-3]="Nat",e[e.Int=-4]="Int",e[e.Float32=-13]="Float32",e[e.Float64=-14]="Float64",e[e.Text=-15]="Text",e[e.Reserved=-16]="Reserved",e[e.Empty=-17]="Empty",e[e.Opt=-18]="Opt",e[e.Vector=-19]="Vector",e[e.Record=-20]="Record",e[e.Variant=-21]="Variant",e[e.Func=-22]="Func",e[e.Service=-23]="Service",e[e.Principal=-24]="Principal"}(po||(po={}));const yo="DIDL";function mo(e,t,r){return e.map((e,n)=>r(e,t[n]))}class go{constructor(){this._typs=[],this._idx=new Map,this._idxRefCount=new Map}has(e){return this._idx.has(e.name)}add(e,t){const r=this._typs.length;this._idx.set(e.name,r),this._idxRefCount.set(r,1),this._typs.push(t)}merge(e,t){const r=this._idx.get(e.name),n=this._idx.get(t);if(void 0===r)throw new Error("Missing type index for "+e);if(void 0===n)throw new Error("Missing type index for "+t);this._typs[r]=this._typs[n];const i=this._getIdxRefCount(n);this._idxRefCount.set(n,i-1),this._idx.delete(t),this._compactFromEnd()}_getIdxRefCount(e){return this._idxRefCount.get(e)||0}_compactFromEnd(){for(;this._typs.length>0;){const e=this._typs.length-1;if(this._getIdxRefCount(e)>0)break;this._typs.pop(),this._idxRefCount.delete(e)}}encode(){const e=be(this._typs.length),t=ue(...this._typs);return ue(e,t)}indexOf(e){if(!this._idx.has(e))throw new Error("Missing type index for "+e);return xe(this._idx.get(e)||0)}}class bo{visitType(e,t){throw new Error("Not implemented")}visitPrimitive(e,t){return this.visitType(e,t)}visitEmpty(e,t){return this.visitPrimitive(e,t)}visitBool(e,t){return this.visitPrimitive(e,t)}visitNull(e,t){return this.visitPrimitive(e,t)}visitReserved(e,t){return this.visitPrimitive(e,t)}visitText(e,t){return this.visitPrimitive(e,t)}visitNumber(e,t){return this.visitPrimitive(e,t)}visitInt(e,t){return this.visitNumber(e,t)}visitNat(e,t){return this.visitNumber(e,t)}visitFloat(e,t){return this.visitPrimitive(e,t)}visitFixedInt(e,t){return this.visitNumber(e,t)}visitFixedNat(e,t){return this.visitNumber(e,t)}visitPrincipal(e,t){return this.visitPrimitive(e,t)}visitConstruct(e,t){return this.visitType(e,t)}visitVec(e,t,r){return this.visitConstruct(e,r)}visitOpt(e,t,r){return this.visitConstruct(e,r)}visitRecord(e,t,r){return this.visitConstruct(e,r)}visitTuple(e,t,r){const n=t.map((e,t)=>[`_${t}_`,e]);return this.visitRecord(e,n,r)}visitVariant(e,t,r){return this.visitConstruct(e,r)}visitRec(e,t,r){return this.visitConstruct(t,r)}visitFunc(e,t){return this.visitConstruct(e,t)}visitService(e,t){return this.visitConstruct(e,t)}}var wo;!function(e){e.EmptyClass="__IDL_EmptyClass__",e.UnknownClass="__IDL_UnknownClass__",e.BoolClass="__IDL_BoolClass__",e.NullClass="__IDL_NullClass__",e.ReservedClass="__IDL_ReservedClass__",e.TextClass="__IDL_TextClass__",e.IntClass="__IDL_IntClass__",e.NatClass="__IDL_NatClass__",e.FloatClass="__IDL_FloatClass__",e.FixedIntClass="__IDL_FixedIntClass__",e.FixedNatClass="__IDL_FixedNatClass__",e.VecClass="__IDL_VecClass__",e.OptClass="__IDL_OptClass__",e.RecordClass="__IDL_RecordClass__",e.TupleClass="__IDL_TupleClass__",e.VariantClass="__IDL_VariantClass__",e.RecClass="__IDL_RecClass__",e.PrincipalClass="__IDL_PrincipalClass__",e.FuncClass="__IDL_FuncClass__",e.ServiceClass="__IDL_ServiceClass__"}(wo||(wo={}));class xo{display(){return this.name}valueToString(e){return Ko(e)}buildTypeTable(e){e.has(this)||this._buildTypeTableImpl(e)}}class vo extends xo{checkType(e){if(this.name!==e.name)throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`);return e}_buildTypeTableImpl(e){}}class _o extends xo{checkType(e){if(e instanceof Vo){const t=e.getType();if(void 0===t)throw new Error("type mismatch with uninitialized type");return t}throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`)}encodeType(e){return e.indexOf(this.name)}}class Eo extends vo{get typeName(){return wo.EmptyClass}static[Symbol.hasInstance](e){return e.typeName===wo.EmptyClass}accept(e,t){return e.visitEmpty(this,t)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return xe(po.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}}class Io extends xo{get typeName(){return wo.UnknownClass}static[Symbol.hasInstance](e){return e.typeName===wo.UnknownClass}checkType(e){throw new Error("Method not implemented for unknown.")}accept(e,t){throw e.visitType(this,t)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(e,t){let r,n=t.decodeValue(e,t);return Object(n)!==n&&(n=Object(n)),r=t instanceof Vo?()=>t.getType():()=>t,Object.defineProperty(n,"type",{value:r,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}}class To extends vo{get typeName(){return wo.BoolClass}static[Symbol.hasInstance](e){return e.typeName===wo.BoolClass}accept(e,t){return e.visitBool(this,t)}covariant(e){if("boolean"==typeof e)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return new Uint8Array([e?1:0])}encodeType(){return xe(po.Bool)}decodeValue(e,t){switch(this.checkType(t),ge(e)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}}class Bo extends vo{get typeName(){return wo.NullClass}static[Symbol.hasInstance](e){return e.typeName===wo.NullClass}accept(e,t){return e.visitNull(this,t)}covariant(e){if(null===e)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return xe(po.Null)}decodeValue(e,t){return this.checkType(t),null}get name(){return"null"}}class Co extends vo{get typeName(){return wo.ReservedClass}static[Symbol.hasInstance](e){return e.typeName===wo.ReservedClass}accept(e,t){return e.visitReserved(this,t)}covariant(e){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return xe(po.Reserved)}decodeValue(e,t){return t.name!==this.name&&t.decodeValue(e,t),null}get name(){return"reserved"}}class So extends vo{get typeName(){return wo.TextClass}static[Symbol.hasInstance](e){return e.typeName===wo.TextClass}accept(e,t){return e.visitText(this,t)}covariant(e){if("string"==typeof e)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=(new TextEncoder).encode(e);return ue(be(t.byteLength),t)}encodeType(){return xe(po.Text)}decodeValue(e,t){this.checkType(t);const r=we(e),n=me(e,Number(r));return new TextDecoder("utf8",{fatal:!0}).decode(n)}get name(){return"text"}valueToString(e){return'"'+e+'"'}}class No extends vo{get typeName(){return wo.IntClass}static[Symbol.hasInstance](e){return e.typeName===wo.IntClass}accept(e,t){return e.visitInt(this,t)}covariant(e){if("bigint"==typeof e||Number.isInteger(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return xe(e)}encodeType(){return xe(po.Int)}decodeValue(e,t){return this.checkType(t),ve(e)}get name(){return"int"}valueToString(e){return e.toString()}}class Ao extends vo{get typeName(){return wo.NatClass}static[Symbol.hasInstance](e){return e.typeName===wo.NatClass}accept(e,t){return e.visitNat(this,t)}covariant(e){if("bigint"==typeof e&&e>=BigInt(0)||Number.isInteger(e)&&e>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return be(e)}encodeType(){return xe(po.Nat)}decodeValue(e,t){return this.checkType(t),we(e)}get name(){return"nat"}valueToString(e){return e.toString()}}class ko extends vo{get typeName(){return wo.FloatClass}static[Symbol.hasInstance](e){return e.typeName===wo.FloatClass}constructor(e){if(super(),this._bits=e,32!==e&&64!==e)throw new Error("not a valid float type")}accept(e,t){return e.visitFloat(this,t)}covariant(e){if("number"==typeof e||e instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=new ArrayBuffer(this._bits/8),r=new DataView(t);return 32===this._bits?r.setFloat32(0,e,!0):r.setFloat64(0,e,!0),new Uint8Array(t)}encodeType(){return xe(32===this._bits?po.Float32:po.Float64)}decodeValue(e,t){this.checkType(t);const r=function(e){if(!(e instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(e.buffer,e.byteOffset,e.byteLength)}(me(e,this._bits/8));return 32===this._bits?r.getFloat32(0,!0):r.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(e){return e.toString()}}class Oo extends vo{get typeName(){return wo.FixedIntClass}static[Symbol.hasInstance](e){return e.typeName===wo.FixedIntClass}constructor(e){super(),this._bits=e}accept(e,t){return e.visitFixedInt(this,t)}covariant(e){const t=pe(this._bits-1)*BigInt(-1),r=pe(this._bits-1)-BigInt(1);let n=!1;if("bigint"==typeof e)n=e>=t&&e<=r;else if(Number.isInteger(e)){const i=BigInt(e);n=i>=t&&i<=r}else n=!1;if(n)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return _e(e,this._bits/8)}encodeType(){return xe(-9-(Math.log2(this._bits)-3))}decodeValue(e,t){this.checkType(t);const r=function(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=Ee(e,t);const n=BigInt(2)**(BigInt(8)*BigInt(t-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}(e,this._bits/8);return this._bits<=32?Number(r):r}get name(){return`int${this._bits}`}valueToString(e){return e.toString()}}class Po extends vo{get typeName(){return wo.FixedNatClass}static[Symbol.hasInstance](e){return e.typeName===wo.FixedNatClass}constructor(e){super(),this._bits=e}accept(e,t){return e.visitFixedNat(this,t)}covariant(e){const t=pe(this._bits);let r=!1;if(r="bigint"==typeof e&&e>=BigInt(0)?e<t:!!(Number.isInteger(e)&&e>=0)&&BigInt(e)<t,r)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return function(e,t){if(BigInt(e)<BigInt(0))throw new Error("Cannot write negative values.");return _e(e,t)}(e,this._bits/8)}encodeType(){return xe(-5-(Math.log2(this._bits)-3))}decodeValue(e,t){this.checkType(t);const r=Ee(e,this._bits/8);return this._bits<=32?Number(r):r}get name(){return`nat${this._bits}`}valueToString(e){return e.toString()}}class Ro extends _o{get typeName(){return wo.VecClass}static[Symbol.hasInstance](e){return e.typeName===wo.VecClass}constructor(e){super(),this._type=e,this._blobOptimization=!1,e instanceof Po&&8===e._bits&&(this._blobOptimization=!0)}accept(e,t){return e.visitVec(this,this._type,t)}covariant(e){const t=this._type instanceof Po||this._type instanceof Oo?this._type._bits:0;if(ArrayBuffer.isView(e)&&t==8*e.BYTES_PER_ELEMENT||Array.isArray(e)&&e.every((e,t)=>{try{return this._type.covariant(e)}catch(e){throw new Error(`Invalid ${this.display()} argument: \n\nindex ${t} -> ${e.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=be(e.length);if(this._blobOptimization)return ue(t,new Uint8Array(e));if(ArrayBuffer.isView(e)){if(e instanceof Int16Array||e instanceof Uint16Array){const r=new DataView(new ArrayBuffer(2*e.length));for(let t=0;t<e.length;t++)e instanceof Int16Array?r.setInt16(2*t,e[t],!0):r.setUint16(2*t,e[t],!0);return ue(t,new Uint8Array(r.buffer))}if(e instanceof Int32Array||e instanceof Uint32Array){const r=new DataView(new ArrayBuffer(4*e.length));for(let t=0;t<e.length;t++)e instanceof Int32Array?r.setInt32(4*t,e[t],!0):r.setUint32(4*t,e[t],!0);return ue(t,new Uint8Array(r.buffer))}if(e instanceof BigInt64Array||e instanceof BigUint64Array){const r=new DataView(new ArrayBuffer(8*e.length));for(let t=0;t<e.length;t++)e instanceof BigInt64Array?r.setBigInt64(8*t,e[t],!0):r.setBigUint64(8*t,e[t],!0);return ue(t,new Uint8Array(r.buffer))}return ue(t,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}const r=new de(new Uint8Array(t.byteLength+e.length),0);r.write(t);for(const t of e){const e=this._type.encodeValue(t);r.write(new Uint8Array(e))}return r.buffer}_buildTypeTableImpl(e){this._type.buildTypeTable(e);const t=xe(po.Vector),r=this._type.encodeType(e);e.add(this,ue(t,r))}decodeValue(e,t){const r=this.checkType(t);if(!(r instanceof Ro))throw new Error("Not a vector type");const n=Number(we(e));if(this._type instanceof Po){if(8==this._type._bits)return new Uint8Array(e.read(n));if(16==this._type._bits){const t=e.read(2*n);return new Uint16Array(t.buffer,t.byteOffset,n)}if(32==this._type._bits){const t=e.read(4*n);return new Uint32Array(t.buffer,t.byteOffset,n)}if(64==this._type._bits)return new BigUint64Array(e.read(8*n).buffer)}if(this._type instanceof Oo){if(8==this._type._bits)return new Int8Array(e.read(n));if(16==this._type._bits){const t=e.read(2*n),r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=new Int16Array(n);for(let e=0;e<n;e++)i[e]=r.getInt16(2*e,!0);return i}if(32==this._type._bits){const t=e.read(4*n),r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=new Int32Array(n);for(let e=0;e<n;e++)i[e]=r.getInt32(4*e,!0);return i}if(64==this._type._bits){const t=e.read(8*n),r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=new BigInt64Array(n);for(let e=0;e<n;e++)i[e]=r.getBigInt64(8*e,!0);return i}}const i=[];for(let t=0;t<n;t++)i.push(this._type.decodeValue(e,r._type));return i}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(e){return"vec {"+e.map(e=>this._type.valueToString(e)).join("; ")+"}"}}class Fo extends _o{get typeName(){return wo.OptClass}static[Symbol.hasInstance](e){return e.typeName===wo.OptClass}constructor(e){super(),this._type=e}accept(e,t){return e.visitOpt(this,this._type,t)}covariant(e){try{if(Array.isArray(e)&&(0===e.length||1===e.length&&this._type.covariant(e[0])))return!0}catch(t){throw new Error(`Invalid ${this.display()} argument: ${Ko(e)} \n\n-> ${t.message}`)}throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){return 0===e.length?new Uint8Array([0]):ue(new Uint8Array([1]),this._type.encodeValue(e[0]))}_buildTypeTableImpl(e){this._type.buildTypeTable(e);const t=xe(po.Opt),r=this._type.encodeType(e);e.add(this,ue(t,r))}decodeValue(e,t){if(t instanceof Bo)return[];if(t instanceof Co)return[];let r=t;if(t instanceof Vo){const e=t.getType();if(void 0===e)throw new Error("type mismatch with uninitialized type");r=e}if(r instanceof Fo)switch(ge(e)){case 0:return[];case 1:{const t=e.save();try{return[this._type.decodeValue(e,r._type)]}catch(n){return e.restore(t),r._type.decodeValue(e,r._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof Bo||this._type instanceof Fo||this._type instanceof Co)return r.decodeValue(e,r),[];{const n=e.save();try{return[this._type.decodeValue(e,t)]}catch(i){return e.restore(n),r.decodeValue(e,t),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(e){return 0===e.length?"null":`opt ${this._type.valueToString(e[0])}`}}class Do extends _o{get typeName(){return wo.RecordClass}static[Symbol.hasInstance](e){return e.typeName===wo.RecordClass||e.typeName===wo.TupleClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((e,t)=>ho(e[0])-ho(t[0]))}accept(e,t){return e.visitRecord(this,this._fields,t)}tryAsTuple(){const e=[];for(let t=0;t<this._fields.length;t++){const[r,n]=this._fields[t];if(r!==`_${t}_`)return null;e.push(n)}return e}covariant(e){if("object"==typeof e&&this._fields.every(([t,r])=>{if(!e.hasOwnProperty(t))throw new Error(`Record is missing key "${t}".`);try{return r.covariant(e[t])}catch(e){throw new Error(`Invalid ${this.display()} argument: \n\nfield ${t} -> ${e.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=this._fields.map(([t])=>e[t]),r=mo(this._fields,t,([,e],t)=>e.encodeValue(t));return ue(...r)}_buildTypeTableImpl(e){this._fields.forEach(([t,r])=>r.buildTypeTable(e));const t=xe(po.Record),r=be(this._fields.length),n=this._fields.map(([t,r])=>ue(be(ho(t)),r.encodeType(e)));e.add(this,ue(t,r,ue(...n)))}decodeValue(e,t){const r=this.checkType(t);if(!(r instanceof Do))throw new Error("Not a record type");const n={};let i=0,s=0;for(;s<r._fields.length;){const[t,o]=r._fields[s];if(i>=this._fields.length){o.decodeValue(e,o),s++;continue}const[a,c]=this._fields[i],u=ho(this._fields[i][0]),d=ho(t);if(u===d)n[a]=c.decodeValue(e,o),i++,s++;else if(d>u){if(!(c instanceof Fo||c instanceof Co))throw new Error("Cannot find required field "+a);n[a]=[],i++}else o.decodeValue(e,o),s++}for(const[e,t]of this._fields.slice(i)){if(!(t instanceof Fo||t instanceof Co))throw new Error("Cannot find required field "+e);n[e]=[]}return n}get fieldsAsObject(){const e={};for(const[t,r]of this._fields)e[ho(t)]=r;return e}get name(){return`record {${this._fields.map(([e,t])=>e+":"+t.name).join("; ")}}`}display(){return`record {${this._fields.map(([e,t])=>e+":"+t.display()).join("; ")}}`}valueToString(e){const t=this._fields.map(([t])=>e[t]),r=mo(this._fields,t,([e,t],r)=>e+"="+t.valueToString(r));return`record {${r.join("; ")}}`}}class Uo extends Do{get typeName(){return wo.TupleClass}static[Symbol.hasInstance](e){return e.typeName===wo.TupleClass}constructor(e){const t={};e.forEach((e,r)=>t["_"+r+"_"]=e),super(t),this._components=e}accept(e,t){return e.visitTuple(this,this._components,t)}covariant(e){if(Array.isArray(e)&&e.length>=this._fields.length&&this._components.every((t,r)=>{try{return t.covariant(e[r])}catch(e){throw new Error(`Invalid ${this.display()} argument: \n\nindex ${r} -> ${e.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=mo(this._components,e,(e,t)=>e.encodeValue(t));return ue(...t)}decodeValue(e,t){const r=this.checkType(t);if(!(r instanceof Uo))throw new Error("not a tuple type");if(r._components.length<this._components.length)throw new Error("tuple mismatch");const n=[];for(const[t,i]of r._components.entries())t>=this._components.length?i.decodeValue(e,i):n.push(this._components[t].decodeValue(e,i));return n}display(){return`record {${this._components.map(e=>e.display()).join("; ")}}`}valueToString(e){const t=mo(this._components,e,(e,t)=>e.valueToString(t));return`record {${t.join("; ")}}`}}class qo extends _o{get typeName(){return wo.VariantClass}static[Symbol.hasInstance](e){return e.typeName===wo.VariantClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((e,t)=>ho(e[0])-ho(t[0]))}accept(e,t){return e.visitVariant(this,this._fields,t)}covariant(e){if("object"==typeof e&&1===Object.entries(e).length&&this._fields.every(([t,r])=>{try{return!e.hasOwnProperty(t)||r.covariant(e[t])}catch(e){throw new Error(`Invalid ${this.display()} argument: \n\nvariant ${t} -> ${e.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){for(let t=0;t<this._fields.length;t++){const[r,n]=this._fields[t];if(e.hasOwnProperty(r))return ue(be(t),n.encodeValue(e[r]))}throw Error("Variant has no data: "+e)}_buildTypeTableImpl(e){this._fields.forEach(([,t])=>{t.buildTypeTable(e)});const t=xe(po.Variant),r=be(this._fields.length),n=this._fields.map(([t,r])=>ue(be(ho(t)),r.encodeType(e)));e.add(this,ue(t,r,...n))}decodeValue(e,t){const r=this.checkType(t);if(!(r instanceof qo))throw new Error("Not a variant type");const n=Number(we(e));if(n>=r._fields.length)throw Error("Invalid variant index: "+n);const[i,s]=r._fields[n];for(const[t,r]of this._fields)if(ho(i)===ho(t)){const n=r.decodeValue(e,s);return{[t]:n}}throw new Error("Cannot find field hash "+i)}get name(){return`variant {${this._fields.map(([e,t])=>e+":"+t.name).join("; ")}}`}display(){return`variant {${this._fields.map(([e,t])=>e+("null"===t.name?"":`:${t.display()}`)).join("; ")}}`}valueToString(e){for(const[t,r]of this._fields)if(e.hasOwnProperty(t)){const n=r.valueToString(e[t]);return"null"===n?`variant {${t}}`:`variant {${t}=${n}}`}throw new Error("Variant has no data: "+e)}get alternativesAsObject(){const e={};for(const[t,r]of this._fields)e[ho(t)]=r;return e}}class Vo extends _o{constructor(){super(...arguments),this._id=Vo._counter++}get typeName(){return wo.RecClass}static{this._counter=0}static[Symbol.hasInstance](e){return e.typeName===wo.RecClass}accept(e,t){if(!this._type)throw Error("Recursive type uninitialized.");return e.visitRec(this,this._type,t)}fill(e){this._type=e}getType(){return this._type}covariant(e){if(this._type&&this._type.covariant(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(e)}_buildTypeTableImpl(e){if(!this._type)throw Error("Recursive type uninitialized.");e.add(this,new Uint8Array([])),this._type.buildTypeTable(e),e.merge(this,this._type.name)}decodeValue(e,t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(e,t)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`${this.name}.${this._type.name}`}valueToString(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(e)}}function Lo(e){if(1!==ge(e))throw new Error("Cannot decode principal");const t=Number(we(e));return ce.fromUint8Array(new Uint8Array(me(e,t)))}class $o extends vo{get typeName(){return wo.PrincipalClass}static[Symbol.hasInstance](e){return e.typeName===wo.PrincipalClass}accept(e,t){return e.visitPrincipal(this,t)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=e.toUint8Array(),r=be(t.byteLength);return ue(new Uint8Array([1]),r,t)}encodeType(){return xe(po.Principal)}decodeValue(e,t){return this.checkType(t),Lo(e)}get name(){return"principal"}valueToString(e){return`${this.name} "${e.toText()}"`}}class jo extends _o{get typeName(){return wo.FuncClass}static[Symbol.hasInstance](e){return e.typeName===wo.FuncClass}static argsToString(e,t){if(e.length!==t.length)throw new Error("arity mismatch");return"("+e.map((e,r)=>e.valueToString(t[r])).join(", ")+")"}constructor(e,t,r=[]){super(),this.argTypes=e,this.retTypes=t,this.annotations=r}accept(e,t){return e.visitFunc(this,t)}covariant(e){if(Array.isArray(e)&&2===e.length&&e[0]&&e[0]._isPrincipal&&"string"==typeof e[1])return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue([e,t]){const r=e.toUint8Array(),n=be(r.byteLength),i=ue(new Uint8Array([1]),n,r),s=(new TextEncoder).encode(t),o=be(s.byteLength);return ue(new Uint8Array([1]),i,o,s)}_buildTypeTableImpl(e){this.argTypes.forEach(t=>t.buildTypeTable(e)),this.retTypes.forEach(t=>t.buildTypeTable(e));const t=xe(po.Func),r=be(this.argTypes.length),n=ue(...this.argTypes.map(t=>t.encodeType(e))),i=be(this.retTypes.length),s=ue(...this.retTypes.map(t=>t.encodeType(e))),o=be(this.annotations.length),a=ue(...this.annotations.map(e=>this.encodeAnnotation(e)));e.add(this,ue(t,r,n,i,s,o,a))}decodeValue(e,t){const r=t instanceof Vo?t.getType()??t:t;if(!Ia(r,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${r.display()}`);if(1!==ge(e))throw new Error("Cannot decode function reference");const n=Lo(e),i=me(e,Number(we(e)));return[n,new TextDecoder("utf8",{fatal:!0}).decode(i)]}get name(){return`(${this.argTypes.map(e=>e.name).join(", ")}) -> (${this.retTypes.map(e=>e.name).join(", ")})${" "+this.annotations.join(" ")}`}valueToString([e,t]){return`func "${e.toText()}".${t}`}display(){return`(${this.argTypes.map(e=>e.display()).join(", ")})  (${this.retTypes.map(e=>e.display()).join(", ")})${" "+this.annotations.join(" ")}`}encodeAnnotation(e){if("query"===e)return new Uint8Array([1]);if("oneway"===e)return new Uint8Array([2]);if("composite_query"===e)return new Uint8Array([3]);throw new Error("Illegal function annotation")}}class Mo extends _o{get typeName(){return wo.ServiceClass}static[Symbol.hasInstance](e){return e.typeName===wo.ServiceClass}constructor(e){super(),this._fields=Object.entries(e).sort((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:0)}accept(e,t){return e.visitService(this,t)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${Ko(e)}`)}encodeValue(e){const t=e.toUint8Array(),r=be(t.length);return ue(new Uint8Array([1]),r,t)}_buildTypeTableImpl(e){this._fields.forEach(([t,r])=>r.buildTypeTable(e));const t=xe(po.Service),r=be(this._fields.length),n=this._fields.map(([t,r])=>{const n=(new TextEncoder).encode(t);return ue(be(n.length),n,r.encodeType(e))});e.add(this,ue(t,r,...n))}decodeValue(e,t){const r=t instanceof Vo?t.getType()??t:t;if(!Ia(r,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${r.display()}`);return Lo(e)}get name(){return`service {${this._fields.map(([e,t])=>e+":"+t.name).join("; ")}}`}valueToString(e){return`service "${e.toText()}"`}fieldsAsObject(){const e={};for(const[t,r]of this._fields)e[t]=r;return e}}function Ko(e){const t=JSON.stringify(e,(e,t)=>"bigint"==typeof t?`BigInt(${t})`:t);return t&&t.length>400?t.substring(0,397)+"...":t}function Go(e,t){if(t.length<e.length)throw Error("Wrong number of message arguments");const r=new go;e.forEach(e=>e.buildTypeTable(r));const n=(new TextEncoder).encode(yo),i=r.encode(),s=be(t.length),o=ue(...e.map(e=>e.encodeType(r))),a=ue(...mo(e,t,(e,t)=>{try{e.covariant(t)}catch(e){throw new Error(e.message+"\n\n")}return e.encodeValue(t)}));return ue(n,i,s,o,a)}function Zo(e,t){const r=new de(t);if(t.byteLength<yo.length)throw new Error("Message length smaller than magic number");const n=me(r,yo.length),i=(new TextDecoder).decode(n);if(i!==yo)throw new Error("Wrong magic number: "+JSON.stringify(i));const[s,o]=function(e){const t=[],r=Number(we(e));for(let n=0;n<r;n++){const r=Number(ve(e));switch(r){case po.Opt:case po.Vector:{const n=Number(ve(e));t.push([r,n]);break}case po.Record:case po.Variant:{const n=[];let i,s=Number(we(e));for(;s--;){const t=Number(we(e));if(t>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if("number"==typeof i&&i>=t)throw new Error("field id collision or not sorted");i=t;const r=Number(ve(e));n.push([t,r])}t.push([r,n]);break}case po.Func:{const n=[];let i=Number(we(e));for(;i--;)n.push(Number(ve(e)));const s=[];let o=Number(we(e));for(;o--;)s.push(Number(ve(e)));const a=[];let c=Number(we(e));for(;c--;)switch(Number(we(e))){case 1:a.push("query");break;case 2:a.push("oneway");break;case 3:a.push("composite_query");break;default:throw new Error("unknown annotation")}t.push([r,[n,s,a]]);break}case po.Service:{let n=Number(we(e));const i=[];for(;n--;){const t=Number(we(e)),r=(new TextDecoder).decode(me(e,t)),n=ve(e);i.push([r,n])}t.push([r,i]);break}default:throw new Error("Illegal op_code: "+r)}}const n=[],i=Number(we(e));for(let t=0;t<i;t++)n.push(Number(ve(e)));return[t,n]}(r);if(o.length<e.length)throw new Error("Wrong number of return values");const a=s.map(e=>ga());function c(e){if(e<-24)throw new Error("future value not supported");if(e<0)switch(e){case-1:return Jo;case-2:return Wo;case-3:return ea;case-4:return Qo;case-5:return aa;case-6:return ca;case-7:return ua;case-8:return da;case-9:return na;case-10:return ia;case-11:return sa;case-12:return oa;case-13:return ta;case-14:return ra;case-15:return Xo;case-16:return Ho;case-17:return zo;case-24:return la;default:throw new Error("Illegal op_code: "+e)}if(e>=s.length)throw new Error("type index out of range");return a[e]}function u(e){switch(e[0]){case po.Vector:return ha(c(e[1]));case po.Opt:return pa(c(e[1]));case po.Record:{const t={};for(const[r,n]of e[1])t[`_${r}_`]=c(n);const r=ya(t),n=r.tryAsTuple();return Array.isArray(n)?fa(...n):r}case po.Variant:{const t={};for(const[r,n]of e[1])t[`_${r}_`]=c(n);return ma(t)}case po.Func:{const[t,r,n]=e[1];return ba(t.map(e=>c(e)),r.map(e=>c(e)),n)}case po.Service:{const t={},r=e[1];for(const[e,n]of r){let r=c(n);if(r instanceof Vo&&(r=r.getType()),!(r instanceof jo))throw new Error("Illegal service definition: services can only contain functions");t[e]=r}return wa(t)}default:throw new Error("Illegal op_code: "+e[0])}}s.forEach((e,t)=>{if(e[0]===po.Func){const r=u(e);a[t].fill(r)}}),s.forEach((e,t)=>{if(e[0]!==po.Func){const r=u(e);a[t].fill(r)}}),_a();const d=o.map(e=>c(e));try{const t=e.map((e,t)=>e.decodeValue(r,d[t]));for(let t=e.length;t<d.length;t++)d[t].decodeValue(r,d[t]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return t}finally{_a()}}const zo=new Eo,Ho=new Co,Yo=new Io,Wo=new To,Jo=new Bo,Xo=new So,Qo=new No,ea=new Ao,ta=new ko(32),ra=new ko(64),na=new Oo(8),ia=new Oo(16),sa=new Oo(32),oa=new Oo(64),aa=new Po(8),ca=new Po(16),ua=new Po(32),da=new Po(64),la=new $o;function fa(...e){return new Uo(e)}function ha(e){return new Ro(e)}function pa(e){return new Fo(e)}function ya(e){return new Do(e)}function ma(e){return new qo(e)}function ga(){return new Vo}function ba(e,t,r=[]){return new jo(e,t,r)}function wa(e){return new Mo(e)}class xa{constructor(e=new Map){this.rels=e}copy(){const e=new Map;for(const[t,r]of this.rels.entries()){const n=new Map(r);e.set(t,n)}return new xa(e)}known(e,t){return this.rels.get(e.name)?.get(t.name)}addNegative(e,t){this.addNames(e.name,t.name,!1)}add(e,t){this.addNames(e.name,t.name,!0)}display(){let e="";for(const[t,r]of this.rels)for(const[n,i]of r)e+=`${t} ${i?":<":"!<:"} ${n}\n`;return e}addNames(e,t,r){const n=this.rels.get(e);if(null==n){const n=new Map;n.set(t,r),this.rels.set(e,n)}else n.set(t,r)}}let va=new xa;function _a(){va=new xa}function Ea(e){return e instanceof Fo||e instanceof Bo||e instanceof Co}function Ia(e,t){const r=Ta(va.copy(),e,t);return r?va.add(e,t):va.addNegative(e,t),r}function Ta(e,t,r){if(t.name===r.name)return!0;const n=e.known(t,r);if(void 0!==n)return n;if(e.add(t,r),r instanceof Co)return!0;if(t instanceof Eo)return!0;if(t instanceof Ao&&r instanceof No)return!0;if(t instanceof Ro&&r instanceof Ro)return Ta(e,t._type,r._type);if(r instanceof Fo)return!0;if(t instanceof Do&&r instanceof Do){const n=t.fieldsAsObject;for(const[t,i]of r._fields){const r=n[ho(t)];if(r){if(!Ta(e,r,i))return!1}else if(!Ea(i))return!1}return!0}if(t instanceof jo&&r instanceof jo){if(!function(e,t){const r=new Set(e.annotations),n=new Set(t.annotations);if(r.size!==n.size)return!1;for(const e of r)if(!n.has(e))return!1;return!0}(t,r))return!1;for(let n=0;n<t.argTypes.length;n++){const i=t.argTypes[n];if(n<r.argTypes.length){if(!Ta(e,r.argTypes[n],i))return!1}else if(!Ea(i))return!1}for(let n=0;n<r.retTypes.length;n++){const i=r.retTypes[n];if(n<t.retTypes.length){if(!Ta(e,t.retTypes[n],i))return!1}else if(!Ea(i))return!1}return!0}if(t instanceof qo&&r instanceof qo){const n=r.alternativesAsObject;for(const[r,i]of t._fields){const t=n[ho(r)];if(!t)return!1;if(!Ta(e,i,t))return!1}return!0}if(t instanceof Mo&&r instanceof Mo){const n=t.fieldsAsObject();for(const[t,i]of r._fields){const r=n[t];if(!r)return!1;if(!Ta(e,r,i))return!1}return!0}return t instanceof Vo?Ta(e,t.getType(),r):r instanceof Vo&&Ta(e,t,r.getType())}function Ba(){return function(...e){return async(t,r,n)=>{for(const i of e)await i(t,r,n)}}((e=function(){let e=!0;return async()=>!!e&&(e=!1,!0)}(),async(t,r,n)=>{if(await e(t,r,n))return new Promise(e=>setTimeout(e,1e3))}),function(){let e=1e3;return()=>new Promise(t=>setTimeout(()=>{e*=1.2,t()},e))}(),function(e){const t=Date.now()+e;return async(e,r,n)=>{if(Date.now()>t)throw Ne.fromCode(new Ye("Request timed out after 300000 msec",r,n))}}(3e5));var e}const Ca={strategy:Ba(),preSignReadStateRequest:!1};function Sa(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Na(e,t){return null!==e&&"object"==typeof e&&Sa(e,t)}function Aa(e){return Na(e,"body")&&Na(e.body,"content")&&e.body.content.request_type===fr.ReadState&&Na(e.body.content,"ingress_expiry")&&"object"==typeof e.body.content.ingress_expiry&&null!==e.body.content.ingress_expiry&&function(e,t){return Sa(e,t)&&"function"==typeof e[t]}(e.body.content.ingress_expiry,"toHash")}async function ka(e,t,r,n={}){const i=[x("request_status"),r];let s,o;if(n.preSignReadStateRequest?(o=await async function(e){const{paths:t,agent:r,pollingOptions:n}=e;if(n.request&&Aa(n.request))return n.request;const i=await(r.createReadStateRequest?.({paths:t},void 0));if(!Aa(i))throw Pe.fromCode(new gt(i));return i}({paths:[i],agent:e,pollingOptions:n}),s=await e.readState(t,{paths:[i]},void 0,o)):s=await e.readState(t,{paths:[i]}),null==e.rootKey)throw Oe.fromCode(new tt);const a=await Yi.create({certificate:s.certificate,rootKey:e.rootKey,canisterId:t,blsVerify:n.blsVerify,agent:e}),c=Xi(a.lookup_path([...i,x("status")]));let u;switch(u=void 0===c?uo.Unknown:(new TextDecoder).decode(c),u){case uo.Replied:return{reply:Xi(a.lookup_path([...i,"reply"])),certificate:a};case uo.Received:case uo.Unknown:case uo.Processing:{const i=n.strategy??Ba();return await i(t,r,u),ka(e,t,r,{...n,request:o})}case uo.Rejected:{const e=new Uint8Array(Xi(a.lookup_path([...i,"reject_code"])))[0],t=(new TextDecoder).decode(Xi(a.lookup_path([...i,"reject_message"]))),n=Xi(a.lookup_path([...i,"error_code"])),s=n?(new TextDecoder).decode(n):void 0;throw Ae.fromCode(new Je(r,e,t,s))}case uo.Done:throw Re.fromCode(new et(r))}throw xt}const Oa=Symbol.for("ic-agent-metadata");class Pa{static agentOf(e){return e[Oa].config.agent}static interfaceOf(e){return e[Oa].service}static canisterIdOf(e){return ce.from(e[Oa].config.canisterId)}static createActorClass(e,t){const r=e({IDL:n});return class extends Pa{constructor(e){if(!e.canisterId)throw Pe.fromCode(new mt(e.canisterId));const n="string"==typeof e.canisterId?ce.fromText(e.canisterId):e.canisterId;super({config:{...Fa,...e,canisterId:n},service:r});for(const[n,i]of r._fields)t?.httpDetails&&i.annotations.push(Da),t?.certificate&&i.annotations.push(Ua),this[n]=qa(this,n,i,e.blsVerify)}}}static createActor(e,t){if(!t.canisterId)throw Pe.fromCode(new mt(t.canisterId));return new(this.createActorClass(e))(t)}static createActorWithHttpDetails(e,t){return new(this.createActorClass(e,{httpDetails:!0}))(t)}static createActorWithExtendedDetails(e,t,r={httpDetails:!0,certificate:!0}){return new(this.createActorClass(e,r))(t)}constructor(e){this[Oa]=Object.freeze(e)}}function Ra(e,t){const r=Zo(e,t);switch(r.length){case 0:return;case 1:return r[0];default:return r}}const Fa={pollingOptions:Ca},Da="http-details",Ua="certificate";function qa(e,t,r,n){let i;i=r.annotations.includes("query")||r.annotations.includes("composite_query")?async(n,...i)=>{const s=(n={...n,...e[Oa].config.queryTransform?.(t,i,{...e[Oa].config,...n})}).agent||e[Oa].config.agent||new lo,o=ce.from(n.canisterId||e[Oa].config.canisterId),a=Go(r.argTypes,i),c=await s.query(o,{methodName:t,arg:a,effectiveCanisterId:n.effectiveCanisterId}),u={...c.httpDetails,requestDetails:c.requestDetails};switch(c.status){case Br.Rejected:{const e=new Xe(c.requestId,c.reject_code,c.reject_message,c.error_code,c.signatures);throw e.callContext={canisterId:o,methodName:t,httpDetails:u},Ae.fromCode(e)}case Br.Replied:return r.annotations.includes(Da)?{httpDetails:u,result:Ra(r.retTypes,c.reply.arg)}:Ra(r.retTypes,c.reply.arg)}}:async(i,...s)=>{const o=(i={...i,...e[Oa].config.callTransform?.(t,s,{...e[Oa].config,...i})}).agent||e[Oa].config.agent||lo.createSync(),{canisterId:a,effectiveCanisterId:c,pollingOptions:u}={...Fa,...e[Oa].config,...i},d=ce.from(a),l=void 0!==c?ce.from(c):d,f=Go(r.argTypes,s),{requestId:h,response:p,requestDetails:y}=await o.call(d,{methodName:t,arg:f,effectiveCanisterId:l,nonce:i.nonce});let m,g;if(null!=(b=p.body)&&"certificate"in b){if(null==o.rootKey)throw Oe.fromCode(new tt);const e=p.body.certificate;g=await Yi.create({certificate:e,rootKey:o.rootKey,canisterId:l,blsVerify:n,agent:o});const r=[x("request_status"),h];switch((new TextDecoder).decode(Xi(g.lookup_path([...r,"status"])))){case"replied":m=Xi(g.lookup_path([...r,"reply"]));break;case"rejected":{const e=new Uint8Array(Xi(g.lookup_path([...r,"reject_code"])))[0],n=(new TextDecoder).decode(Xi(g.lookup_path([...r,"reject_message"]))),i=Xi(g.lookup_path([...r,"error_code"])),s=i?(new TextDecoder).decode(i):void 0,o=new Je(h,e,n,s);throw o.callContext={canisterId:d,methodName:t,httpDetails:p},Ae.fromCode(o)}}}else if(function(e){return null!=e&&"reject_code"in e}(p.body)){const{reject_code:e,reject_message:r,error_code:n}=p.body,i=new Qe(h,e,r,n);throw i.callContext={canisterId:d,methodName:t,httpDetails:p},Ae.fromCode(i)}var b;if(202===p.status){const e={...u,blsVerify:n},t=await ka(o,l,h,e);g=t.certificate,m=t.reply}const w=r.annotations.includes(Da),v=r.annotations.includes(Ua),_={...p,requestDetails:y};if(void 0!==m)return w&&v?{httpDetails:_,certificate:g,result:Ra(r.retTypes,m)}:v?{certificate:g,result:Ra(r.retTypes,m)}:w?{httpDetails:_,result:Ra(r.retTypes,m)}:Ra(r.retTypes,m);{const e=new lt(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(e=>e.display()).join(",")}].`);throw e.callContext={canisterId:d,methodName:t,httpDetails:_},Re.fromCode(e)}};const s=(...e)=>i({},...e);return s.withOptions=e=>(...t)=>i(e,...t),s}function Va(e){return null!==e&&"object"==typeof e}class La{static from(e){if("string"==typeof e){const t=w(e);return this.fromRaw(t)}if(Va(e)){const t=e;if(Va(t)&&Object.hasOwnProperty.call(t,"__derEncodedPublicKey__"))return this.fromDer(t);if(ArrayBuffer.isView(t)){const e=t;return this.fromRaw(le(e.buffer))}if(t instanceof ArrayBuffer)return this.fromRaw(le(t));if("rawKey"in t&&t.rawKey instanceof Uint8Array)return this.fromRaw(t.rawKey);if("derKey"in t)return this.fromDer(t.derKey);if("toDer"in t)return this.fromDer(t.toDer())}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(e){return new La(e)}static fromDer(e){return new La(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){const t=Js(e,Ws);return t.__derEncodedPublicKey__=void 0,t}static derDecode(e){const t=Xs(e,Ws);if(t.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return t}#i;get rawKey(){return this.#i}#s;get derKey(){return this.#s}constructor(e){if(e.byteLength!==La.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");this.#i=e,this.#s=La.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}}class $a extends At{static generate(e){if(e&&32!==e.length)throw new Error("Ed25519 Seed needs to be 32 bytes long.");e||(e=Ps.utils.randomPrivateKey()),0===fe(e,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");const t=new Uint8Array(32);for(let r=0;r<32;r++)t[r]=e[r];const r=Ps.getPublicKey(t);return $a.fromKeyPair(r,t)}static fromParsedJson(e){const[t,r]=e;return new $a(La.fromDer(w(t)),w(r))}static fromJSON(e){const t=JSON.parse(e);if(Array.isArray(t)){if("string"==typeof t[0]&&"string"==typeof t[1])return this.fromParsedJson([t[0],t[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(e)}`)}static fromKeyPair(e,t){return new $a(La.fromRaw(e),t)}static fromSecretKey(e){const t=Ps.getPublicKey(e);return $a.fromKeyPair(t,e)}#L;#$;constructor(e,t){super(),this.#L=La.from(e),this.#$=t}toJSON(){return[g(this.#L.toDer()),g(this.#$)]}getKeyPair(){return{secretKey:this.#$,publicKey:this.#L}}getPublicKey(){return this.#L}async sign(e){const t=Ps.sign(e,this.#$.slice(0,32));return Object.defineProperty(t,"__signature__",{enumerable:!1,value:void 0}),t}static verify(e,t,r){const[n,i,s]=[e,t,r].map(e=>("string"==typeof e&&(e=w(e)),le(e)));return Ps.verify(n,i,s)}}class ja extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,ja.prototype)}}function Ma(e){if("undefined"!=typeof global&&global.crypto&&global.crypto.subtle)return global.crypto.subtle;if(e)return e;if("undefined"!=typeof crypto&&crypto.subtle)return crypto.subtle;throw new ja("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}class Ka extends At{static async generate(e){const{extractable:t=!1,keyUsages:r=["sign","verify"],subtleCrypto:n}=e??{},i=Ma(n),s=await i.generateKey({name:"ECDSA",namedCurve:"P-256"},t,r),o=le(await i.exportKey("spki",s.publicKey));return Object.assign(o,{__derEncodedPublicKey__:void 0}),new this(s,o,i)}static async fromKeyPair(e,t){const r=Ma(t),n=le(await r.exportKey("spki",e.publicKey));return Object.assign(n,{__derEncodedPublicKey__:void 0}),new Ka(e,n,r)}constructor(e,t,r){super(),this._keyPair=e,this._derKey=t,this._subtleCrypto=r}getKeyPair(){return this._keyPair}getPublicKey(){const e=this._derKey,t=Object.create(this._keyPair.publicKey);return t.toDer=function(){return e},t}async sign(e){const t=le(await this._subtleCrypto.sign({name:"ECDSA",hash:{name:"SHA-256"}},this._keyPair.privateKey,e));return Object.assign(t,{__signature__:void 0}),t}}class Ga{#r;get rawKey(){return this.#r.rawKey}get derKey(){return this.#r.derKey}toDer(){return this.#r.toDer()}getPublicKey(){return this.#r}getPrincipal(){if(!this.#r.rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return ce.fromUint8Array(new Uint8Array(this.#r.rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}constructor(e){this.#r=e}}function Za(e){if("string"!=typeof e||e.length<64)throw new Error("Invalid public key.");return w(e)}class za{constructor(e,t,r){this.pubkey=e,this.expiration=t,this.targets=r}toCborValue(){return{pubkey:this.pubkey,expiration:this.expiration,...this.targets&&{targets:this.targets}}}toJSON(){return{expiration:this.expiration.toString(16),pubkey:g(this.pubkey),...this.targets&&{targets:this.targets.map(e=>e.toHex())}}}}class Ha{static async create(e,t,r=new Date(Date.now()+9e5),n={}){const i=await async function(e,t,r,n){const i=new za(t.toDer(),BigInt(+r)*BigInt(1e6),n),s=new Uint8Array([...Nt,...new Uint8Array(Tt({...i}))]);return{delegation:i,signature:await e.sign(s)}}(e,t,r,n.targets);return new Ha([...n.previous?.delegations||[],i],n.previous?.publicKey||e.getPublicKey().toDer())}static fromJSON(e){const{publicKey:t,delegations:r}="string"==typeof e?JSON.parse(e):e;if(!Array.isArray(r))throw new Error("Invalid delegations.");return new this(r.map(e=>{const{delegation:t,signature:r}=e,{pubkey:n,expiration:i,targets:s}=t;if(void 0!==s&&!Array.isArray(s))throw new Error("Invalid targets.");return{delegation:new za(Za(n),BigInt("0x"+i),s&&s.map(e=>{if("string"!=typeof e)throw new Error("Invalid target.");return ce.fromHex(e)})),signature:Za(r)}}),Za(t))}static fromDelegations(e,t){return new this(e,t)}constructor(e,t){this.delegations=e,this.publicKey=t}toJSON(){return{delegations:this.delegations.map(e=>{const{delegation:t,signature:r}=e,{targets:n}=t;return{delegation:{expiration:t.expiration.toString(16),pubkey:g(t.pubkey),...n&&{targets:n.map(e=>e.toHex())}},signature:g(r)}}),publicKey:g(this.publicKey)}}}class Ya extends At{static fromDelegation(e,t){return new this(e,t)}constructor(e,t){super(),this._inner=e,this._delegation=t}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(e){return this._inner.sign(e)}async transformRequest(e){const{body:t,...r}=e,n=await Tt(t);return{...r,body:{content:t,sender_sig:await this.sign(new Uint8Array([...Ct,...new Uint8Array(n)])),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}}}}class Wa extends Ga{#j;get delegation(){return this.#j}constructor(e,t){super(e),this.#j=t}static fromDelegation(e,t){return new Wa(e,t)}}function Ja(e,t){for(const{delegation:t}of e.delegations)if(+new Date(Number(t.expiration/BigInt(1e6)))<=+Date.now())return!1;const r=[],n=t?.scope;n&&(Array.isArray(n)?r.push(...n.map(e=>"string"==typeof e?ce.fromText(e):e)):r.push("string"==typeof n?ce.fromText(n):n));for(const t of r){const r=t.toText();for(const{delegation:t}of e.delegations){if(void 0===t.targets)continue;let e=!0;for(const n of t.targets)if(n.toText()===r){e=!1;break}if(e)return!1}}return!0}const Xa=["mousedown","mousemove","keydown","touchstart","wheel"];class Qa{callbacks=[];idleTimeout=6e5;timeoutID=void 0;static create(e={}){return new this(e)}constructor(e={}){const{onIdle:t,idleTimeout:r=6e5}=e||{};this.callbacks=t?[t]:[],this.idleTimeout=r;const n=this._resetTimer.bind(this);window.addEventListener("load",n,!0),Xa.forEach(function(e){document.addEventListener(e,n,!0)});const i=(e,t)=>{let r;return(...n)=>{const i=this;clearTimeout(r),r=window.setTimeout(function(){r=void 0,e.apply(i,n)},t)}};if(e?.captureScroll){const t=i(n,e?.scrollDebounce??100);window.addEventListener("scroll",t,!0)}n()}registerCallback(e){this.callbacks.push(e)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);const e=this._resetTimer.bind(this);Xa.forEach(function(t){document.removeEventListener(t,e,!0)}),this.callbacks.forEach(e=>e())}_resetTimer(){const e=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(e,this.idleTimeout)}}let ec,tc;const rc=new WeakMap,nc=new WeakMap,ic=new WeakMap,sc=new WeakMap,oc=new WeakMap;let ac={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return nc.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ic.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return uc(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function cc(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(tc||(tc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(dc(this),e),uc(rc.get(this))}:function(...e){return uc(t.apply(dc(this),e))}:function(e,...r){const n=t.call(dc(this),e,...r);return ic.set(n,e.sort?e.sort():[e]),uc(n)}:(e instanceof IDBTransaction&&function(e){if(nc.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});nc.set(e,t)}(e),r=e,(ec||(ec=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(e,ac):e);var t,r}function uc(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(uc(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&rc.set(t,e)}).catch(()=>{}),oc.set(t,e),t}(e);if(sc.has(e))return sc.get(e);const t=cc(e);return t!==e&&(sc.set(e,t),oc.set(t,e)),t}const dc=e=>oc.get(e),lc=["get","getKey","getAll","getAllKeys","count"],fc=["put","add","delete","clear"],hc=new Map;function pc(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(hc.get(t))return hc.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=fc.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!lc.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),i&&s.done]))[0]};return hc.set(t,s),s}var yc;yc=ac,ac={...yc,get:(e,t,r)=>pc(e,t)||yc.get(e,t,r),has:(e,t)=>!!pc(e,t)||yc.has(e,t)};const mc="auth-client-db",gc="ic-keyval";class bc{_db;_storeName;static async create(e){const{dbName:t=mc,storeName:r=gc,version:n=vc}=e??{},i=await(async(e=mc,t=gc,r)=>(_c&&localStorage?.getItem(xc)&&(localStorage.removeItem(xc),localStorage.removeItem(wc)),await function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=uc(o);return n&&o.addEventListener("upgradeneeded",e=>{n(uc(o.result),e.oldVersion,e.newVersion,uc(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}(e,r,{upgrade:e=>{e.objectStoreNames.contains(t)&&e.clear(t),e.createObjectStore(t)}})))(t,r,n);return new bc(i,r)}constructor(e,t){this._db=e,this._storeName=t}async set(e,t){return await async function(e,t,r,n){return await e.put(t,n,r)}(this._db,this._storeName,e,t)}async get(e){return await async function(e,t,r){return await e.get(t,r)}(this._db,this._storeName,e)??null}async remove(e){return await async function(e,t,r){return await e.delete(t,r)}(this._db,this._storeName,e)}}const wc="identity",xc="delegation",vc=1,_c="undefined"!=typeof window;class Ec{prefix;_localStorage;constructor(e="ic-",t){this.prefix=e,this._localStorage=t}get(e){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+e))}set(e,t){return this._getLocalStorage().setItem(this.prefix+e,t),Promise.resolve()}remove(e){return this._getLocalStorage().removeItem(this.prefix+e),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;const e="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?void 0:self.localStorage:global.localStorage:window.localStorage;if(!e)throw new Error("Could not find local storage.");return e}}class Ic{#M;constructor(e){this.#M=e??{}}initializedDb;get _db(){return new Promise(e=>{this.initializedDb?e(this.initializedDb):bc.create(this.#M).then(t=>{this.initializedDb=t,e(t)})})}async get(e){const t=await this._db;return await t.get(e)}async set(e,t){const r=await this._db;await r.set(e,t)}async remove(e){const t=await this._db;await t.remove(e)}}const Tc=BigInt(1e9)*BigInt(3600),Bc=BigInt(8)*Tc,Cc="ECDSA",Sc="Ed25519";class Nc{_identity;_key;_chain;_storage;idleManager;_createOptions;_idpWindow;_eventHandler;static async create(e={}){const t=e.storage??new Ic,r=e.keyType??Cc;let n=null;if(e.identity)n=e.identity;else{let e=await t.get(wc);if(!e&&_c)try{const n=new Ec,i=await n.get(xc),s=await n.get(wc);i&&s&&r===Cc&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await t.set(xc,i),await t.set(wc,s),e=i,await n.remove(xc),await n.remove(wc))}catch(e){console.error("error while attempting to recover localstorage: "+e)}if(e)try{"object"==typeof e?n=r===Sc&&"string"==typeof e?$a.fromJSON(e):await Ka.fromKeyPair(e):"string"==typeof e&&(n=$a.fromJSON(e))}catch{}}let i,s=new kt,o=null;if(n)try{const r=await t.get(xc);if("object"==typeof r&&null!==r)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");e.identity?s=e.identity:r&&(o=Ha.fromJSON(r),Ja(o)?s="toDer"in n?Wa.fromDelegation(n,o):Ya.fromDelegation(n,o):(await Ac(t),n=null))}catch(e){console.error(e),await Ac(t),n=null}return e.idleOptions?.disableIdle?i=void 0:(o||e.identity)&&(i=Qa.create(e.idleOptions)),n||(r===Sc?(n=$a.generate(),await t.set(wc,JSON.stringify(n.toJSON()))):(e.storage&&r===Cc&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${Sc}' as the key type, as it can serialize to a string`),n=await Ka.generate(),await t.set(wc,n.getKeyPair()))),new this(s,n,o,t,i,e)}constructor(e,t,r,n,i,s,o,a){this._identity=e,this._key=t,this._chain=r,this._storage=n,this.idleManager=i,this._createOptions=s,this._idpWindow=o,this._eventHandler=a,this._registerDefaultIdleCallback()}_registerDefaultIdleCallback(){const e=this._createOptions?.idleOptions;e?.onIdle||e?.disableDefaultIdleCallback||this.idleManager?.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(e,t){const r=e.delegations.map(e=>({delegation:new za(e.delegation.pubkey,e.delegation.expiration,e.delegation.targets),signature:e.signature})),n=Ha.fromDelegations(r,e.userPublicKey),i=this._key;if(!i)return;this._chain=n,this._identity="toDer"in i?Wa.fromDelegation(i,this._chain):Ya.fromDelegation(i,this._chain),this._idpWindow?.close();const s=this._createOptions?.idleOptions;this.idleManager||s?.disableIdle||(this.idleManager=Qa.create(s),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(xc,JSON.stringify(this._chain.toJSON())),t?.(e)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&null!==this._chain&&Ja(this._chain)}async login(e){const t=function(e,t){if(!e&&!t)return;const r=e?.customValues||t?.customValues?{...e?.customValues,...t?.customValues}:void 0;return{...e,...t,customValues:r}}(this._createOptions?.loginOptions,e),r=t?.maxTimeToLive??Bc,n=new URL(t?.identityProvider?.toString()||"https://identity.internetcomputer.org");n.hash="#authorize",this._idpWindow?.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(n,{maxTimeToLive:r,...t}),window.addEventListener("message",this._eventHandler),this._idpWindow=window.open(n.toString(),"idpWindow",t?.windowOpenerFeatures)??void 0;const i=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure("UserInterrupt",t?.onError):setTimeout(i,500))};i()}_getEventHandler(e,t){return async r=>{if(r.origin!==e.origin)return;const n=r.data;switch(n.kind){case"authorize-ready":{const r={kind:"authorize-client",sessionPublicKey:new Uint8Array(this._key?.getPublicKey().toDer()),maxTimeToLive:t?.maxTimeToLive,allowPinAuthentication:t?.allowPinAuthentication,derivationOrigin:t?.derivationOrigin?.toString(),...t?.customValues};this._idpWindow?.postMessage(r,e.origin);break}case"authorize-client-success":try{await this._handleSuccess(n,t?.onSuccess)}catch(e){this._handleFailure(e.message,t?.onError)}break;case"authorize-client-failure":this._handleFailure(n.text,t?.onError)}}}_handleFailure(e,t){this._idpWindow?.close(),t?.(e),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(e={}){if(await Ac(this._storage),this._identity=new kt,this._chain=null,e.returnTo)try{window.history.pushState({},"",e.returnTo)}catch{window.location.href=e.returnTo}}}async function Ac(e){await e.remove(wc),await e.remove(xc),await e.remove("iv")}const kc=({IDL:e})=>{const t=e.Variant({ok:e.Text,err:e.Text}),r=e.Variant({ok:e.Record({nickname:e.Text,message:e.Text,gameProfile:e.Opt(e.Record({total_score:e.Nat64,best_streak:e.Nat64,achievements:e.Vec(e.Text),last_played:e.Nat64,play_count:e.Nat}))}),err:e.Text}),n=e.Variant({internetIdentity:e.Null,apple:e.Null,google:e.Null}),i=e.Record({created:e.Nat64,nickname:e.Text,expires:e.Nat64,authType:n,email:e.Text,sessionId:e.Text,lastUsed:e.Nat64}),s=e.Variant({ok:i,err:e.Text}),o=e.Record({created:e.Nat64,absoluteScoreCap:e.Opt(e.Nat64),totalPlayers:e.Nat,owner:e.Principal,absoluteStreakCap:e.Opt(e.Nat64),name:e.Text,gameId:e.Text,description:e.Text,isActive:e.Bool,maxStreakDelta:e.Opt(e.Nat64),maxScorePerRound:e.Opt(e.Nat64),totalPlays:e.Nat}),a=e.Record({uniquePlayers:e.Nat,date:e.Text,gameId:e.Text,totalScore:e.Nat64,totalGames:e.Nat,newUsers:e.Nat,authenticatedPlays:e.Nat}),c=e.Record({game:o,permanentDeletionAt:e.Nat64,canRecover:e.Bool,deletedAt:e.Nat64,deletedBy:e.Principal,reason:e.Text}),u=e.Record({total_score:e.Nat64,gameId:e.Text,best_streak:e.Nat64,achievements:e.Vec(e.Text),last_played:e.Nat64,play_count:e.Nat}),d=e.Variant({ok:u,err:e.Text}),l=e.Variant({streak:e.Null,score:e.Null}),f=e.Variant({principal:e.Principal,email:e.Text}),h=e.Record({created:e.Nat64,nickname:e.Text,gameProfiles:e.Vec(e.Tuple(e.Text,u)),authType:n,last_updated:e.Nat64,identifier:f}),p=e.Variant({ok:h,err:e.Text}),y=e.Record({lastPlayed:e.Nat64,avgScore:e.Nat64,gameId:e.Text,favoriteTime:e.Text,totalGames:e.Nat,playStreak:e.Nat,identifier:f}),m=e.Record({metadata:e.Vec(e.Tuple(e.Text,e.Text)),gameId:e.Text,timestamp:e.Nat64,identifier:f,eventType:e.Text}),g=e.Record({created:e.Nat64,nickname:e.Text,gameProfiles:e.Vec(e.Tuple(e.Text,u)),authType:n,last_updated:e.Nat64}),b=e.Variant({ok:g,err:e.Text}),w=e.Variant({ok:e.Record({isNewUser:e.Bool,nickname:e.Text,message:e.Text,gameProfile:e.Opt(e.Record({total_score:e.Nat64,best_streak:e.Nat64,achievements:e.Vec(e.Text),last_played:e.Nat64,play_count:e.Nat}))}),err:e.Text}),x=e.Variant({ok:e.Record({isNewUser:e.Bool,nickname:e.Text,message:e.Text,sessionId:e.Text,gameProfile:e.Opt(e.Record({total_score:e.Nat64,best_streak:e.Nat64,achievements:e.Vec(e.Text),last_played:e.Nat64,play_count:e.Nat}))}),err:e.Text}),v=e.Variant({ok:e.Record({nickname:e.Text,valid:e.Bool,email:e.Text}),err:e.Text});return e.Service({adminCleanupSessions:e.Func([],[e.Text],[]),adminGate:e.Func([e.Text,e.Vec(e.Text)],[t],[]),canDeleteGame:e.Func([],[e.Bool],["query"]),changeNicknameAndGetProfile:e.Func([e.Text,e.Text,e.Text,e.Text],[r],[]),cleanupExpiredGames:e.Func([],[t],[]),createSessionForVerifiedUser:e.Func([n,e.Text,e.Opt(e.Text),e.Text],[s],[]),deleteFile:e.Func([e.Text],[t],[]),deleteGame:e.Func([e.Text],[t],[]),destroySession:e.Func([e.Text],[t],[]),getAchievements:e.Func([e.Text,e.Text,e.Text],[e.Vec(e.Text)],["query"]),getActiveGames:e.Func([],[e.Vec(o)],["query"]),getActiveSessions:e.Func([],[e.Nat],["query"]),getAnalyticsSummary:e.Func([],[e.Record({uniquePlayers:e.Nat,totalEvents:e.Nat,totalDays:e.Nat,totalGames:e.Nat,recentEvents:e.Nat,mostActiveDay:e.Text})],["query"]),getDailyStats:e.Func([e.Text,e.Text],[e.Opt(a)],["query"]),getDeletedGames:e.Func([],[e.Vec(c)],["query"]),getDetailedStats:e.Func([e.Text],[e.Record({game:e.Opt(e.Record({totalPlayers:e.Nat,isActive:e.Bool,totalGames:e.Nat})),submissions:e.Record({today:e.Nat,total:e.Nat})})],["query"]),getFile:e.Func([e.Text],[e.Opt(e.Vec(e.Nat8))],["query"]),getFileInfo:e.Func([e.Text],[e.Opt(e.Record({name:e.Text,size:e.Nat}))],["query"]),getGame:e.Func([e.Text],[e.Opt(o)],["query"]),getGameAuthStats:e.Func([e.Text],[e.Record({total:e.Nat,internetIdentity:e.Nat,apple:e.Nat,google:e.Nat})],["query"]),getGameProfile:e.Func([e.Text,e.Text,e.Text],[d],["query"]),getGamesByOwner:e.Func([e.Principal],[e.Vec(o)],["query"]),getLeaderboard:e.Func([e.Text,l,e.Nat],[e.Vec(e.Tuple(e.Text,e.Nat64,e.Nat64,e.Text))],["query"]),getLeaderboardByAuth:e.Func([e.Text,n,l,e.Nat],[e.Vec(e.Tuple(e.Text,e.Nat64,e.Nat64,e.Text))],["query"]),getMyGameCount:e.Func([],[e.Nat],["query"]),getMyProfile:e.Func([],[p],[]),getMyProfileBySession:e.Func([e.Text],[p],[]),getNicknameBySession:e.Func([e.Text],[t],[]),getPlayerAnalytics:e.Func([e.Text,e.Text,e.Text],[e.Opt(y)],["query"]),getPlayerRank:e.Func([e.Text,l,e.Text,e.Text],[e.Opt(e.Record({streak:e.Nat64,totalPlayers:e.Nat,rank:e.Nat,score:e.Nat64}))],["query"]),getRecentEvents:e.Func([e.Nat],[e.Vec(m)],["query"]),getRemainingDeleteAttempts:e.Func([],[e.Nat],["query"]),getRemainingGameSlots:e.Func([],[e.Nat],["query"]),getSessionInfo:e.Func([e.Text],[e.Opt(e.Record({created:e.Nat64,nickname:e.Text,expires:e.Nat64,authType:e.Text,email:e.Text,lastUsed:e.Nat64}))],["query"]),getSubmissionStats:e.Func([],[e.Record({today:e.Nat,total:e.Nat,date:e.Text})],["query"]),getSystemInfo:e.Func([],[e.Record({principalUserCount:e.Nat,fileCount:e.Nat,totalEvents:e.Nat,gameCount:e.Nat,suspicionLogSize:e.Nat,activeDays:e.Nat,emailUserCount:e.Nat})],["query"]),getUserProfile:e.Func([e.Text,e.Text],[b],["query"]),iiLoginAndGetProfile:e.Func([e.Text,e.Text],[w],[]),listFiles:e.Func([],[e.Vec(e.Text)],["query"]),listGames:e.Func([],[e.Vec(o)],["query"]),permanentlyDeleteGame:e.Func([e.Text],[t],[]),recoverDeletedGame:e.Func([e.Text],[t],[]),registerGame:e.Func([e.Text,e.Text,e.Text,e.Opt(e.Nat64),e.Opt(e.Nat64),e.Opt(e.Nat64),e.Opt(e.Nat64)],[t],[]),socialLoginAndGetProfile:e.Func([e.Text,e.Text,e.Text,e.Text],[x],[]),submitScore:e.Func([e.Text,e.Text,e.Text,e.Nat,e.Nat,e.Opt(e.Nat)],[t],[]),suggestNickname:e.Func([],[t],[]),toggleGameActive:e.Func([e.Text],[t],[]),trackEvent:e.Func([e.Text,e.Text,e.Text,e.Text,e.Vec(e.Tuple(e.Text,e.Text))],[],[]),unlockAchievement:e.Func([e.Text,e.Text,e.Text,e.Text],[t],[]),updateGame:e.Func([e.Text,e.Text,e.Text],[t],[]),updateGameRules:e.Func([e.Text,e.Opt(e.Nat64),e.Opt(e.Nat64),e.Opt(e.Nat64),e.Opt(e.Nat64)],[t],[]),uploadFile:e.Func([e.Text,e.Vec(e.Nat8)],[t],[]),validateSession:e.Func([e.Text],[v],[])})};function Oc(){try{if(window.top===window)return window.location.origin;const e=document.referrer;if(e)return new URL(e).origin}catch(e){}return window.location.origin}e=r.hmd(e),(async()=>{try{window.cheddaAuthClient||(window.cheddaAuthClient=await Nc.create())}catch(e){console.error("[CheddaBoards] Failed to create AuthClient early:",e)}})();class Pc{constructor(e={}){if(!e.gameId)throw new Error('[CheddaBoards] gameId is required. Initialize with: CheddaBoards.init(canisterId, { gameId: "your-game-id" })');this.canisterId=e.canisterId||"fdvph-sqaaa-aaaap-qqc4a-cai",this.gameId=e.gameId,this.gameName=e.gameName||"Unnamed Game",this.gameDescription=e.gameDescription||"CheddaBoards SDK",this.host=e.host||(this._isLocal()?"http://localhost:4943":"https://icp-api.io"),this.autoInit=!0===e.autoInit,this.config=e,this.actor=null,this.agent=null,this.identity=new kt,this.authClient=null,this.profile=null,this.sessionId=null,this.userType=null,this.userId=null,this.authType=null,this.authData=null,this._initialized=!1,this._initInProgress=!1,this._initPromise=null,this._iiInFlight=!1,this.autoInit&&this.init().catch(e=>console.error("[CheddaBoards] autoInit failed:",e))}_isLocal(){try{const e=window?.location?.hostname||"";return"localhost"===e||"127.0.0.1"===e}catch{return!1}}async init(){return!!this._initialized||(this._initPromise||(this._initPromise=(async()=>{this._initInProgress=!0;try{if(console.log("[CheddaBoards] Initializing for game:",this.gameId),await this._createActor({identity:this.identity}),await this._restoreSession(),this.userType){const e=await this.loadProfile();e&&"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("profile_loaded",e.nickname,String(e.score||0),String(e.streak||0),JSON.stringify(e.achievements||[]))}return this._initialized=!0,!0}catch(e){return console.error("[CheddaBoards] Init failed:",e),!1}finally{this._initInProgress=!1,this._initPromise=null}})()),this._initPromise)}async _restoreSession(){const e=sessionStorage.getItem("chedda_auth");if(e)try{const t=JSON.parse(e);if(t.sessionId){const e=await this.actor.validateSession(t.sessionId);e&&e.ok?Object.assign(this,{sessionId:t.sessionId,authData:t,userType:t.userType,userId:t.userId,authType:t.authType}):sessionStorage.removeItem("chedda_auth")}else this.authData=t,this.userType=t.userType,this.userId=t.userId,this.authType=t.authType,"internetIdentity"!==t.authType&&"cheddaId"!==t.authType||await this._restoreIISession()}catch(e){console.error("[CheddaBoards] Session restoration failed:",e),sessionStorage.removeItem("chedda_auth")}}async _restoreIISession(){try{this.authClient=window.cheddaAuthClient||await Nc.create(),await this.authClient.isAuthenticated()?(this.identity=this.authClient.getIdentity(),await this._createActor({identity:this.identity})):(sessionStorage.removeItem("chedda_auth"),this.identity=new kt,this.userType=null,this.userId=null,this.authType=null,this.sessionId=null,await this._createActor({identity:this.identity}))}catch(e){console.error("[CheddaBoards] II restore failed:",e)}}async _createActor({identity:e}={}){const t=e||this.identity||new kt;if(this.identity=t,this.agent=new lo({identity:t,host:this.host}),this._isLocal())try{await this.agent.fetchRootKey()}catch(e){}this.actor=Pa.createActor(kc,{agent:this.agent,canisterId:this.canisterId})}_promptForNickname(e=""){if("undefined"==typeof window)return null;const t=window.prompt("Choose your nickname:",e);return t?t.trim():null}async _getSuggestedNickname(){try{this.actor||await this._createActor({identity:this.identity});const e=await this.actor.suggestNickname();return e?.ok?e.ok:`Player_${Math.floor(1e4*Math.random())}`}catch(e){return console.error("[CheddaBoards] Failed to get nickname suggestion:",e),`Player_${Math.floor(1e4*Math.random())}`}}async registerGame(e,t,r={}){try{const n=this.authClient||window.cheddaAuthClient;if(!n||!await n.isAuthenticated())throw new Error(" Must authenticate with Chedda ID to register a game. Call loginChedda() first.");this.identity=n.getIdentity(),await this._createActor({identity:this.identity});const i=await this.actor.registerGame(this.gameId,e||this.gameName,t||this.gameDescription,r.maxScorePerRound?[r.maxScorePerRound]:[],r.maxStreakDelta?[r.maxStreakDelta]:[],r.absoluteScoreCap?[r.absoluteScoreCap]:[],r.absoluteStreakCap?[r.absoluteStreakCap]:[]);return i?.ok?{success:!0,message:i.ok}:i?.err?{success:!1,error:i.err}:{success:!0,message:"Game registered"}}catch(e){return console.error("[CheddaBoards] Game registration failed:",e),{success:!1,error:e.message}}}async getMyGameCount(){try{const e=this.authClient||window.cheddaAuthClient;if(!e||!await e.isAuthenticated())return 0;this.identity=e.getIdentity(),await this._createActor({identity:this.identity});const t=await this.actor.getMyGameCount();return Number(t)}catch(e){return console.error("[CheddaBoards] Get game count failed:",e),0}}async getRemainingGameSlots(){try{const e=this.authClient||window.cheddaAuthClient;if(!e||!await e.isAuthenticated())return 0;this.identity=e.getIdentity(),await this._createActor({identity:this.identity});const t=await this.actor.getRemainingGameSlots();return Number(t)}catch(e){return console.error("[CheddaBoards] Get remaining slots failed:",e),0}}async loginChedda(e=null){return console.log("[CheddaBoards] Starting Chedda ID login..."),this.authClient=window.cheddaAuthClient||await Nc.create(),this._iiInFlight?(console.warn("[CheddaBoards] II login already in progress"),Promise.reject("login_in_flight")):(this._iiInFlight=!0,new Promise((t,r)=>{this.authClient.login({identityProvider:"https://identity.ic0.app",derivationOrigin:Oc(),maxTimeToLive:604800000000000n,onSuccess:async()=>{try{console.log("[CheddaBoards]  II authentication successful"),this.identity=this.authClient.getIdentity();const r=this.identity.getPrincipal().toText();console.log("[CheddaBoards] Principal:",r),await this._createActor({identity:this.identity}),this.userType="principal",this.userId=r,this.authType="cheddaId",this.sessionId=null;const n=`Chedda${Math.floor(1e4*Math.random())}`,i=await this.actor.iiLoginAndGetProfile(n,this.gameId);if(console.log("[CheddaBoards] Backend login result:",i),i?.err)throw new Error(i.err);const s=i.ok;if(!s)throw new Error("No data returned from backend");const o=!s.nickname||s.nickname.startsWith("Chedda")||s.nickname.startsWith("Player_");let a=s.nickname||n;if(console.log("[CheddaBoards] Is new user:",o,"Current nickname:",a),o&&!e){const e=await this._getSuggestedNickname(),t=this._promptForNickname(e);if(t&&t.trim()&&t!==e){console.log("[CheddaBoards] Changing nickname from",a,"to",t.trim());const e=await this.actor.changeNicknameAndGetProfile("principal",r,t.trim(),this.gameId);console.log("[CheddaBoards] Change nickname result:",e),e?.ok?(a=e.ok.nickname,e.ok.gameProfile&&Object.assign(s,{nickname:e.ok.nickname,gameProfile:e.ok.gameProfile})):console.warn("[CheddaBoards] Nickname change failed, using:",a)}else t&&t.trim()===e&&(a=e)}else e&&(a=e);this.authData={userType:"principal",userId:r,authType:"cheddaId",nickname:a},sessionStorage.setItem("chedda_auth",JSON.stringify(this.authData)),sessionStorage.setItem("auth_method","cheddaId"),this.profile={nickname:a,score:s.gameProfile?Number(s.gameProfile.total_score||0):0,streak:s.gameProfile?Number(s.gameProfile.best_streak||0):0,achievements:s.gameProfile?s.gameProfile.achievements:[],lastPlayed:s.gameProfile?s.gameProfile.last_played:void 0,playCount:s.gameProfile?Number(s.gameProfile.play_count||0):0,gameId:this.gameId,authType:"cheddaId"},"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("chedda_id_login_success",this.profile.nickname,String(this.profile.score||0),String(this.profile.streak||0),JSON.stringify(this.profile.achievements||[])),this._iiInFlight=!1,t(this.profile)}catch(e){console.error("[CheddaBoards] Chedda ID login error:",e),this._iiInFlight=!1,r(e)}},onError:e=>{console.error("[CheddaBoards] Chedda ID authentication failed:",e),this._iiInFlight=!1,r(e)}})}))}async loginII2(e=null){return console.log("[CheddaBoards] Starting Internet Identity 2.0 login..."),this.authClient=window.cheddaAuthClient||await Nc.create(),this._iiInFlight?(console.warn("[CheddaBoards] II 2.0 login already in progress"),Promise.reject("login_in_flight")):(this._iiInFlight=!0,new Promise((t,r)=>{this.authClient.login({identityProvider:"https://identity.internetcomputer.org",derivationOrigin:Oc(),maxTimeToLive:604800000000000n,onSuccess:async()=>{try{console.log("[CheddaBoards]  II 2.0 authentication successful"),this.identity=this.authClient.getIdentity();const r=this.identity.getPrincipal().toText();console.log("[CheddaBoards] Principal:",r),await this._createActor({identity:this.identity}),this.userType="principal",this.userId=r,this.authType="cheddaId",this.sessionId=null;const n=`Chedda${Math.floor(1e4*Math.random())}`,i=await this.actor.iiLoginAndGetProfile(n,this.gameId);if(console.log("[CheddaBoards] Backend login result:",i),i?.err)throw new Error(i.err);const s=i.ok;if(!s)throw new Error("No data returned from backend");const o=!s.nickname||s.nickname.startsWith("Chedda")||s.nickname.startsWith("Player_");let a=s.nickname||n;if(console.log("[CheddaBoards] Is new user:",o,"Current nickname:",a),o&&!e){const e=await this._getSuggestedNickname(),t=this._promptForNickname(e);if(t&&t.trim()&&t!==e){console.log("[CheddaBoards] Changing nickname from",a,"to",t.trim());const e=await this.actor.changeNicknameAndGetProfile("principal",r,t.trim(),this.gameId);console.log("[CheddaBoards] Change nickname result:",e),e?.ok?(a=e.ok.nickname,e.ok.gameProfile&&Object.assign(s,{nickname:e.ok.nickname,gameProfile:e.ok.gameProfile})):console.warn("[CheddaBoards] Nickname change failed, using:",a)}else t&&t.trim()===e&&(a=e)}else e&&(a=e);this.authData={userType:"principal",userId:r,authType:"cheddaId",nickname:a},sessionStorage.setItem("chedda_auth",JSON.stringify(this.authData)),sessionStorage.setItem("auth_method","cheddaId"),this.profile={nickname:a,score:s.gameProfile?Number(s.gameProfile.total_score||0):0,streak:s.gameProfile?Number(s.gameProfile.best_streak||0):0,achievements:s.gameProfile?s.gameProfile.achievements:[],lastPlayed:s.gameProfile?s.gameProfile.last_played:void 0,playCount:s.gameProfile?Number(s.gameProfile.play_count||0):0,gameId:this.gameId,authType:"cheddaId"},"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("chedda_id_login_success",this.profile.nickname,String(this.profile.score||0),String(this.profile.streak||0),JSON.stringify(this.profile.achievements||[])),console.log("[CheddaBoards] II 2.0 login complete:",this.profile.nickname),this._iiInFlight=!1,t(this.profile)}catch(e){console.error("[CheddaBoards] II 2.0 login error:",e),this._iiInFlight=!1,r(e)}},onError:e=>{console.error("[CheddaBoards] II 2.0 authentication failed:",e),this._iiInFlight=!1,r(e)}})}))}async loginGoogle(e,t=null){try{console.log("[CheddaBoards] Google login via CheddaAuth");const r=crypto.randomUUID(),n=crypto.randomUUID(),i=await fetch(Rc,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({provider:"google",id_token:e,state:r,nonce:n})}),s=await i.json();if(!(s&&s.ok&&s.session&&s.session.sessionId))throw console.error("[CheddaBoards] Verifier error:",s),new Error(s?.error||"Google verify failed");const o=s.session.sessionId,a=s.session.email;this.identity=new kt,await this._createActor({identity:this.identity}),this.userType="email",this.userId=o,this.authType="google",this.sessionId=o;const c=t||`Chedda${Math.floor(1e4*Math.random())}`,u=await this.actor.socialLoginAndGetProfile(a,c,"google",this.gameId);if(u?.err)throw new Error(u.err);const d=u.ok,l=d.isNewUser||d.nickname.includes("@")||d.nickname.startsWith("Chedda")||d.nickname.startsWith("Player_");let f=d.nickname;if(console.log("[CheddaBoards] Is new user:",l,"Current nickname:",f),l&&!t){const e=await this._getSuggestedNickname(),t=this._promptForNickname(e);if(t&&t.trim()&&t!==e){console.log("[CheddaBoards] Changing nickname from",f,"to",t.trim());const e=await this.changeNickname(t.trim());console.log("[CheddaBoards] Change nickname result:",e),e?.success&&(f=t.trim())}else t&&t.trim()===e&&(f=e)}return this.profile={nickname:f,score:d.gameProfile?Number(d.gameProfile.total_score||0):0,streak:d.gameProfile?Number(d.gameProfile.best_streak||0):0,achievements:d.gameProfile?d.gameProfile.achievements:[],lastPlayed:d.gameProfile?d.gameProfile.last_played:void 0,playCount:d.gameProfile?Number(d.gameProfile.play_count||0):0,gameId:this.gameId,authType:"google"},this.authData={userType:"email",userId:o,authType:"google",nickname:f,sessionId:o},sessionStorage.setItem("chedda_auth",JSON.stringify(this.authData)),sessionStorage.setItem("auth_method","google"),"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("google_login_success",this.profile.nickname||"",String(this.profile.score||0),String(this.profile.streak||0),JSON.stringify(this.profile.achievements||[])),console.log("[CheddaBoards] Google login complete:",f),this.profile}catch(e){throw console.error("Google login failed:",e),e}}async loginApple(e,t=null){try{if(console.log("[CheddaBoards] Apple login via CheddaAuth"),!e||!e.id_token)throw new Error("Invalid Apple sign-in response (missing id_token)");t||console.warn("[CheddaBoards] No nonce provided for Apple login");const r=crypto.randomUUID(),n=await fetch(Rc,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({provider:"apple",id_token:e.id_token,state:r,nonce:t||void 0})}),i=await n.json();if(!(i&&i.ok&&i.session&&i.session.sessionId))throw console.error("[CheddaBoards] Verifier error:",i),new Error(i?.error||"Apple verify failed");const s=i.session.sessionId,o=i.session.email;this.identity=new kt,await this._createActor({identity:this.identity}),this.userType="email",this.userId=s,this.authType="apple",this.sessionId=s;const a=`Chedda${Math.floor(1e4*Math.random())}`,c=await this.actor.socialLoginAndGetProfile(o,a,"apple",this.gameId);if(c?.err)throw new Error(c.err);const u=c.ok,d=u.isNewUser||u.nickname.includes("@")||u.nickname.startsWith("Chedda")||u.nickname.startsWith("Player_");let l=u.nickname;if(console.log("[CheddaBoards] Is new user:",d,"Current nickname:",l),d){const e=await this._getSuggestedNickname(),t=this._promptForNickname(e);if(t&&t.trim()&&t!==e){console.log("[CheddaBoards] Changing nickname from",l,"to",t.trim());const e=await this.changeNickname(t.trim());console.log("[CheddaBoards] Change nickname result:",e),e?.success&&(l=t.trim())}else t&&t.trim()===e&&(l=e)}return this.profile={nickname:l,score:u.gameProfile?Number(u.gameProfile.total_score||0):0,streak:u.gameProfile?Number(u.gameProfile.best_streak||0):0,achievements:u.gameProfile?u.gameProfile.achievements:[],lastPlayed:u.gameProfile?u.gameProfile.last_played:void 0,playCount:u.gameProfile?Number(u.gameProfile.play_count||0):0,gameId:this.gameId,authType:"apple"},this.authData={userType:"email",userId:s,authType:"apple",nickname:l,sessionId:s},sessionStorage.setItem("chedda_auth",JSON.stringify(this.authData)),sessionStorage.setItem("auth_method","apple"),"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("apple_login_success",this.profile.nickname||"",String(this.profile.score||0),String(this.profile.streak||0),JSON.stringify(this.profile.achievements||[])),console.log("[CheddaBoards] Apple login complete:",l),this.profile}catch(e){throw console.error("Apple login failed:",e),e}}async logout(){try{return this.sessionId&&await this.actor.destroySession(this.sessionId).catch(e=>{console.warn("[CheddaBoards] Session destroy failed:",e)}),this.authClient&&await this.authClient.logout().catch(()=>{}),this.identity=new kt,this.userType=null,this.userId=null,this.authType=null,this.authData=null,this.profile=null,this.sessionId=null,sessionStorage.removeItem("chedda_auth"),sessionStorage.removeItem("auth_method"),await this._createActor({identity:this.identity}),!0}catch(e){return console.error("Logout failed:",e),!1}}async submitScore(e,t,r=null){if(e<0||t<0)throw new Error("Score and streak must be non-negative");if("number"!=typeof e||"number"!=typeof t)throw new Error("Score and streak must be numbers");if(isNaN(e)||isNaN(t))throw new Error("Score and streak cannot be NaN");try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return console.error(" No userType!"),{success:!1,error:"Not authenticated"};let n,i;if("principal"===this.userType){const e=this.authClient||window.cheddaAuthClient;e&&await e.isAuthenticated()&&(this.identity=e.getIdentity(),await this._createActor({identity:this.identity})),n="principal",i=this.userId,console.log(" Principal auth:"),console.log("  userIdType:",n),console.log("  userId:",i)}else{if("email"!==this.userType)return console.error(" Invalid userType:",this.userType),{success:!1,error:"Invalid user type"};n="email",i=this.sessionId}if(!n||"null"===n||null===n)return console.error(" userIdType is null/undefined!"),{success:!1,error:"Missing user type"};if(!i||"null"===i||null===i)return console.error(" userId is null/undefined!"),{success:!1,error:"Missing user ID"};if(!this.gameId||"null"===this.gameId||null===this.gameId)return console.error(" gameId is null/undefined!"),{success:!1,error:"Missing game ID"};const s=await this.actor.submitScore(n,i,this.gameId,Math.floor(e),Math.floor(t),null!==r?[r]:[]);return console.log(" Backend response:",s),s?.ok?(this.loadProfile().catch(e=>console.error("[CheddaBoards] Background profile refresh failed:",e)),"undefined"!=typeof window&&window.emitToGodot&&window.emitToGodot("score_submitted",String(e),String(t)),{success:!0,message:s.ok}):s?.err?{success:!1,error:s.err}:{success:!1,error:"Unknown error"}}catch(e){return{success:!1,error:e.message}}}async getLeaderboard(e="score",t=1e4){try{this.actor||await this._createActor({identity:this.identity});const r="streak"===e?{streak:null}:{score:null};let n=await this.actor.getLeaderboard(this.gameId,r,t);return Array.isArray(n)&&1===n.length&&Array.isArray(n[0])&&(n=n[0]),Array.isArray(n)?n.map((e,t)=>({nickname:e[0]||"Unknown",score:Number(e[1]||0),streak:Number(e[2]||0),rank:t+1,authType:e[3]||"unknown"})):[]}catch(e){return console.error("Leaderboard fetch failed:",e),[]}}async getLeaderboardByAuth(e,t="score",r=1e4){try{this.actor||await this._createActor({identity:this.identity});const n="cheddaId"===e||"internetIdentity"===e?{internetIdentity:null}:"google"===e?{google:null}:{apple:null},i="streak"===t?{streak:null}:{score:null};let s=await this.actor.getLeaderboardByAuth(this.gameId,n,i,r);for(;Array.isArray(s)&&1===s.length&&Array.isArray(s[0])&&4!==s[0].length;)s=s[0];return Array.isArray(s)?s.map((e,t)=>!Array.isArray(e)||e.length<4?null:{nickname:String(e[0]||"Unknown"),score:Number(e[1]||0),streak:Number(e[2]||0),rank:t+1,authType:String(e[3]||"unknown")}).filter(e=>null!==e):[]}catch(e){return console.error("Leaderboard by auth fetch failed:",e),[]}}async getPlayerRank(e="score",t=null,r=null){try{this.actor||await this._createActor({identity:this.identity});let n=t,i=r;if(!n)if("principal"===this.userType)n="principal",i=this.userId;else{if("email"!==this.userType)return null;n="email",i=this.userId}const s="streak"===e?{streak:null}:{score:null},o=await this.actor.getPlayerRank(this.gameId,s,n,i);return o&&o[0]?{rank:Number(o[0].rank||0),score:Number(o[0].score||0),streak:Number(o[0].streak||0),totalPlayers:Number(o[0].totalPlayers||0)}:null}catch(e){return console.error("Player rank fetch failed:",e),null}}async getGameAuthStats(){try{this.actor||await this._createActor({identity:this.identity});const e=await this.actor.getGameAuthStats(this.gameId);return{cheddaId:Number(e.internetIdentity||0),google:Number(e.google||0),apple:Number(e.apple||0),total:Number(e.total||0)}}catch(e){return console.error("Game auth stats fetch failed:",e),null}}async getProfile(){try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return null;const e="principal"===this.userType?"principal":"session",t="principal"===this.userType?this.userId:this.sessionId,r=await this.actor.getGameProfile(e,t,this.gameId);if(r?.ok){const e=r.ok;return{nickname:this.authData?.nickname||"Player",score:Number(e.total_score||0),streak:Number(e.best_streak||0),achievements:e.achievements||[],lastPlayed:e.last_played,playCount:Number(e.play_count||0),gameId:this.gameId,authType:this.authType}}return null}catch(e){return console.error("Profile fetch failed:",e),null}}async getAllGameProfiles(){try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return null;const e="principal"===this.userType?"principal":"session",t="principal"===this.userType?this.userId:this.sessionId,r=await this.actor.getUserProfile(e,t);if(r?.ok){const e=r.ok;return{nickname:e.nickname,authType:this.authType,games:e.gameProfiles.map(([e,t])=>({gameId:e,score:Number(t.total_score||0),streak:Number(t.best_streak||0),achievements:t.achievements||[],lastPlayed:t.last_played,playCount:Number(t.play_count||0)})),created:e.created}}return null}catch(e){return console.error("All profiles fetch failed:",e),null}}async loadProfile(){return this.profile=await this.getProfile(),this.profile&&"undefined"!=typeof window&&(window.dispatchEvent(new CustomEvent("chedda:profile",{detail:this.profile})),window.emitToGodot&&window.emitToGodot("profile_loaded",this.profile.nickname||"Player",String(this.profile.score||0),String(this.profile.streak||0),JSON.stringify(this.profile.achievements||[]))),this.profile}getCachedProfile(){return this.profile}async refreshProfile(){return await this.loadProfile()}async getMyFullProfile(){try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return null;let e;if(this.sessionId)e=await this.actor.getMyProfileBySession(this.sessionId);else{if("principal"!==this.userType)return null;{const t=this.authClient||window.cheddaAuthClient;t&&await t.isAuthenticated()&&(this.identity=t.getIdentity(),await this._createActor({identity:this.identity})),e=await this.actor.getMyProfile()}}return e?.ok?e.ok:null}catch(e){return console.error("Full profile fetch failed:",e),null}}async changeNickname(e){try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return{success:!1,error:"Not authenticated"};if(!e||e.length<2||e.length>12)return{success:!1,error:"Nickname must be 2-12 characters"};let t,r;if("principal"===this.userType){const e=this.authClient||window.cheddaAuthClient;e&&await e.isAuthenticated()&&(this.identity=e.getIdentity(),await this._createActor({identity:this.identity})),t="principal",r=this.userId}else t="email",r=this.sessionId;const n=await this.actor.changeNicknameAndGetProfile(t,r,e,this.gameId);if(n?.ok){const e=n.ok;return this.profile&&(this.profile.nickname=e.nickname,e.gameProfile&&(this.profile.score=Number(e.gameProfile.total_score||this.profile.score||0),this.profile.streak=Number(e.gameProfile.best_streak||this.profile.streak||0),this.profile.achievements=e.gameProfile.achievements||this.profile.achievements,this.profile.lastPlayed=e.gameProfile.last_played??this.profile.last_played,this.profile.playCount=Number(e.gameProfile.play_count||this.profile.playCount||0))),this.authData&&(this.authData.nickname=e.nickname,sessionStorage.setItem("chedda_auth",JSON.stringify(this.authData))),"undefined"!=typeof window&&(window.dispatchEvent(new CustomEvent("chedda:nickname_changed",{detail:{nickname:e.nickname}})),window.emitToGodot&&window.emitToGodot("nickname_changed",e.nickname)),{success:!0,nickname:e.nickname}}return n?.err?{success:!1,error:n.err}:{success:!0,nickname:e}}catch(e){return console.error("Nickname change failed:",e),{success:!1,error:e.message}}}async promptNicknameChange(e=""){return new Promise(t=>{const r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9999;display:flex;align-items:center;justify-content:center;font-family:Arial,sans-serif;";const n=document.createElement("div");n.style.cssText="background:#2a2a2a;border:3px solid #4a4a4a;border-radius:10px;padding:30px;width:320px;text-align:center;box-shadow:0 0 20px rgba(0,0,0,0.5);";const i=document.createElement("h2");if(i.textContent="Change Nickname",i.style.cssText="color:#fff;margin:0 0 15px 0;font-size:24px;",n.appendChild(i),e){const t=document.createElement("p");t.textContent=`Current: ${e}`,t.style.cssText="color:#aaa;margin:0 0 15px 0;font-size:14px;",n.appendChild(t)}const s=document.createElement("input");s.type="text",s.value=e,s.maxLength=12,s.placeholder="Enter new nickname...",s.style.cssText="width:100%;padding:12px;background:#1a1a1a;border:2px solid #4a4a4a;color:#fff;font-size:16px;border-radius:5px;box-sizing:border-box;margin-bottom:5px;",n.appendChild(s);const o=document.createElement("div");o.textContent=`${s.value.length}/12`,o.style.cssText="color:#888;font-size:12px;text-align:right;margin-bottom:15px;",n.appendChild(o),s.addEventListener("input",()=>{o.textContent=`${s.value.length}/12`});const a=document.createElement("div");a.style.cssText="display:flex;gap:15px;justify-content:center;";const c=document.createElement("button");c.textContent="CHANGE",c.style.cssText="padding:12px 25px;background:#4CAF50;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s;",c.onmouseover=function(){this.style.background="#45a049"},c.onmouseout=function(){this.style.background="#4CAF50"};const u=document.createElement("button");u.textContent="CANCEL",u.style.cssText="padding:12px 25px;background:#666;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s;",u.onmouseover=function(){this.style.background="#777"},u.onmouseout=function(){this.style.background="#666"},a.appendChild(c),a.appendChild(u),n.appendChild(a),r.appendChild(n),document.body.appendChild(r),s.focus(),s.select(),c.onclick=()=>{const e=s.value.trim();document.body.removeChild(r),t(e)},u.onclick=()=>{document.body.removeChild(r),t(null)},s.onkeydown=e=>{"Enter"===e.key?c.click():"Escape"===e.key&&u.click()},r.onclick=e=>{e.target===r&&u.click()}})}async changeNicknameWithPrompt(){try{const e=this.profile?.nickname||this.authData?.nickname||"",t=await this.promptNicknameChange(e);return t&&t!==e?await this.changeNickname(t):{success:!1,cancelled:!0}}catch(e){return console.error("[CheddaBoards] Nickname change with prompt failed:",e),{success:!1,error:e.message}}}async unlockAchievement(e){try{if(this.actor||await this._createActor({identity:this.identity}),!this.userType)return{success:!1,error:"Not authenticated"};let t,r;if("principal"===this.userType)t="principal",r=this.userId;else{if("email"!==this.userType)return{success:!1,error:"Invalid user type"};t="email",r=this.sessionId}const n=await this.actor.unlockAchievement(t,r,this.gameId,e);return n?.ok?(await this.loadProfile(),{success:!0,message:n.ok}):n?.err?{success:!1,error:n.err}:{success:!0}}catch(e){return console.error("Achievement unlock failed:",e),{success:!1,error:e.message}}}async trackEvent(e,t={}){try{this.actor||await this._createActor({identity:this.identity}),t.gameId=this.gameId,t.authType=this.authType||"none";const r=Object.entries(t).map(([e,t])=>[e,String(t)]);if(!this.userType)return{success:!1,error:"Not authenticated"};let n,i=this.userType;if("email"===this.userType||"session"===this.userType)n=this.sessionId;else if("principal"===this.userType){const e=this.authClient||window.cheddaAuthClient;e&&await e.isAuthenticated()&&(this.identity=e.getIdentity(),await this._createActor({identity:this.identity})),n=this.userId}else n="";return await this.actor.trackEvent(i,n,e,this.gameId,r),{success:!0}}catch(e){return console.error("Event tracking failed:",e),{success:!1,error:e.message}}}async getDailyStats(e){try{return this.actor||await this._createActor({identity:this.identity}),await this.actor.getDailyStats(e,this.gameId)||null}catch(e){return console.error("Daily stats fetch failed:",e),null}}async getPlayerAnalytics(e){return null}async getAnalyticsSummary(){try{this.actor||await this._createActor({identity:this.identity});const e=await this.actor.getAnalyticsSummary();return{totalEvents:Number(e.totalEvents||0),uniquePlayers:Number(e.uniquePlayers||0),totalGames:Number(e.totalGames||0),totalDays:Number(e.totalDays||0)}}catch(e){return console.error("Analytics fetch failed:",e),null}}async listGames(){try{return this.actor||await this._createActor({identity:this.identity}),await this.actor.listGames()||[]}catch(e){return console.error("List games failed:",e),[]}}async getGameInfo(){try{return this.actor||await this._createActor({identity:this.identity}),await this.actor.getGame(this.gameId)||null}catch(e){return console.error("Get game info failed:",e),null}}async getSystemInfo(){try{return this.actor||await this._createActor({identity:this.identity}),await this.actor.getSystemInfo()}catch(e){return console.error("System info fetch failed:",e),null}}async uploadFile(e,t){try{let r;this.actor||await this._createActor({identity:this.identity}),r=t instanceof Blob?t:"string"==typeof t?new Blob([t],{type:"text/plain"}):t instanceof ArrayBuffer?new Blob([t]):new Blob([JSON.stringify(t)],{type:"application/json"});const n=await r.arrayBuffer(),i=await this.actor.uploadFile(e,[...new Uint8Array(n)]);return i?.ok?{success:!0,message:i.ok}:i?.err?{success:!1,error:i.err}:{success:!0}}catch(e){return console.error("File upload failed:",e),{success:!1,error:e.message}}}async listFiles(){try{return this.actor||await this._createActor({identity:this.identity}),await this.actor.listFiles()||[]}catch(e){return console.error("List files failed:",e),[]}}async getFile(e){try{this.actor||await this._createActor({identity:this.identity});const t=await this.actor.getFile(e);if(t){const e=new Uint8Array(t);return new Blob([e])}return null}catch(e){return console.error("Get file failed:",e),null}}async updateGameRules(e,t,r,n){try{this.actor||await this._createActor({identity:this.identity});const i=await this.actor.updateGameRules(this.gameId,e?[e]:[],t?[t]:[],r?[r]:[],n?[n]:[]);return i?.ok?{success:!0,message:i.ok}:i?.err?{success:!1,error:i.err}:{success:!0}}catch(e){return console.error("[CheddaBoards] Update game rules failed:",e),{success:!1,error:e.message}}}_authTypeToString(e){return e?void 0!==e.internetIdentity?"cheddaId":void 0!==e.google?"google":void 0!==e.apple?"apple":"unknown":"unknown"}_stringToAuthType(e){switch((e||"").toLowerCase()){case"cheddaid":case"chedda":return{internetIdentity:null};case"google":return{google:null};case"apple":return{apple:null};default:return null}}isAuthenticated(){return null!==this.userType&&(null!==this.sessionId||null!==this.userId)}getAuthType(){return"internetIdentity"===this.authType?"cheddaId":this.authType}getGameId(){return this.gameId}getPrincipal(){return"principal"===this.userType?this.userId:"email"===this.userType?"email:"+this.userId:null}getAuthData(){return this.authData}getSessionId(){return this.sessionId}}const Rc="https://cheddaboards.com/.netlify/functions/auth-verify",Fc={init:async(e,t={})=>{if(!t.gameId)throw new Error('[CheddaBoards] gameId is required. Usage: CheddaBoards.init(canisterId, { gameId: "your-game-id" })');const r=new Pc({canisterId:e,...t});return await r.init(),{login:{chedda:e=>r.loginChedda(e),ii2:e=>r.loginII2(e),google:(e,t)=>r.loginGoogle(e,t),apple:(e,t)=>r.loginApple(e,t)},loginChedda:e=>r.loginChedda(e),loginII2:e=>r.loginII2(e),loginGoogle:(e,t)=>r.loginGoogle(e,t),loginApple:(e,t)=>r.loginApple(e,t),logout:()=>r.logout(),isAuthenticated:()=>r.isAuthenticated(),getAuthType:()=>r.getAuthType(),registerGame:(e,t,n)=>r.registerGame(e,t,n),getMyGameCount:()=>r.getMyGameCount(),getRemainingGameSlots:()=>r.getRemainingGameSlots(),submitScore:(e,t,n)=>r.submitScore(e,t,n),unlockAchievement:e=>r.unlockAchievement(e),getLeaderboard:(e,t)=>r.getLeaderboard(e,t),getLeaderboardByAuth:(e,t,n)=>r.getLeaderboardByAuth(e,t,n),getPlayerRank:e=>r.getPlayerRank(e),getGameAuthStats:()=>r.getGameAuthStats(),getProfile:()=>r.getProfile(),getAllGameProfiles:()=>r.getAllGameProfiles(),getCachedProfile:()=>r.getCachedProfile(),refreshProfile:()=>r.refreshProfile(),changeNickname:e=>r.changeNickname(e),changeNicknameWithPrompt:()=>r.changeNicknameWithPrompt(),listGames:()=>r.listGames(),getGameInfo:()=>r.getGameInfo(),updateGameRules:(e,t,n,i)=>r.updateGameRules(e,t,n,i),trackEvent:(e,t)=>r.trackEvent(e,t),getDailyStats:e=>r.getDailyStats(e),getAnalyticsSummary:()=>r.getAnalyticsSummary(),uploadFile:(e,t)=>r.uploadFile(e,t),listFiles:()=>r.listFiles(),getFile:e=>r.getFile(e),getSystemInfo:()=>r.getSystemInfo(),gameId:r.gameId,getPrincipal:()=>r.getPrincipal(),instance:r}}},Dc=Fc;"undefined"!=typeof window&&(window.CheddaBoards=Fc),e.exports&&(e.exports=Fc)}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n](s,s.exports,r),s.loaded=!0,s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n=r(757);window.CheddaBoards=n.default})();
